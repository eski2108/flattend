{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import axios from'axios';import{toast}from'sonner';import{IoAlertCircle,IoChatbubbles,IoCheckmark as Check,IoCheckmarkCircle,IoCloudUpload,IoShield,IoTime}from'react-icons/io5';import OTPModal from'@/components/OTPModal';import P2PNotifications from'@/components/P2PNotifications';import DisputeModal from'@/components/DisputeModal';import DisputeChatModal from'@/components/DisputeChatModal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;export default function P2PTradeDetailDemo(){var _trade$trade_id,_dispute$dispute_id,_dispute$reason,_trade$price_per_unit,_trade$fiat_amount,_trade$trade_id2;const{tradeId}=useParams();const navigate=useNavigate();const[trade,setTrade]=useState(null);const[loading,setLoading]=useState(true);const[timeRemaining,setTimeRemaining]=useState(0);const[chatMessages,setChatMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[showOtpModal,setShowOtpModal]=useState(false);const[otpCode,setOtpCode]=useState('');const[proofFile,setProofFile]=useState(null);const[user,setUser]=useState(null);const[showDisputeModal,setShowDisputeModal]=useState(false);const[showDisputeChatModal,setShowDisputeChatModal]=useState(false);const[dispute,setDispute]=useState(null);useEffect(()=>{const userData=JSON.parse(localStorage.getItem('cryptobank_user')||'{}');setUser(userData);loadTradeDetails();},[tradeId]);useEffect(()=>{if(timeRemaining>0){const timer=setTimeout(()=>setTimeRemaining(timeRemaining-1),1000);return()=>clearTimeout(timer);}},[timeRemaining]);const loadTradeDetails=async()=>{try{const response=await axios.get(\"\".concat(API,\"/p2p/trade/\").concat(tradeId));if(response.data.success){setTrade(response.data.trade);setTimeRemaining(response.data.time_remaining_seconds||0);// Load chat messages (mock for now)\nsetChatMessages([{sender:'seller',text:'Hi! Please transfer to the account details shown above.',time:'2 min ago'},{sender:'buyer',text:'Payment sent! Uploading proof now.',time:'1 min ago'}]);}}catch(error){console.error('Error loading trade:',error);toast.error('Failed to load trade details');}finally{setLoading(false);}};const handleMarkPaid=async()=>{try{const response=await axios.post(\"\".concat(API,\"/p2p/mark-paid\"),{trade_id:tradeId,buyer_id:user.user_id});if(response.data.success){toast.success('Payment marked as complete!');loadTradeDetails();}}catch(error){console.error('Error marking as paid:',error);toast.error('Failed to mark as paid');}};const handleReleaseCrypto=()=>{setShowOtpModal(true);};const confirmRelease=async()=>{try{const response=await axios.post(\"\".concat(API,\"/p2p/release-crypto\"),{trade_id:tradeId,seller_id:user.user_id,otp_code:otpCode});if(response.data.success){toast.success('Crypto released successfully!');setShowOtpModal(false);loadTradeDetails();}}catch(error){console.error('Error releasing crypto:',error);toast.error('Failed to release crypto');}};const handleSendMessage=()=>{if(newMessage.trim()){setChatMessages([...chatMessages,{sender:user.user_id===(trade===null||trade===void 0?void 0:trade.buyer_id)?'buyer':'seller',text:newMessage,time:'Just now'}]);setNewMessage('');}};const formatTime=seconds=>{const mins=Math.floor(seconds/60);const secs=seconds%60;return\"\".concat(mins,\":\").concat(secs.toString().padStart(2,'0'));};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-white text-xl\",children:\"Loading trade...\"})});}if(!trade){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-white text-xl\",children:\"Trade not found\"})});}const isBuyer=(user===null||user===void 0?void 0:user.user_id)===trade.buyer_id;const isSeller=(user===null||user===void 0?void 0:user.user_id)===trade.seller_id;return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/p2p-marketplace'),className:\"text-cyan-400 mb-4\",children:\"\\u2190 Back to Marketplace\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"h1\",{className:\"text-3xl font-bold text-white\",children:[\"Trade #\",(_trade$trade_id=trade.trade_id)===null||_trade$trade_id===void 0?void 0:_trade$trade_id.slice(0,8)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[timeRemaining>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 bg-orange-900/30 px-6 py-3 rounded-xl border border-orange-500/30\",children:[/*#__PURE__*/_jsx(IoTime,{className:\"w-6 h-6 text-orange-400\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-orange-400 font-bold text-2xl\",children:formatTime(timeRemaining)}),/*#__PURE__*/_jsx(\"div\",{className:\"text-orange-300 text-xs\",children:\"Time remaining\"})]})]}),(user===null||user===void 0?void 0:user.user_id)&&/*#__PURE__*/_jsx(P2PNotifications,{userId:user.user_id,tradeId:tradeId,onNotificationClick:notification=>{// Handle notification click (e.g., scroll to relevant section)\nif(notification.notification_type==='message_received'){var _document$getElementB;(_document$getElementB=document.getElementById('chat-section'))===null||_document$getElementB===void 0?void 0:_document$getElementB.scrollIntoView({behavior:'smooth'});}}})]})]})]}),trade.status==='disputed'&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-r from-red-900/50 to-orange-900/50 border-2 border-red-500 rounded-xl p-6 mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-4\",children:[/*#__PURE__*/_jsx(IoAlertCircle,{className:\"w-8 h-8 text-red-400 flex-shrink-0\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-red-300 mb-2\",children:\"\\u26A0\\uFE0F Dispute In Progress\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-300 mb-3\",children:\"This trade is under admin review. Both parties can submit evidence and communicate with the admin. The losing party will be charged a \\xA35 dispute fee.\"}),dispute&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-black/20 rounded-lg p-4 mb-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-3 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Dispute ID:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white ml-2 font-mono\",children:(_dispute$dispute_id=dispute.dispute_id)===null||_dispute$dispute_id===void 0?void 0:_dispute$dispute_id.slice(0,8)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Status:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-orange-400 ml-2 font-semibold\",children:dispute.status})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Opened:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white ml-2\",children:new Date(dispute.created_at).toLocaleString()})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Reason:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white ml-2 capitalize\",children:(_dispute$reason=dispute.reason)===null||_dispute$reason===void 0?void 0:_dispute$reason.replace(/_/g,' ')})]})]})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowDisputeChatModal(true),className:\"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white px-6 py-3 rounded-lg font-semibold transition-all\",children:\"View Dispute Chat\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-2 space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-4\",children:[/*#__PURE__*/_jsx(IoShield,{className:\"w-6 h-6 text-cyan-400\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white\",children:\"Trade Status\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[trade.status==='waiting_payment'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IoAlertCircle,{className:\"w-8 h-8 text-yellow-400\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-yellow-400 font-bold text-lg\",children:\"Waiting for Payment\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-sm\",children:\"Buyer must complete payment\"})]})]}),trade.status==='paid'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{className:\"w-8 h-8 text-green-400\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-green-400 font-bold text-lg\",children:\"Payment Received\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-sm\",children:\"Waiting for seller to release crypto\"})]})]}),trade.status==='completed'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{className:\"w-8 h-8 text-green-400\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-green-400 font-bold text-lg\",children:\"Completed\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-sm\",children:\"Trade completed successfully\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-cyan-500/30 rounded-xl p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-4\",children:[/*#__PURE__*/_jsx(IoShield,{className:\"w-6 h-6 text-cyan-400\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white\",children:\"Escrow Protection\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4 \".concat(trade.status==='completed'?'bg-green-900/20 border-green-500/30':'bg-cyan-900/20 border-cyan-500/30'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-300\",children:\"Amount in Escrow:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-cyan-400 font-bold text-lg\",children:[trade.crypto_amount,\" \",trade.crypto_currency]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-300\",children:\"Escrow Status:\"}),trade.status==='completed'?/*#__PURE__*/_jsx(\"span\",{className:\"text-green-400 font-semibold\",children:\"\\u2713 Released\"}):trade.escrow_locked?/*#__PURE__*/_jsx(\"span\",{className:\"text-yellow-400 font-semibold\",children:\"\\uD83D\\uDD12 Locked\"}):/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400 font-semibold\",children:\"\\u25CB Not Locked\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-3 text-xs text-gray-400\",children:trade.status==='completed'?'‚úÖ Funds have been successfully released to the buyer.':'üîí Funds are safely held in escrow and will be released once seller confirms payment.'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white mb-4\",children:\"Trade Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Amount:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-white font-semibold\",children:[trade.crypto_amount,\" \",trade.crypto_currency]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Price:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-white font-semibold\",children:[\"\\xA3\",(_trade$price_per_unit=trade.price_per_unit)===null||_trade$price_per_unit===void 0?void 0:_trade$price_per_unit.toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Total:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-white font-bold text-lg\",children:[\"\\xA3\",(_trade$fiat_amount=trade.fiat_amount)===null||_trade$fiat_amount===void 0?void 0:_trade$fiat_amount.toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Payment Method:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:trade.payment_method})]}),isBuyer&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Seller:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"John Seller \\u2B50\"})]}),isSeller&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Buyer:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"gads21083\"})]})]})]}),isBuyer&&trade.status==='waiting_payment'&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-blue-500/30 rounded-xl p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white mb-4\",children:\"\\uD83D\\uDCB3 Payment Instructions\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Bank:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"HSBC\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Account:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"12345678\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Sort Code:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"40-47-84\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Reference:\"}),\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"text-cyan-400 font-mono\",children:[\"TRADE\",(_trade$trade_id2=trade.trade_id)===null||_trade$trade_id2===void 0?void 0:_trade$trade_id2.slice(0,8)]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 text-sm text-yellow-400\",children:\"\\u26A0\\uFE0F Please include the reference code in your transfer!\"})]}),isBuyer&&trade.status==='waiting_payment'&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white mb-4\",children:\"\\uD83D\\uDCCE Upload Payment Proof\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-2 border-dashed border-slate-600 rounded-lg p-8 text-center hover:border-cyan-500 transition-colors cursor-pointer\",children:[/*#__PURE__*/_jsx(IoCloudUpload,{className:\"w-12 h-12 text-gray-400 mx-auto mb-3\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",className:\"hidden\",id:\"proof-upload\",onChange:e=>setProofFile(e.target.files[0])}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"proof-upload\",className:\"cursor-pointer\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-white mb-2\",children:\"Click to upload or drag and drop\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-sm\",children:\"PNG, JPG or PDF (max. 5MB)\"})]}),proofFile&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 text-green-400\",children:[\"\\u2713 \",proofFile.name]})]})]}),isSeller&&trade.status==='paid'&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-green-500/30 rounded-xl p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white mb-4\",children:\"\\u2705 Buyer Marked Payment Complete\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-900/20 border border-green-500/30 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-green-400 font-semibold mb-2\",children:\"Payment Confirmation Received\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-300 text-sm mb-3\",children:\"The buyer has marked the payment as complete. Please verify the payment in your bank account before releasing crypto.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-yellow-400\",children:\"\\u26A0\\uFE0F Only release crypto after confirming the payment has arrived in your account!\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-4\",children:[isBuyer&&trade.status==='waiting_payment'&&/*#__PURE__*/_jsx(\"button\",{onClick:handleMarkPaid,className:\"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition-colors shadow-lg hover:shadow-green-500/50\",children:\"\\u2713 I Have Paid\"}),isSeller&&trade.status==='paid'&&/*#__PURE__*/_jsx(\"button\",{onClick:handleReleaseCrypto,className:\"flex-1 bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-4 px-6 rounded-xl transition-colors shadow-lg hover:shadow-cyan-500/50\",children:\"\\uD83D\\uDD13 Release Crypto\"}),trade.status==='completed'&&/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 bg-green-900/30 border border-green-500/30 text-green-400 font-bold py-4 px-6 rounded-xl text-center\",children:\"\\u2705 Trade Completed\"}),(trade.status==='waiting_payment'||trade.status==='paid')&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(window.confirm('Are you sure you want to cancel this trade? Funds will be returned to seller.')){// Cancel trade logic\ntoast.info('Cancel trade functionality coming soon');}},className:\"bg-slate-700 hover:bg-slate-600 text-white px-6 py-4 rounded-xl transition-colors\",children:\"Cancel Trade\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowDisputeModal(true),className:\"bg-orange-600 hover:bg-orange-700 text-white px-6 py-4 rounded-xl transition-colors\",children:\"Open Dispute\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"lg:col-span-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 h-[600px] flex flex-col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-4\",children:[/*#__PURE__*/_jsx(IoChatbubbles,{className:\"w-5 h-5 text-cyan-400\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-white\",children:\"Chat\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-y-auto space-y-3 mb-4\",children:chatMessages.map((msg,idx)=>/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(msg.sender==='buyer'?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-[80%] rounded-lg p-3 \".concat(msg.sender==='buyer'?'bg-cyan-600 text-white':'bg-slate-700 text-gray-200'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm\",children:msg.text}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs opacity-70 mt-1\",children:msg.time})]})},idx))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newMessage,onChange:e=>setNewMessage(e.target.value),onKeyPress:e=>e.key==='Enter'&&handleSendMessage(),placeholder:\"Type message...\",className:\"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSendMessage,className:\"bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg\",children:\"Send\"})]})]})})]})]}),/*#__PURE__*/_jsx(OTPModal,{isOpen:showOtpModal,onClose:()=>setShowOtpModal(false),onVerify:async code=>{try{const response=await axios.post(\"\".concat(API,\"/api/crypto-market/release-crypto\"),{order_id:tradeId,otp_code:code,seller_id:user.user_id});if(response.data.success){toast.success('Crypto released successfully!');setShowOtpModal(false);loadTradeDetails();}else{toast.error(response.data.message||'Failed to release crypto');}}catch(error){var _error$response,_error$response$data;console.error('Error releasing crypto:',error);toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.detail)||'Failed to release crypto');}},title:\"\\uD83D\\uDD10 Confirm Release\",description:trade?\"You are about to release \".concat(trade.crypto_amount,\" \").concat(trade.crypto_currency,\" to the buyer. Enter the 6-digit OTP code sent to your email.\"):'Verify your identity to release crypto.',userId:user===null||user===void 0?void 0:user.user_id,action:\"p2p_release\"}),/*#__PURE__*/_jsx(DisputeModal,{isOpen:showDisputeModal,onClose:()=>setShowDisputeModal(false),tradeId:tradeId,userId:user===null||user===void 0?void 0:user.user_id,onDisputeCreated:newDispute=>{setDispute(newDispute);setShowDisputeModal(false);loadTradeDetails();}}),dispute&&/*#__PURE__*/_jsx(DisputeChatModal,{isOpen:showDisputeChatModal,onClose:()=>setShowDisputeChatModal(false),disputeId:dispute.dispute_id,userId:user===null||user===void 0?void 0:user.user_id,userRole:(user===null||user===void 0?void 0:user.user_id)===(trade===null||trade===void 0?void 0:trade.buyer_id)?'buyer':'seller'})]});}","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","axios","toast","IoAlertCircle","IoChatbubbles","IoCheckmark","Check","IoCheckmarkCircle","IoCloudUpload","IoShield","IoTime","OTPModal","P2PNotifications","DisputeModal","DisputeChatModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API","process","env","REACT_APP_BACKEND_URL","P2PTradeDetailDemo","_trade$trade_id","_dispute$dispute_id","_dispute$reason","_trade$price_per_unit","_trade$fiat_amount","_trade$trade_id2","tradeId","navigate","trade","setTrade","loading","setLoading","timeRemaining","setTimeRemaining","chatMessages","setChatMessages","newMessage","setNewMessage","showOtpModal","setShowOtpModal","otpCode","setOtpCode","proofFile","setProofFile","user","setUser","showDisputeModal","setShowDisputeModal","showDisputeChatModal","setShowDisputeChatModal","dispute","setDispute","userData","JSON","parse","localStorage","getItem","loadTradeDetails","timer","setTimeout","clearTimeout","response","get","concat","data","success","time_remaining_seconds","sender","text","time","error","console","handleMarkPaid","post","trade_id","buyer_id","user_id","handleReleaseCrypto","confirmRelease","seller_id","otp_code","handleSendMessage","trim","formatTime","seconds","mins","Math","floor","secs","toString","padStart","className","children","isBuyer","isSeller","onClick","slice","userId","onNotificationClick","notification","notification_type","_document$getElementB","document","getElementById","scrollIntoView","behavior","status","dispute_id","Date","created_at","toLocaleString","reason","replace","crypto_amount","crypto_currency","escrow_locked","price_per_unit","fiat_amount","payment_method","type","id","onChange","e","target","files","htmlFor","name","window","confirm","info","map","msg","idx","value","onKeyPress","key","placeholder","isOpen","onClose","onVerify","code","order_id","message","_error$response","_error$response$data","detail","title","description","action","onDisputeCreated","newDispute","disputeId","userRole"],"sources":["/app/frontend/src/pages/P2PTradeDetailDemo.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { toast } from 'sonner';\nimport { IoAlertCircle, IoChatbubbles, IoCheckmark as Check, IoCheckmarkCircle, IoCloudUpload, IoShield, IoTime } from 'react-icons/io5';\nimport OTPModal from '@/components/OTPModal';\nimport P2PNotifications from '@/components/P2PNotifications';\nimport DisputeModal from '@/components/DisputeModal';\nimport DisputeChatModal from '@/components/DisputeChatModal';\nconst API = process.env.REACT_APP_BACKEND_URL;\n\nexport default function P2PTradeDetailDemo() {\n  const { tradeId } = useParams();\n  const navigate = useNavigate();\n  const [trade, setTrade] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [timeRemaining, setTimeRemaining] = useState(0);\n  const [chatMessages, setChatMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [showOtpModal, setShowOtpModal] = useState(false);\n  const [otpCode, setOtpCode] = useState('');\n  const [proofFile, setProofFile] = useState(null);\n  const [user, setUser] = useState(null);\n  const [showDisputeModal, setShowDisputeModal] = useState(false);\n  const [showDisputeChatModal, setShowDisputeChatModal] = useState(false);\n  const [dispute, setDispute] = useState(null);\n\n  useEffect(() => {\n    const userData = JSON.parse(localStorage.getItem('cryptobank_user') || '{}');\n    setUser(userData);\n    loadTradeDetails();\n  }, [tradeId]);\n\n  useEffect(() => {\n    if (timeRemaining > 0) {\n      const timer = setTimeout(() => setTimeRemaining(timeRemaining - 1), 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [timeRemaining]);\n\n  const loadTradeDetails = async () => {\n    try {\n      const response = await axios.get(`${API}/p2p/trade/${tradeId}`);\n      if (response.data.success) {\n        setTrade(response.data.trade);\n        setTimeRemaining(response.data.time_remaining_seconds || 0);\n        // Load chat messages (mock for now)\n        setChatMessages([\n          { sender: 'seller', text: 'Hi! Please transfer to the account details shown above.', time: '2 min ago' },\n          { sender: 'buyer', text: 'Payment sent! Uploading proof now.', time: '1 min ago' }\n        ]);\n      }\n    } catch (error) {\n      console.error('Error loading trade:', error);\n      toast.error('Failed to load trade details');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleMarkPaid = async () => {\n    try {\n      const response = await axios.post(`${API}/p2p/mark-paid`, {\n        trade_id: tradeId,\n        buyer_id: user.user_id\n      });\n      \n      if (response.data.success) {\n        toast.success('Payment marked as complete!');\n        loadTradeDetails();\n      }\n    } catch (error) {\n      console.error('Error marking as paid:', error);\n      toast.error('Failed to mark as paid');\n    }\n  };\n\n  const handleReleaseCrypto = () => {\n    setShowOtpModal(true);\n  };\n\n  const confirmRelease = async () => {\n    try {\n      const response = await axios.post(`${API}/p2p/release-crypto`, {\n        trade_id: tradeId,\n        seller_id: user.user_id,\n        otp_code: otpCode\n      });\n      \n      if (response.data.success) {\n        toast.success('Crypto released successfully!');\n        setShowOtpModal(false);\n        loadTradeDetails();\n      }\n    } catch (error) {\n      console.error('Error releasing crypto:', error);\n      toast.error('Failed to release crypto');\n    }\n  };\n\n  const handleSendMessage = () => {\n    if (newMessage.trim()) {\n      setChatMessages([...chatMessages, {\n        sender: user.user_id === trade?.buyer_id ? 'buyer' : 'seller',\n        text: newMessage,\n        time: 'Just now'\n      }]);\n      setNewMessage('');\n    }\n  };\n\n  const formatTime = (seconds) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 flex items-center justify-center\">\n        <div className=\"text-white text-xl\">Loading trade...</div>\n      </div>\n    );\n  }\n\n  if (!trade) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 flex items-center justify-center\">\n        <div className=\"text-white text-xl\">Trade not found</div>\n      </div>\n    );\n  }\n\n  const isBuyer = user?.user_id === trade.buyer_id;\n  const isSeller = user?.user_id === trade.seller_id;\n  \n  console.log('User:', user?.user_id, 'Buyer:', trade.buyer_id, 'Seller:', trade.seller_id);\n  console.log('isBuyer:', isBuyer, 'isSeller:', isSeller, 'Trade Status:', trade.status);\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 p-6\">\n      <div className=\"max-w-6xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-6\">\n          <button onClick={() => navigate('/p2p-marketplace')} className=\"text-cyan-400 mb-4\">\n            ‚Üê Back to Marketplace\n          </button>\n          <div className=\"flex items-center justify-between\">\n            <h1 className=\"text-3xl font-bold text-white\">Trade #{trade.trade_id?.slice(0, 8)}</h1>\n            <div className=\"flex items-center gap-4\">\n              {timeRemaining > 0 && (\n                <div className=\"flex items-center gap-2 bg-orange-900/30 px-6 py-3 rounded-xl border border-orange-500/30\">\n                  <IoTime className=\"w-6 h-6 text-orange-400\" />\n                  <div>\n                    <div className=\"text-orange-400 font-bold text-2xl\">{formatTime(timeRemaining)}</div>\n                    <div className=\"text-orange-300 text-xs\">Time remaining</div>\n                  </div>\n                </div>\n              )}\n              {/* Notification Bell */}\n              {user?.user_id && (\n                <P2PNotifications \n                  userId={user.user_id} \n                  tradeId={tradeId}\n                  onNotificationClick={(notification) => {\n                    // Handle notification click (e.g., scroll to relevant section)\n                    if (notification.notification_type === 'message_received') {\n                      document.getElementById('chat-section')?.scrollIntoView({ behavior: 'smooth' });\n                    }\n                  }}\n                />\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Dispute Banner */}\n        {trade.status === 'disputed' && (\n          <div className=\"bg-gradient-to-r from-red-900/50 to-orange-900/50 border-2 border-red-500 rounded-xl p-6 mb-6\">\n            <div className=\"flex items-start gap-4\">\n              <IoAlertCircle className=\"w-8 h-8 text-red-400 flex-shrink-0\" />\n              <div className=\"flex-1\">\n                <h3 className=\"text-xl font-bold text-red-300 mb-2\">‚ö†Ô∏è Dispute In Progress</h3>\n                <p className=\"text-gray-300 mb-3\">\n                  This trade is under admin review. Both parties can submit evidence and communicate with the admin.\n                  The losing party will be charged a ¬£5 dispute fee.\n                </p>\n                {dispute && (\n                  <div className=\"bg-black/20 rounded-lg p-4 mb-3\">\n                    <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                      <div>\n                        <span className=\"text-gray-400\">Dispute ID:</span>\n                        <span className=\"text-white ml-2 font-mono\">{dispute.dispute_id?.slice(0, 8)}</span>\n                      </div>\n                      <div>\n                        <span className=\"text-gray-400\">Status:</span>\n                        <span className=\"text-orange-400 ml-2 font-semibold\">{dispute.status}</span>\n                      </div>\n                      <div>\n                        <span className=\"text-gray-400\">Opened:</span>\n                        <span className=\"text-white ml-2\">{new Date(dispute.created_at).toLocaleString()}</span>\n                      </div>\n                      <div>\n                        <span className=\"text-gray-400\">Reason:</span>\n                        <span className=\"text-white ml-2 capitalize\">{dispute.reason?.replace(/_/g, ' ')}</span>\n                      </div>\n                    </div>\n                  </div>\n                )}\n                <button\n                  onClick={() => setShowDisputeChatModal(true)}\n                  className=\"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white px-6 py-3 rounded-lg font-semibold transition-all\"\n                >\n                  View Dispute Chat\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* Left Column - Trade Details */}\n          <div className=\"lg:col-span-2 space-y-6\">\n            {/* Status Card */}\n            <div className=\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6\">\n              <div className=\"flex items-center gap-3 mb-4\">\n                <IoShield className=\"w-6 h-6 text-cyan-400\" />\n                <h2 className=\"text-xl font-semibold text-white\">Trade Status</h2>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                {trade.status === 'waiting_payment' && (\n                  <>\n                    <IoAlertCircle className=\"w-8 h-8 text-yellow-400\" />\n                    <div>\n                      <div className=\"text-yellow-400 font-bold text-lg\">Waiting for Payment</div>\n                      <div className=\"text-gray-400 text-sm\">Buyer must complete payment</div>\n                    </div>\n                  </>\n                )}\n                {trade.status === 'paid' && (\n                  <>\n                    <IoCheckmarkCircle className=\"w-8 h-8 text-green-400\" />\n                    <div>\n                      <div className=\"text-green-400 font-bold text-lg\">Payment Received</div>\n                      <div className=\"text-gray-400 text-sm\">Waiting for seller to release crypto</div>\n                    </div>\n                  </>\n                )}\n                {trade.status === 'completed' && (\n                  <>\n                    <IoCheckmarkCircle className=\"w-8 h-8 text-green-400\" />\n                    <div>\n                      <div className=\"text-green-400 font-bold text-lg\">Completed</div>\n                      <div className=\"text-gray-400 text-sm\">Trade completed successfully</div>\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n\n            {/* Escrow Status */}\n            <div className=\"bg-slate-800/50 backdrop-blur-sm border border-cyan-500/30 rounded-xl p-6\">\n              <div className=\"flex items-center gap-3 mb-4\">\n                <IoShield className=\"w-6 h-6 text-cyan-400\" />\n                <h2 className=\"text-xl font-semibold text-white\">Escrow Protection</h2>\n              </div>\n              <div className={`border rounded-lg p-4 ${\n                trade.status === 'completed' \n                  ? 'bg-green-900/20 border-green-500/30' \n                  : 'bg-cyan-900/20 border-cyan-500/30'\n              }`}>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-gray-300\">Amount in Escrow:</span>\n                  <span className=\"text-cyan-400 font-bold text-lg\">{trade.crypto_amount} {trade.crypto_currency}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-gray-300\">Escrow Status:</span>\n                  {trade.status === 'completed' ? (\n                    <span className=\"text-green-400 font-semibold\">‚úì Released</span>\n                  ) : trade.escrow_locked ? (\n                    <span className=\"text-yellow-400 font-semibold\">üîí Locked</span>\n                  ) : (\n                    <span className=\"text-gray-400 font-semibold\">‚óã Not Locked</span>\n                  )}\n                </div>\n                <div className=\"mt-3 text-xs text-gray-400\">\n                  {trade.status === 'completed' ? (\n                    '‚úÖ Funds have been successfully released to the buyer.'\n                  ) : (\n                    'üîí Funds are safely held in escrow and will be released once seller confirms payment.'\n                  )}\n                </div>\n              </div>\n            </div>\n\n            {/* Trade Details */}\n            <div className=\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6\">\n              <h2 className=\"text-xl font-semibold text-white mb-4\">Trade Details</h2>\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-400\">Amount:</span>\n                  <span className=\"text-white font-semibold\">{trade.crypto_amount} {trade.crypto_currency}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-400\">Price:</span>\n                  <span className=\"text-white font-semibold\">¬£{trade.price_per_unit?.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-400\">Total:</span>\n                  <span className=\"text-white font-bold text-lg\">¬£{trade.fiat_amount?.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-400\">Payment Method:</span>\n                  <span className=\"text-white\">{trade.payment_method}</span>\n                </div>\n                {isBuyer && (\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-400\">Seller:</span>\n                    <span className=\"text-white\">John Seller ‚≠ê</span>\n                  </div>\n                )}\n                {isSeller && (\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-400\">Buyer:</span>\n                    <span className=\"text-white\">gads21083</span>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Payment Instructions (for buyer) */}\n            {isBuyer && trade.status === 'waiting_payment' && (\n              <div className=\"bg-slate-800/50 backdrop-blur-sm border border-blue-500/30 rounded-xl p-6\">\n                <h2 className=\"text-xl font-semibold text-white mb-4\">üí≥ Payment Instructions</h2>\n                <div className=\"bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 space-y-2\">\n                  <div><span className=\"text-gray-400\">Bank:</span> <span className=\"text-white\">HSBC</span></div>\n                  <div><span className=\"text-gray-400\">Account:</span> <span className=\"text-white\">12345678</span></div>\n                  <div><span className=\"text-gray-400\">Sort Code:</span> <span className=\"text-white\">40-47-84</span></div>\n                  <div><span className=\"text-gray-400\">Reference:</span> <span className=\"text-cyan-400 font-mono\">TRADE{trade.trade_id?.slice(0, 8)}</span></div>\n                </div>\n                <div className=\"mt-4 text-sm text-yellow-400\">\n                  ‚ö†Ô∏è Please include the reference code in your transfer!\n                </div>\n              </div>\n            )}\n\n            {/* Upload Proof */}\n            {isBuyer && trade.status === 'waiting_payment' && (\n              <div className=\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6\">\n                <h2 className=\"text-xl font-semibold text-white mb-4\">üìé Upload Payment Proof</h2>\n                <div className=\"border-2 border-dashed border-slate-600 rounded-lg p-8 text-center hover:border-cyan-500 transition-colors cursor-pointer\">\n                  <IoCloudUpload className=\"w-12 h-12 text-gray-400 mx-auto mb-3\" />\n                  <input type=\"file\" className=\"hidden\" id=\"proof-upload\" onChange={(e) => setProofFile(e.target.files[0])} />\n                  <label htmlFor=\"proof-upload\" className=\"cursor-pointer\">\n                    <div className=\"text-white mb-2\">Click to upload or drag and drop</div>\n                    <div className=\"text-gray-400 text-sm\">PNG, JPG or PDF (max. 5MB)</div>\n                  </label>\n                  {proofFile && (\n                    <div className=\"mt-4 text-green-400\">‚úì {proofFile.name}</div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Seller: Payment Proof View */}\n            {isSeller && trade.status === 'paid' && (\n              <div className=\"bg-slate-800/50 backdrop-blur-sm border border-green-500/30 rounded-xl p-6\">\n                <h2 className=\"text-xl font-semibold text-white mb-4\">‚úÖ Buyer Marked Payment Complete</h2>\n                <div className=\"bg-green-900/20 border border-green-500/30 rounded-lg p-4\">\n                  <div className=\"text-green-400 font-semibold mb-2\">Payment Confirmation Received</div>\n                  <div className=\"text-gray-300 text-sm mb-3\">\n                    The buyer has marked the payment as complete. Please verify the payment in your bank account before releasing crypto.\n                  </div>\n                  <div className=\"text-xs text-yellow-400\">\n                    ‚ö†Ô∏è Only release crypto after confirming the payment has arrived in your account!\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Actions */}\n            <div className=\"flex gap-4\">\n              {isBuyer && trade.status === 'waiting_payment' && (\n                <button\n                  onClick={handleMarkPaid}\n                  className=\"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition-colors shadow-lg hover:shadow-green-500/50\"\n                >\n                  ‚úì I Have Paid\n                </button>\n              )}\n              {isSeller && trade.status === 'paid' && (\n                <button\n                  onClick={handleReleaseCrypto}\n                  className=\"flex-1 bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-4 px-6 rounded-xl transition-colors shadow-lg hover:shadow-cyan-500/50\"\n                >\n                  üîì Release Crypto\n                </button>\n              )}\n              {trade.status === 'completed' && (\n                <div className=\"flex-1 bg-green-900/30 border border-green-500/30 text-green-400 font-bold py-4 px-6 rounded-xl text-center\">\n                  ‚úÖ Trade Completed\n                </div>\n              )}\n              {(trade.status === 'waiting_payment' || trade.status === 'paid') && (\n                <>\n                  <button\n                    onClick={() => {\n                      if (window.confirm('Are you sure you want to cancel this trade? Funds will be returned to seller.')) {\n                        // Cancel trade logic\n                        toast.info('Cancel trade functionality coming soon');\n                      }\n                    }}\n                    className=\"bg-slate-700 hover:bg-slate-600 text-white px-6 py-4 rounded-xl transition-colors\"\n                  >\n                    Cancel Trade\n                  </button>\n                  <button\n                    onClick={() => setShowDisputeModal(true)}\n                    className=\"bg-orange-600 hover:bg-orange-700 text-white px-6 py-4 rounded-xl transition-colors\"\n                  >\n                    Open Dispute\n                  </button>\n                </>\n              )}\n            </div>\n          </div>\n\n          {/* Right Column - Chat */}\n          <div className=\"lg:col-span-1\">\n            <div className=\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 h-[600px] flex flex-col\">\n              <div className=\"flex items-center gap-2 mb-4\">\n                <IoChatbubbles className=\"w-5 h-5 text-cyan-400\" />\n                <h2 className=\"text-lg font-semibold text-white\">Chat</h2>\n              </div>\n              \n              {/* Messages */}\n              <div className=\"flex-1 overflow-y-auto space-y-3 mb-4\">\n                {chatMessages.map((msg, idx) => (\n                  <div key={idx} className={`flex ${msg.sender === 'buyer' ? 'justify-end' : 'justify-start'}`}>\n                    <div className={`max-w-[80%] rounded-lg p-3 ${\n                      msg.sender === 'buyer' \n                        ? 'bg-cyan-600 text-white' \n                        : 'bg-slate-700 text-gray-200'\n                    }`}>\n                      <div className=\"text-sm\">{msg.text}</div>\n                      <div className=\"text-xs opacity-70 mt-1\">{msg.time}</div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n\n              {/* Input */}\n              <div className=\"flex gap-2\">\n                <input\n                  type=\"text\"\n                  value={newMessage}\n                  onChange={(e) => setNewMessage(e.target.value)}\n                  onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}\n                  placeholder=\"Type message...\"\n                  className=\"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white\"\n                />\n                <button\n                  onClick={handleSendMessage}\n                  className=\"bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg\"\n                >\n                  Send\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* OTP Modal */}\n      <OTPModal\n        isOpen={showOtpModal}\n        onClose={() => setShowOtpModal(false)}\n        onVerify={async (code) => {\n          try {\n            const response = await axios.post(`${API}/api/crypto-market/release-crypto`, {\n              order_id: tradeId,\n              otp_code: code,\n              seller_id: user.user_id\n            });\n            \n            if (response.data.success) {\n              toast.success('Crypto released successfully!');\n              setShowOtpModal(false);\n              loadTradeDetails();\n            } else {\n              toast.error(response.data.message || 'Failed to release crypto');\n            }\n          } catch (error) {\n            console.error('Error releasing crypto:', error);\n            toast.error(error.response?.data?.detail || 'Failed to release crypto');\n          }\n        }}\n        title=\"üîê Confirm Release\"\n        description={trade ? `You are about to release ${trade.crypto_amount} ${trade.crypto_currency} to the buyer. Enter the 6-digit OTP code sent to your email.` : 'Verify your identity to release crypto.'}\n        userId={user?.user_id}\n        action=\"p2p_release\"\n      />\n\n      {/* Dispute Modal */}\n      <DisputeModal\n        isOpen={showDisputeModal}\n        onClose={() => setShowDisputeModal(false)}\n        tradeId={tradeId}\n        userId={user?.user_id}\n        onDisputeCreated={(newDispute) => {\n          setDispute(newDispute);\n          setShowDisputeModal(false);\n          loadTradeDetails();\n        }}\n      />\n\n      {/* Dispute Chat Modal */}\n      {dispute && (\n        <DisputeChatModal\n          isOpen={showDisputeChatModal}\n          onClose={() => setShowDisputeChatModal(false)}\n          disputeId={dispute.dispute_id}\n          userId={user?.user_id}\n          userRole={user?.user_id === trade?.buyer_id ? 'buyer' : 'seller'}\n        />\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}