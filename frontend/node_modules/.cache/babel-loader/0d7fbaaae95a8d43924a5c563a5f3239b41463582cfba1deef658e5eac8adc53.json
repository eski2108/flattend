{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const BACKEND_URL=process.env.REACT_APP_BACKEND_URL;const API=\"\".concat(BACKEND_URL,\"/api\");const CurrencyContext=/*#__PURE__*/createContext();export const useCurrency=()=>{const context=useContext(CurrencyContext);if(!context){throw new Error('useCurrency must be used within CurrencyProvider');}return context;};export const CurrencyProvider=_ref=>{let{children}=_ref;const[currency,setCurrency]=useState('GBP');const[symbol,setSymbol]=useState('Â£');const[currencies,setCurrencies]=useState([]);const[exchangeRates,setExchangeRates]=useState({});const[loading,setLoading]=useState(true);// Fetch available currencies\nuseEffect(()=>{fetchCurrencies();},[]);// Load user's preferred currency\nuseEffect(()=>{const userData=localStorage.getItem('cryptobank_user');if(userData){const user=JSON.parse(userData);fetchUserCurrency(user.user_id);}else{setLoading(false);}},[]);const fetchCurrencies=async()=>{try{const response=await axios.get(\"\".concat(API,\"/currencies/list\"));if(response.data.success){setCurrencies(response.data.currencies);// Build exchange rates object\nconst rates={};response.data.currencies.forEach(curr=>{rates[curr.code]=curr.rate_to_gbp;});setExchangeRates(rates);}}catch(error){console.error('Error fetching currencies:',error);}};const fetchUserCurrency=async userId=>{try{const response=await axios.get(\"\".concat(API,\"/user/\").concat(userId,\"/currency-preference\"));if(response.data.success){setCurrency(response.data.currency);setSymbol(response.data.symbol);}}catch(error){console.error('Error fetching user currency:',error);}finally{setLoading(false);}};const updateCurrency=async newCurrency=>{const userData=localStorage.getItem('cryptobank_user');if(!userData){// Guest user - just update locally\nconst currencyInfo=currencies.find(c=>c.code===newCurrency);if(currencyInfo){setCurrency(newCurrency);setSymbol(currencyInfo.symbol);localStorage.setItem('guest_currency',newCurrency);}return;}const user=JSON.parse(userData);try{const response=await axios.post(\"\".concat(API,\"/user/\").concat(user.user_id,\"/currency-preference\"),{currency:newCurrency});if(response.data.success){setCurrency(newCurrency);setSymbol(response.data.symbol);}}catch(error){console.error('Error updating currency:',error);throw error;}};const convertAmount=function(amount){let fromCurrency=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'GBP';if(!amount||isNaN(amount))return 0;// If same currency, return as is\nif(fromCurrency===currency)return parseFloat(amount);// Convert from source currency to GBP, then to target currency\nconst amountInGBP=parseFloat(amount)/(exchangeRates[fromCurrency]||1);const convertedAmount=amountInGBP*(exchangeRates[currency]||1);return convertedAmount;};const formatAmount=function(amount){let fromCurrency=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'GBP';let showSymbol=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;const converted=convertAmount(amount,fromCurrency);const formatted=new Intl.NumberFormat('en-GB',{minimumFractionDigits:2,maximumFractionDigits:2}).format(converted);return showSymbol?\"\".concat(symbol).concat(formatted):formatted;};const formatCrypto=function(amount){let crypto=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'BTC';return new Intl.NumberFormat('en-GB',{minimumFractionDigits:2,maximumFractionDigits:8}).format(amount);};const value={currency,symbol,currencies,exchangeRates,loading,updateCurrency,convertAmount,formatAmount,formatCrypto};return/*#__PURE__*/_jsx(CurrencyContext.Provider,{value:value,children:children});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}