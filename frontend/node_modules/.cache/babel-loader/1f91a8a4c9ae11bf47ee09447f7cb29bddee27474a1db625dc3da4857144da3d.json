{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;function OTCDesk(){const navigate=useNavigate();const[userData,setUserData]=useState(null);const[loading,setLoading]=useState(true);// OTC Config\nconst[otcConfig,setOtcConfig]=useState(null);// Quote Form\nconst[tradeType,setTradeType]=useState('buy');const[selectedCrypto,setSelectedCrypto]=useState('BTC');const[amountGBP,setAmountGBP]=useState('');const[creatingQuote,setCreatingQuote]=useState(false);// Active Quote\nconst[activeQuote,setActiveQuote]=useState(null);const[quoteHistory,setQuoteHistory]=useState([]);useEffect(()=>{const token=localStorage.getItem('token');if(!token){navigate('/login');return;}fetchUserData();fetchOTCConfig();fetchQuoteHistory();},[navigate]);const fetchUserData=async()=>{try{const token=localStorage.getItem('token');const response=await axios.get(\"\".concat(API,\"/api/user/me\"),{headers:{Authorization:\"Bearer \".concat(token)}});if(response.data.success){setUserData(response.data.user);}setLoading(false);}catch(error){var _error$response;console.error('Error fetching user data:',error);setLoading(false);if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){navigate('/login');}}};const fetchOTCConfig=async()=>{try{const response=await axios.get(\"\".concat(API,\"/api/otc/config\"));if(response.data.success){setOtcConfig(response.data.config);}}catch(error){console.error('Error fetching OTC config:',error);alert('Failed to load OTC configuration');}};const fetchQuoteHistory=async()=>{try{const token=localStorage.getItem('token');const userId=localStorage.getItem('user_id');const response=await axios.get(\"\".concat(API,\"/api/otc/quotes/\").concat(userId),{headers:{Authorization:\"Bearer \".concat(token)}});if(response.data.success){setQuoteHistory(response.data.quotes||[]);}}catch(error){console.error('Error fetching quote history:',error);}};const handleCreateQuote=async()=>{if(!amountGBP||parseFloat(amountGBP)<=0){alert('Please enter a valid amount');return;}if(!otcConfig){alert('OTC configuration not loaded');return;}if(parseFloat(amountGBP)<otcConfig.otc_minimum_amount_gbp){alert(\"Minimum OTC trade amount is \\xA3\".concat(otcConfig.otc_minimum_amount_gbp.toLocaleString()));return;}setCreatingQuote(true);try{const userId=localStorage.getItem('user_id');const token=localStorage.getItem('token');const response=await axios.post(\"\".concat(API,\"/api/otc/quote\"),{user_id:userId,crypto_currency:selectedCrypto,fiat_currency:'GBP',amount_gbp:parseFloat(amountGBP),trade_type:tradeType},{headers:{Authorization:\"Bearer \".concat(token)}});if(response.data.success){setActiveQuote(response.data.quote);alert('Quote created successfully! Valid for 15 minutes.');fetchQuoteHistory();}}catch(error){var _error$response2,_error$response2$data;console.error('Error creating quote:',error);alert(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.detail)||'Failed to create quote');}finally{setCreatingQuote(false);}};const handleExecuteQuote=async()=>{if(!activeQuote)return;try{const userId=localStorage.getItem('user_id');const token=localStorage.getItem('token');const response=await axios.post(\"\".concat(API,\"/api/otc/execute\"),{quote_id:activeQuote.quote_id,user_id:userId},{headers:{Authorization:\"Bearer \".concat(token)}});if(response.data.success){alert('OTC trade executed successfully!');setActiveQuote(null);setAmountGBP('');fetchUserData();fetchQuoteHistory();}}catch(error){var _error$response3,_error$response3$data;console.error('Error executing OTC trade:',error);alert(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.detail)||'Failed to execute trade');}};if(loading){return/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',minHeight:'100vh',background:'#0A0E27'},children:/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'24px',color:'#00F0FF',fontWeight:'700'},children:\"Loading OTC Desk...\"})});}return/*#__PURE__*/_jsxs(\"div\",{style:{minHeight:'100vh',background:'linear-gradient(135deg, #0A0E27 0%, #1A1F3A 100%)',padding:'2rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'1400px',margin:'0 auto',marginBottom:'2rem'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/dashboard'),style:{background:'rgba(0, 240, 255, 0.1)',border:'1px solid rgba(0, 240, 255, 0.3)',color:'#00F0FF',padding:'0.75rem 1.5rem',borderRadius:'8px',cursor:'pointer',fontWeight:'700',marginBottom:'1rem'},children:\"\\u2190 Back to Dashboard\"}),/*#__PURE__*/_jsx(\"h1\",{style:{fontSize:'48px',fontWeight:'900',color:'#fff',margin:0,marginBottom:'0.5rem'},children:\"\\uD83C\\uDFE6 OTC Desk\"}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'18px',color:'#888',margin:0},children:\"Large-volume crypto trading with institutional pricing\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'1400px',margin:'0 auto',display:'grid',gridTemplateColumns:'1fr 1fr',gap:'2rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'16px',padding:'2rem'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#00F0FF',fontSize:'24px',fontWeight:'900',marginBottom:'1.5rem'},children:\"Create OTC Quote\"}),otcConfig&&/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(0, 240, 255, 0.05)',padding:'1rem',borderRadius:'8px',marginBottom:'1.5rem',border:'1px solid rgba(0, 240, 255, 0.2)'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'13px',color:'#888',marginBottom:'0.5rem'},children:\"Minimum Trade Amount\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'24px',fontWeight:'900',color:'#00F0FF'},children:[\"\\xA3\",otcConfig.otc_minimum_amount_gbp.toLocaleString()]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',color:'#888',marginTop:'0.5rem'},children:[\"Fee: \",otcConfig.otc_fee_percent,\"% \\u2022 Quote valid for 15 minutes\"]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',color:'#888',fontSize:'14px',fontWeight:'600',marginBottom:'0.5rem'},children:\"Trade Type\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setTradeType('buy'),style:{flex:1,padding:'1rem',background:tradeType==='buy'?'linear-gradient(135deg, #00F0FF, #A855F7)':'rgba(255, 255, 255, 0.05)',border:tradeType==='buy'?'none':'1px solid rgba(255, 255, 255, 0.1)',borderRadius:'8px',color:tradeType==='buy'?'#000':'#fff',fontWeight:'700',cursor:'pointer'},children:\"Buy Crypto\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setTradeType('sell'),style:{flex:1,padding:'1rem',background:tradeType==='sell'?'linear-gradient(135deg, #EF4444, #DC2626)':'rgba(255, 255, 255, 0.05)',border:tradeType==='sell'?'none':'1px solid rgba(255, 255, 255, 0.1)',borderRadius:'8px',color:'#fff',fontWeight:'700',cursor:'pointer'},children:\"Sell Crypto\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',color:'#888',fontSize:'14px',fontWeight:'600',marginBottom:'0.5rem'},children:\"Cryptocurrency\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedCrypto,onChange:e=>setSelectedCrypto(e.target.value),style:{width:'100%',padding:'1rem',background:'rgba(0, 0, 0, 0.3)',border:'1px solid rgba(0, 240, 255, 0.3)',borderRadius:'8px',color:'#fff',fontSize:'16px',fontWeight:'600'},children:otcConfig&&otcConfig.supported_currencies.map(currency=>/*#__PURE__*/_jsx(\"option\",{value:currency,children:currency},currency))})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',color:'#888',fontSize:'14px',fontWeight:'600',marginBottom:'0.5rem'},children:\"Amount (GBP)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:amountGBP,onChange:e=>setAmountGBP(e.target.value),placeholder:\"Enter amount in GBP\",style:{width:'100%',padding:'1rem',background:'rgba(0, 0, 0, 0.3)',border:'1px solid rgba(0, 240, 255, 0.3)',borderRadius:'8px',color:'#fff',fontSize:'18px',fontWeight:'700'}})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCreateQuote,disabled:creatingQuote,style:{width:'100%',padding:'1.25rem',background:creatingQuote?'rgba(0, 240, 255, 0.3)':'linear-gradient(135deg, #00F0FF, #A855F7)',border:'none',borderRadius:'8px',color:creatingQuote?'#888':'#000',fontSize:'18px',fontWeight:'900',cursor:creatingQuote?'not-allowed':'pointer'},children:creatingQuote?'Creating Quote...':'Get Quote'})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(168, 85, 247, 0.3)',borderRadius:'16px',padding:'2rem'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#A855F7',fontSize:'24px',fontWeight:'900',marginBottom:'1.5rem'},children:\"Active Quote\"}),activeQuote?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(168, 85, 247, 0.1)',padding:'1.5rem',borderRadius:'12px',marginBottom:'1.5rem',border:'1px solid rgba(168, 85, 247, 0.3)'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'#888',fontSize:'14px'},children:\"Trade Type\"}),/*#__PURE__*/_jsx(\"span\",{style:{color:'#fff',fontWeight:'700',textTransform:'uppercase'},children:activeQuote.trade_type})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'#888',fontSize:'14px'},children:\"Cryptocurrency\"}),/*#__PURE__*/_jsx(\"span\",{style:{color:'#00F0FF',fontWeight:'900',fontSize:'18px'},children:activeQuote.crypto_currency})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'#888',fontSize:'14px'},children:\"Crypto Amount\"}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#fff',fontWeight:'700'},children:[activeQuote.crypto_amount.toFixed(6),\" \",activeQuote.crypto_currency]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'#888',fontSize:'14px'},children:\"Price per Unit\"}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#fff',fontWeight:'700'},children:[\"\\xA3\",activeQuote.crypto_price_gbp.toFixed(2)]})]}),/*#__PURE__*/_jsx(\"div\",{style:{height:'1px',background:'rgba(255, 255, 255, 0.1)',margin:'1rem 0'}}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'#888',fontSize:'14px'},children:\"Base Amount\"}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#fff',fontWeight:'700'},children:[\"\\xA3\",activeQuote.gross_amount_gbp.toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginBottom:'1rem'},children:[/*#__PURE__*/_jsxs(\"span\",{style:{color:'#888',fontSize:'14px'},children:[\"Fee (\",activeQuote.fee_percent,\"%)\"]}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#EF4444',fontWeight:'700'},children:[\"\\xA3\",activeQuote.fee_amount_gbp.toFixed(2)]})]}),/*#__PURE__*/_jsx(\"div\",{style:{height:'1px',background:'rgba(255, 255, 255, 0.1)',margin:'1rem 0'}}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'#888',fontSize:'16px',fontWeight:'700'},children:activeQuote.trade_type==='buy'?'Total Cost':'You Receive'}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#00F0FF',fontWeight:'900',fontSize:'24px'},children:[\"\\xA3\",(activeQuote.trade_type==='buy'?activeQuote.total_cost_gbp:activeQuote.total_received_gbp).toFixed(2)]})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{background:'rgba(255, 165, 0, 0.1)',padding:'1rem',borderRadius:'8px',marginBottom:'1.5rem',border:'1px solid rgba(255, 165, 0, 0.3)'},children:/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'13px',color:'#FFA500'},children:\"\\u23F1\\uFE0F Quote expires in 15 minutes\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleExecuteQuote,style:{width:'100%',padding:'1.25rem',background:'linear-gradient(135deg, #22C55E, #16A34A)',border:'none',borderRadius:'8px',color:'#fff',fontSize:'18px',fontWeight:'900',cursor:'pointer'},children:\"\\u2713 Execute Trade\"})]}):/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',padding:'3rem 1rem',color:'#888'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'64px',marginBottom:'1rem'},children:\"\\uD83D\\uDCCB\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'16px'},children:\"No active quote\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'14px',marginTop:'0.5rem'},children:\"Create a quote to get started\"})]})]})]}),quoteHistory.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'1400px',margin:'2rem auto 0',background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'16px',padding:'2rem'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#00F0FF',fontSize:'24px',fontWeight:'900',marginBottom:'1.5rem'},children:\"Quote History\"}),/*#__PURE__*/_jsx(\"div\",{style:{overflowX:'auto'},children:/*#__PURE__*/_jsxs(\"table\",{style:{width:'100%',borderCollapse:'collapse'},children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{style:{borderBottom:'2px solid rgba(0, 240, 255, 0.3)'},children:[/*#__PURE__*/_jsx(\"th\",{style:{padding:'1rem',textAlign:'left',color:'#888',fontSize:'13px',fontWeight:'700',textTransform:'uppercase'},children:\"Type\"}),/*#__PURE__*/_jsx(\"th\",{style:{padding:'1rem',textAlign:'left',color:'#888',fontSize:'13px',fontWeight:'700',textTransform:'uppercase'},children:\"Crypto\"}),/*#__PURE__*/_jsx(\"th\",{style:{padding:'1rem',textAlign:'right',color:'#888',fontSize:'13px',fontWeight:'700',textTransform:'uppercase'},children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{style:{padding:'1rem',textAlign:'right',color:'#888',fontSize:'13px',fontWeight:'700',textTransform:'uppercase'},children:\"Total\"}),/*#__PURE__*/_jsx(\"th\",{style:{padding:'1rem',textAlign:'center',color:'#888',fontSize:'13px',fontWeight:'700',textTransform:'uppercase'},children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{style:{padding:'1rem',textAlign:'right',color:'#888',fontSize:'13px',fontWeight:'700',textTransform:'uppercase'},children:\"Date\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:quoteHistory.map((quote,index)=>/*#__PURE__*/_jsxs(\"tr\",{style:{borderBottom:'1px solid rgba(255, 255, 255, 0.05)'},children:[/*#__PURE__*/_jsx(\"td\",{style:{padding:'1rem',color:'#fff',fontWeight:'700',textTransform:'uppercase'},children:/*#__PURE__*/_jsx(\"span\",{style:{padding:'0.25rem 0.75rem',borderRadius:'4px',background:quote.trade_type==='buy'?'rgba(34, 197, 94, 0.2)':'rgba(239, 68, 68, 0.2)',color:quote.trade_type==='buy'?'#22C55E':'#EF4444'},children:quote.trade_type})}),/*#__PURE__*/_jsx(\"td\",{style:{padding:'1rem',color:'#00F0FF',fontWeight:'700'},children:quote.crypto_currency}),/*#__PURE__*/_jsx(\"td\",{style:{padding:'1rem',textAlign:'right',color:'#fff',fontWeight:'600'},children:quote.crypto_amount.toFixed(6)}),/*#__PURE__*/_jsxs(\"td\",{style:{padding:'1rem',textAlign:'right',color:'#fff',fontWeight:'700'},children:[\"\\xA3\",(quote.total_cost_gbp||quote.total_received_gbp||0).toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{style:{padding:'1rem',textAlign:'center'},children:/*#__PURE__*/_jsx(\"span\",{style:{padding:'0.25rem 0.75rem',borderRadius:'4px',fontSize:'12px',fontWeight:'700',background:quote.status==='completed'?'rgba(34, 197, 94, 0.2)':quote.status==='expired'?'rgba(255, 165, 0, 0.2)':'rgba(168, 85, 247, 0.2)',color:quote.status==='completed'?'#22C55E':quote.status==='expired'?'#FFA500':'#A855F7'},children:quote.status})}),/*#__PURE__*/_jsx(\"td\",{style:{padding:'1rem',textAlign:'right',color:'#888',fontSize:'14px'},children:new Date(quote.created_at).toLocaleDateString()})]},index))})]})})]})]});}export default OTCDesk;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}