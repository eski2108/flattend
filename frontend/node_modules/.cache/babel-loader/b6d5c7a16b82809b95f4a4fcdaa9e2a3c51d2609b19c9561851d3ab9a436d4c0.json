{"ast":null,"code":"import React,{useState,useEffect}from'react';import{IoClose,IoRefresh,IoShield,RefreshCw}from'react-icons/io5';import axios from'axios';import{toast}from'sonner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;export default function OTPModal(_ref){let{isOpen,onClose,onVerify,title='Verify OTP',description='Enter the 6-digit code sent to your email',userId,action='generic'}=_ref;const[otp,setOtp]=useState(['','','','','','']);const[loading,setLoading]=useState(false);const[sendingOTP,setSendingOTP]=useState(false);const[countdown,setCountdown]=useState(0);useEffect(()=>{if(countdown>0){const timer=setTimeout(()=>setCountdown(countdown-1),1000);return()=>clearTimeout(timer);}},[countdown]);useEffect(()=>{if(isOpen&&userId){sendOTP();}},[isOpen,userId]);const sendOTP=async()=>{if(!userId){toast.error('User ID required');return;}setSendingOTP(true);try{const response=await axios.post(\"\".concat(API,\"/api/auth/send-otp\"),{user_id:userId,action:action});if(response.data.success){toast.success('OTP sent to your email');setCountdown(60);}else{toast.error(response.data.message||'Failed to send OTP');}}catch(error){var _error$response,_error$response$data;console.error('Error sending OTP:',error);toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Failed to send OTP');}finally{setSendingOTP(false);}};const handleOTPChange=(index,value)=>{if(value.length>1){value=value.slice(-1);}if(!/^\\d*$/.test(value)){return;}const newOtp=[...otp];newOtp[index]=value;setOtp(newOtp);// Auto-focus next input\nif(value&&index<5){const nextInput=document.getElementById(\"otp-\".concat(index+1));if(nextInput)nextInput.focus();}};const handleKeyDown=(index,e)=>{if(e.key==='Backspace'&&!otp[index]&&index>0){const prevInput=document.getElementById(\"otp-\".concat(index-1));if(prevInput)prevInput.focus();}};const handleVerify=async()=>{const otpCode=otp.join('');if(otpCode.length!==6){toast.error('Please enter all 6 digits');return;}setLoading(true);try{const response=await axios.post(\"\".concat(API,\"/api/auth/verify-otp\"),{user_id:userId,otp_code:otpCode,action:action});if(response.data.success){toast.success('OTP verified successfully');onVerify(otpCode);handleClose();}else{var _document$getElementB;toast.error(response.data.message||'Invalid OTP');setOtp(['','','','','','']);(_document$getElementB=document.getElementById('otp-0'))===null||_document$getElementB===void 0?void 0:_document$getElementB.focus();}}catch(error){var _error$response2,_error$response2$data,_document$getElementB2;console.error('Error verifying OTP:',error);toast.error(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Invalid OTP');setOtp(['','','','','','']);(_document$getElementB2=document.getElementById('otp-0'))===null||_document$getElementB2===void 0?void 0:_document$getElementB2.focus();}finally{setLoading(false);}};const handleClose=()=>{setOtp(['','','','','','']);setCountdown(0);onClose();};if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,backgroundColor:'rgba(0, 0, 0, 0.8)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:9999,backdropFilter:'blur(8px)'},onClick:handleClose,children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'linear-gradient(135deg, rgba(2, 6, 24, 0.98) 0%, rgba(7, 19, 39, 0.95) 100%)',borderRadius:'24px',padding:'2.5rem',width:'90%',maxWidth:'500px',border:'2px solid rgba(0, 240, 255, 0.4)',boxShadow:'0 0 60px rgba(0, 240, 255, 0.4), 0 20px 80px rgba(0, 0, 0, 0.8)'},onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.75rem'},children:[/*#__PURE__*/_jsx(IoShield,{size:28,color:\"#00F0FF\",strokeWidth:2.5}),/*#__PURE__*/_jsx(\"h2\",{style:{color:'#fff',fontSize:'1.75rem',fontWeight:'700',margin:0},children:title})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleClose,style:{background:'none',border:'none',color:'#9FA6B2',cursor:'pointer',padding:'0.5rem',display:'flex',alignItems:'center',justifyContent:'center',borderRadius:'8px',transition:'all 0.2s'},onMouseEnter:e=>{e.currentTarget.style.backgroundColor='rgba(255, 255, 255, 0.1)';e.currentTarget.style.color='#fff';},onMouseLeave:e=>{e.currentTarget.style.backgroundColor='transparent';e.currentTarget.style.color='#9FA6B2';},children:/*#__PURE__*/_jsx(IoClose,{size:24})})]}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#8F9BB3',fontSize:'0.9375rem',marginBottom:'2rem',lineHeight:'1.6'},children:description}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:'0.75rem',justifyContent:'center',marginBottom:'2rem'},children:otp.map((digit,index)=>/*#__PURE__*/_jsx(\"input\",{id:\"otp-\".concat(index),type:\"text\",inputMode:\"numeric\",maxLength:\"1\",value:digit,onChange:e=>handleOTPChange(index,e.target.value),onKeyDown:e=>handleKeyDown(index,e),style:{width:'3.5rem',height:'4rem',fontSize:'1.75rem',fontWeight:'700',textAlign:'center',backgroundColor:'rgba(0, 0, 0, 0.4)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'14px',color:'#00F0FF',outline:'none',transition:'all 0.3s',fontFamily:'monospace'},onFocus:e=>{e.currentTarget.style.borderColor='#00F0FF';e.currentTarget.style.boxShadow='0 0 20px rgba(0, 240, 255, 0.5)';e.currentTarget.style.transform='scale(1.05)';},onBlur:e=>{e.currentTarget.style.borderColor='rgba(0, 240, 255, 0.3)';e.currentTarget.style.boxShadow='none';e.currentTarget.style.transform='scale(1)';}},index))}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',marginBottom:'2rem'},children:countdown>0?/*#__PURE__*/_jsxs(\"p\",{style:{color:'#8F9BB3',fontSize:'0.9375rem'},children:[\"Resend OTP in \",/*#__PURE__*/_jsxs(\"span\",{style:{color:'#00F0FF',fontWeight:'700'},children:[countdown,\"s\"]})]}):/*#__PURE__*/_jsxs(\"button\",{onClick:sendOTP,disabled:sendingOTP,style:{background:'none',border:'1px solid rgba(0, 240, 255, 0.3)',color:'#00F0FF',fontSize:'0.9375rem',fontWeight:'600',cursor:'pointer',display:'flex',alignItems:'center',gap:'0.5rem',margin:'0 auto',padding:'0.75rem 1.5rem',borderRadius:'12px',transition:'all 0.3s'},onMouseEnter:e=>{e.currentTarget.style.backgroundColor='rgba(0, 240, 255, 0.1)';e.currentTarget.style.borderColor='rgba(0, 240, 255, 0.6)';e.currentTarget.style.boxShadow='0 0 20px rgba(0, 240, 255, 0.3)';},onMouseLeave:e=>{e.currentTarget.style.backgroundColor='transparent';e.currentTarget.style.borderColor='rgba(0, 240, 255, 0.3)';e.currentTarget.style.boxShadow='none';},children:[/*#__PURE__*/_jsx(IoRefresh,{size:18,style:{animation:sendingOTP?'spin 1s linear infinite':'none'}}),sendingOTP?'Sending...':'Resend OTP']})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleVerify,disabled:loading||otp.join('').length!==6,style:{width:'100%',padding:'1.125rem',background:otp.join('').length===6?'linear-gradient(135deg, #00F0FF, #0080FF)':'rgba(40, 40, 40, 0.5)',color:'#fff',border:'none',borderRadius:'14px',fontSize:'1.0625rem',fontWeight:'700',cursor:otp.join('').length===6?'pointer':'not-allowed',opacity:otp.join('').length===6?1:0.4,transition:'all 0.3s',boxShadow:otp.join('').length===6?'0 0 30px rgba(0, 240, 255, 0.4)':'none',position:'relative',overflow:'hidden'},onMouseEnter:e=>{if(otp.join('').length===6){e.currentTarget.style.transform='translateY(-2px)';e.currentTarget.style.boxShadow='0 0 40px rgba(0, 240, 255, 0.6)';}},onMouseLeave:e=>{e.currentTarget.style.transform='translateY(0)';e.currentTarget.style.boxShadow=otp.join('').length===6?'0 0 30px rgba(0, 240, 255, 0.4)':'none';},children:loading?'Verifying...':'Verify OTP'}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n          @keyframes spin {\\n            from { transform: rotate(0deg); }\\n            to { transform: rotate(360deg); }\\n          }\\n        \"})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}