{"ast":null,"code":"import _objectSpread from\"/app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{useParams,useNavigate}from'react-router-dom';import{IoArrowBack,IoChatbubbles,IoCheckmark,IoCheckmarkCircle,IoClose as X,IoCloseCircle,IoCopy,IoInformationCircle,IoSend,IoShield,IoTime,IoWarning}from'react-icons/io5';import axios from'axios';import{toast}from'sonner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BACKEND_URL=process.env.REACT_APP_BACKEND_URL;const API=BACKEND_URL;export default function TradePageNew(){var _trade$price_per_unit,_ref2,_trade$payment_method;const{tradeId}=useParams();const navigate=useNavigate();const messagesEndRef=useRef(null);const[user,setUser]=useState(null);const[trade,setTrade]=useState(null);const[seller,setSeller]=useState(null);const[loading,setLoading]=useState(true);const[timeLeft,setTimeLeft]=useState(0);const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[sendingMessage,setSendingMessage]=useState(false);const[copied,setCopied]=useState({});const isBuyer=trade&&user&&trade.buyer_id===user.user_id;const isSeller=trade&&user&&trade.seller_id===user.user_id;useEffect(()=>{const userData=JSON.parse(localStorage.getItem('cryptobank_user')||'{}');if(!userData.user_id){toast.error('Please log in');navigate('/login');return;}setUser(userData);loadTradeDetails();loadMessages();const interval=setInterval(()=>{loadTradeDetails();loadMessages();},5000);return()=>clearInterval(interval);},[tradeId]);useEffect(()=>{if(timeLeft<=0)return;const timer=setInterval(()=>{setTimeLeft(prev=>Math.max(0,prev-1));},1000);return()=>clearInterval(timer);},[timeLeft]);useEffect(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},[messages]);const loadTradeDetails=async()=>{try{const response=await axios.get(\"\".concat(API,\"/api/p2p/trade/\").concat(tradeId));setTrade(response.data.trade);setSeller(response.data.seller);setTimeLeft(response.data.time_remaining_seconds||0);setLoading(false);}catch(error){console.error('Failed to load trade:',error);toast.error('Failed to load trade details');}};const loadMessages=async()=>{try{const response=await axios.get(\"\".concat(API,\"/api/p2p/trade/\").concat(tradeId,\"/messages\"));setMessages(response.data.messages||[]);}catch(error){console.error('Failed to load messages:',error);}};const handleCopy=(text,key)=>{navigator.clipboard.writeText(text);setCopied(_objectSpread(_objectSpread({},copied),{},{[key]:true}));toast.success('Copied to clipboard');setTimeout(()=>setCopied(_objectSpread(_objectSpread({},copied),{},{[key]:false})),2000);};const formatTime=seconds=>{const mins=Math.floor(seconds/60);const secs=seconds%60;return\"\".concat(mins,\":\").concat(secs.toString().padStart(2,'0'));};const handleMarkAsPaid=async()=>{if(!window.confirm('âš ï¸ IMPORTANT: Have you transferred the payment to the seller?\\n\\nOnly click YES if you have actually sent the money.')){return;}try{await axios.post(\"\".concat(API,\"/api/p2p/mark-paid\"),{trade_id:tradeId,buyer_id:user.user_id});toast.success('âœ… Payment marked as sent! Waiting for seller confirmation.');await loadTradeDetails();}catch(error){var _error$response,_error$response$data;toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.detail)||'Failed to mark as paid');}};const handleReleaseCrypto=async()=>{if(!window.confirm('âš ï¸ IMPORTANT: Have you received the payment in your bank account?\\n\\nThis will release the crypto from escrow to the buyer.')){return;}try{await axios.post(\"\".concat(API,\"/api/p2p/release-crypto\"),{trade_id:tradeId,seller_id:user.user_id});toast.success('âœ… Crypto released successfully!');await loadTradeDetails();}catch(error){var _error$response2,_error$response2$data;toast.error(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.detail)||'Failed to release crypto');}};const handleDispute=async()=>{const reason=prompt('Please describe the issue with this trade:');if(!reason||reason.trim().length<10){toast.error('Please provide a detailed reason (minimum 10 characters)');return;}try{await axios.post(\"\".concat(API,\"/api/p2p/raise-dispute\"),{trade_id:tradeId,user_id:user.user_id,reason:reason.trim()});toast.success('ðŸ›¡ï¸ Dispute raised! Our support team will review shortly.');await loadTradeDetails();}catch(error){var _error$response3,_error$response3$data;toast.error(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.detail)||'Failed to raise dispute');}};const handleSendMessage=async()=>{if(!newMessage.trim())return;setSendingMessage(true);try{await axios.post(\"\".concat(API,\"/api/p2p/trade/\").concat(tradeId,\"/message\"),{user_id:user.user_id,message:newMessage.trim()});setNewMessage('');await loadMessages();}catch(error){toast.error('Failed to send message');}finally{setSendingMessage(false);}};const getStatusInfo=()=>{if(!trade)return{text:'',color:'',icon:null,step:0};switch(trade.status){case'pending_payment':return{text:'Waiting for Payment',color:'#F59E0B',icon:/*#__PURE__*/_jsx(IoTime,{size:20}),step:1};case'payment_sent':return{text:'Payment Sent - Awaiting Confirmation',color:'#3B82F6',icon:/*#__PURE__*/_jsx(IoTime,{size:20}),step:2};case'completed':return{text:'Trade Completed',color:'#22C55E',icon:/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:20}),step:3};case'disputed':return{text:'Under Dispute',color:'#EF4444',icon:/*#__PURE__*/_jsx(IoWarning,{size:20}),step:0};case'cancelled':return{text:'Trade Cancelled',color:'#888',icon:/*#__PURE__*/_jsx(IoCloseCircle,{size:20}),step:0};default:return{text:'Unknown Status',color:'#888',icon:/*#__PURE__*/_jsx(IoInformationCircle,{size:20}),step:0};}};if(loading){return/*#__PURE__*/_jsx(\"div\",{style:{minHeight:'100vh',background:'linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%)',display:'flex',alignItems:'center',justifyContent:'center'},children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner\",style:{border:'4px solid rgba(0, 240, 255, 0.1)',borderTop:'4px solid #00F0FF',borderRadius:'50%',width:'60px',height:'60px',animation:'spin 1s linear infinite'}})});}const statusInfo=getStatusInfo();return/*#__PURE__*/_jsx(\"div\",{style:{minHeight:'100vh',background:'linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%)',padding:'2rem'},children:/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'1400px',margin:'0 auto'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'2rem'},children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/my-orders'),style:{display:'flex',alignItems:'center',gap:'0.5rem',background:'none',border:'none',color:'#00F0FF',fontSize:'14px',fontWeight:'600',cursor:'pointer',marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(IoArrowBack,{size:16}),\"Back to Orders\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h1\",{style:{fontSize:'28px',fontWeight:'900',color:'#fff',marginBottom:'0.5rem'},children:[\"Trade Order #\",tradeId.substring(0,8)]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'1rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem',background:statusInfo.color+'20',border:\"2px solid \".concat(statusInfo.color),borderRadius:'8px',padding:'6px 16px',color:statusInfo.color,fontSize:'14px',fontWeight:'700'},children:[statusInfo.icon,statusInfo.text]}),/*#__PURE__*/_jsx(\"div\",{style:{background:'rgba(0, 240, 255, 0.1)',border:'1px solid rgba(0, 240, 255, 0.3)',borderRadius:'8px',padding:'6px 16px',color:'#00F0FF',fontSize:'13px',fontWeight:'600'},children:\"\\uD83D\\uDEE1\\uFE0F Escrow Protected\"})]})]}),(trade===null||trade===void 0?void 0:trade.status)==='pending_payment'&&timeLeft>0&&/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',background:timeLeft<300?'rgba(239, 68, 68, 0.2)':'rgba(0, 240, 255, 0.2)',border:\"2px solid \".concat(timeLeft<300?'#EF4444':'#00F0FF'),borderRadius:'12px',padding:'1rem 2rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#888',marginBottom:'4px',textTransform:'uppercase'},children:\"Time Remaining\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'32px',fontWeight:'900',color:timeLeft<300?'#EF4444':'#00F0FF',fontFamily:'monospace'},children:formatTime(timeLeft)}),timeLeft<300&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'11px',color:'#EF4444',marginTop:'4px'},children:\"\\u26A0\\uFE0F Hurry! Time running out\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(0, 240, 255, 0.2)',borderRadius:'16px',padding:'2rem',marginBottom:'2rem'},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',position:'relative'},children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:'20px',left:'10%',right:'10%',height:'4px',background:'rgba(0, 240, 255, 0.1)',zIndex:0},children:/*#__PURE__*/_jsx(\"div\",{style:{height:'100%',background:'linear-gradient(90deg, #00F0FF, #A855F7)',width:statusInfo.step===3?'100%':statusInfo.step===2?'50%':'0%',transition:'width 0.5s ease'}})}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,textAlign:'center',position:'relative',zIndex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'40px',height:'40px',borderRadius:'50%',background:statusInfo.step>=1?'linear-gradient(135deg, #00F0FF, #A855F7)':'rgba(0, 0, 0, 0.4)',border:\"3px solid \".concat(statusInfo.step>=1?'#00F0FF':'#444'),display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 0.75rem',fontWeight:'900',color:statusInfo.step>=1?'#000':'#666'},children:statusInfo.step>=1?'âœ“':'1'}),/*#__PURE__*/_jsx(\"div\",{style:{color:statusInfo.step>=1?'#00F0FF':'#666',fontSize:'14px',fontWeight:'600'},children:\"Order Created\"}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'12px',marginTop:'4px'},children:\"Crypto locked in escrow\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,textAlign:'center',position:'relative',zIndex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'40px',height:'40px',borderRadius:'50%',background:statusInfo.step>=2?'linear-gradient(135deg, #00F0FF, #A855F7)':'rgba(0, 0, 0, 0.4)',border:\"3px solid \".concat(statusInfo.step>=2?'#00F0FF':'#444'),display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 0.75rem',fontWeight:'900',color:statusInfo.step>=2?'#000':'#666'},children:statusInfo.step>=2?'âœ“':'2'}),/*#__PURE__*/_jsx(\"div\",{style:{color:statusInfo.step>=2?'#00F0FF':'#666',fontSize:'14px',fontWeight:'600'},children:\"Payment Made\"}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'12px',marginTop:'4px'},children:\"Buyer confirms payment\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,textAlign:'center',position:'relative',zIndex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'40px',height:'40px',borderRadius:'50%',background:statusInfo.step>=3?'linear-gradient(135deg, #22C55E, #16A34A)':'rgba(0, 0, 0, 0.4)',border:\"3px solid \".concat(statusInfo.step>=3?'#22C55E':'#444'),display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 0.75rem',fontWeight:'900',color:statusInfo.step>=3?'#fff':'#666'},children:statusInfo.step>=3?'âœ“':'3'}),/*#__PURE__*/_jsx(\"div\",{style:{color:statusInfo.step>=3?'#22C55E':'#666',fontSize:'14px',fontWeight:'600'},children:\"Completed\"}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'12px',marginTop:'4px'},children:\"Crypto released to buyer\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'2fr 1fr',gap:'2rem'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(0, 240, 255, 0.2)',borderRadius:'16px',padding:'2rem',marginBottom:'2rem'},children:[/*#__PURE__*/_jsxs(\"h2\",{style:{fontSize:'20px',fontWeight:'900',color:'#00F0FF',marginBottom:'1.5rem',display:'flex',alignItems:'center',gap:'0.5rem'},children:[/*#__PURE__*/_jsx(IoInformationCircle,{size:20}),isBuyer?'Payment Instructions':'Seller Instructions']}),isBuyer&&(trade===null||trade===void 0?void 0:trade.status)==='pending_payment'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(245, 158, 11, 0.1)',border:'2px solid #F59E0B',borderRadius:'12px',padding:'1rem',marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem',color:'#F59E0B',fontWeight:'700',marginBottom:'0.5rem'},children:[/*#__PURE__*/_jsx(IoWarning,{size:18}),\"Important Steps\"]}),/*#__PURE__*/_jsxs(\"ol\",{style:{color:'#fff',fontSize:'14px',lineHeight:'1.8',paddingLeft:'1.5rem',margin:0},children:[/*#__PURE__*/_jsx(\"li\",{children:\"Transfer the exact amount to the seller's payment details below\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Keep proof of payment (screenshot/receipt)\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Click \\\"I Have Paid\\\" button after making the transfer\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Wait for seller to confirm and release crypto\"}),/*#__PURE__*/_jsx(\"li\",{children:\"If any issues, click \\\"Raise Dispute\\\" button\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(0, 0, 0, 0.4)',borderRadius:'12px',padding:'1.5rem'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{color:'#00F0FF',fontSize:'16px',fontWeight:'700',marginBottom:'1rem'},children:\"Seller Payment Details\"}),(seller===null||seller===void 0?void 0:seller.payment_details)&&Object.entries(seller.payment_details).map(_ref=>{let[key,value]=_ref;return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'13px',marginBottom:'4px',textTransform:'capitalize'},children:key.replace(/_/g,' ')}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem',background:'rgba(0, 240, 255, 0.1)',border:'1px solid rgba(0, 240, 255, 0.3)',borderRadius:'8px',padding:'0.75rem 1rem'},children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'#fff',fontSize:'15px',fontWeight:'600',flex:1},children:value}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleCopy(value,key),style:{background:'none',border:'none',color:copied[key]?'#22C55E':'#00F0FF',cursor:'pointer',padding:'4px'},children:copied[key]?/*#__PURE__*/_jsx(IoCheckmark,{size:18}):/*#__PURE__*/_jsx(IoCopy,{size:18})})]})]},key);})]})]}),isBuyer&&(trade===null||trade===void 0?void 0:trade.status)==='payment_sent'&&/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(59, 130, 246, 0.1)',border:'2px solid #3B82F6',borderRadius:'12px',padding:'1.5rem',textAlign:'center'},children:[/*#__PURE__*/_jsx(IoTime,{size:48,color:\"#3B82F6\",style:{margin:'0 auto 1rem'}}),/*#__PURE__*/_jsx(\"h3\",{style:{color:'#3B82F6',fontSize:'18px',fontWeight:'700',marginBottom:'0.5rem'},children:\"Payment Confirmed\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#888',fontSize:'14px'},children:\"Waiting for seller to release crypto from escrow\"})]}),isSeller&&(trade===null||trade===void 0?void 0:trade.status)==='pending_payment'&&/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(245, 158, 11, 0.1)',border:'2px solid #F59E0B',borderRadius:'12px',padding:'1rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem',color:'#F59E0B',fontWeight:'700',marginBottom:'0.5rem'},children:[/*#__PURE__*/_jsx(IoTime,{size:18}),\"Waiting for buyer to make payment\"]}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#888',fontSize:'14px',margin:0},children:\"The buyer will transfer funds to your payment details. Once received, release the crypto.\"})]}),isSeller&&(trade===null||trade===void 0?void 0:trade.status)==='payment_sent'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(34, 197, 94, 0.1)',border:'2px solid #22C55E',borderRadius:'12px',padding:'1rem',marginBottom:'1rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem',color:'#22C55E',fontWeight:'700',marginBottom:'0.5rem'},children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:18}),\"Buyer has marked payment as sent\"]}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#888',fontSize:'14px',margin:0},children:\"Check your bank account. Once you confirm receiving the payment, release the crypto.\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(239, 68, 68, 0.1)',border:'2px solid #EF4444',borderRadius:'12px',padding:'1rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem',color:'#EF4444',fontWeight:'700',marginBottom:'0.5rem'},children:[/*#__PURE__*/_jsx(IoWarning,{size:18}),\"Important Warning\"]}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#fff',fontSize:'14px',margin:0},children:\"Only release crypto after confirming the full amount is in YOUR bank account. Do not release based on screenshots.\"})]})]}),(trade===null||trade===void 0?void 0:trade.status)==='completed'&&/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(34, 197, 94, 0.1)',border:'2px solid #22C55E',borderRadius:'12px',padding:'2rem',textAlign:'center'},children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:64,color:\"#22C55E\",style:{margin:'0 auto 1rem'}}),/*#__PURE__*/_jsx(\"h3\",{style:{color:'#22C55E',fontSize:'22px',fontWeight:'900',marginBottom:'0.5rem'},children:\"Trade Completed Successfully! \\uD83C\\uDF89\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#888',fontSize:'14px'},children:isBuyer?'Crypto has been released to your wallet':'Payment received and crypto released'})]}),(trade===null||trade===void 0?void 0:trade.status)==='disputed'&&/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(239, 68, 68, 0.1)',border:'2px solid #EF4444',borderRadius:'12px',padding:'1.5rem',textAlign:'center'},children:[/*#__PURE__*/_jsx(IoShield,{size:48,color:\"#EF4444\",style:{margin:'0 auto 1rem'}}),/*#__PURE__*/_jsx(\"h3\",{style:{color:'#EF4444',fontSize:'18px',fontWeight:'700',marginBottom:'0.5rem'},children:\"Trade Under Dispute\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#888',fontSize:'14px'},children:\"Our support team is reviewing this case. You will be notified of the resolution.\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(0, 240, 255, 0.2)',borderRadius:'16px',padding:'2rem',height:'400px',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsxs(\"h2\",{style:{fontSize:'18px',fontWeight:'900',color:'#00F0FF',marginBottom:'1rem',display:'flex',alignItems:'center',gap:'0.5rem'},children:[/*#__PURE__*/_jsx(IoChatbubbles,{size:20}),\"Trade Chat\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,overflowY:'auto',marginBottom:'1rem',display:'flex',flexDirection:'column',gap:'0.75rem'},children:[messages.length===0?/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',color:'#888',padding:'2rem',fontSize:'14px'},children:\"No messages yet. Start the conversation!\"}):messages.map((msg,idx)=>/*#__PURE__*/_jsx(\"div\",{style:{alignSelf:msg.user_id===user.user_id?'flex-end':'flex-start',maxWidth:'70%'},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:msg.user_id===user.user_id?'linear-gradient(135deg, #00F0FF, #00B8E6)':'rgba(0, 0, 0, 0.4)',border:msg.user_id===user.user_id?'none':'1px solid rgba(255, 255, 255, 0.1)',borderRadius:'12px',padding:'0.75rem 1rem',color:msg.user_id===user.user_id?'#000':'#fff'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'11px',marginBottom:'4px',opacity:0.7},children:msg.user_id===user.user_id?'You':isBuyer?'Seller':'Buyer'}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'14px',wordBreak:'break-word'},children:msg.message}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'10px',marginTop:'4px',opacity:0.6,textAlign:'right'},children:new Date(msg.created_at).toLocaleTimeString()})]})},idx)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.5rem'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newMessage,onChange:e=>setNewMessage(e.target.value),onKeyPress:e=>e.key==='Enter'&&handleSendMessage(),placeholder:\"Type a message...\",style:{flex:1,background:'rgba(0, 0, 0, 0.4)',border:'1px solid rgba(0, 240, 255, 0.3)',borderRadius:'8px',padding:'0.75rem 1rem',color:'#fff',fontSize:'14px'},disabled:sendingMessage}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleSendMessage,disabled:sendingMessage||!newMessage.trim(),style:{background:sendingMessage||!newMessage.trim()?'rgba(100, 100, 100, 0.3)':'linear-gradient(135deg, #00F0FF, #A855F7)',border:'none',borderRadius:'8px',padding:'0.75rem 1.5rem',color:sendingMessage||!newMessage.trim()?'#666':'#000',cursor:sendingMessage||!newMessage.trim()?'not-allowed':'pointer',fontWeight:'700',display:'flex',alignItems:'center',gap:'0.5rem'},children:[/*#__PURE__*/_jsx(IoSend,{size:16}),\"Send\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(0, 240, 255, 0.2)',borderRadius:'16px',padding:'2rem',marginBottom:'2rem'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{fontSize:'18px',fontWeight:'900',color:'#00F0FF',marginBottom:'1.5rem'},children:\"Trade Summary\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',gap:'1rem'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'13px',marginBottom:'4px'},children:\"Amount\"}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#fff',fontSize:'24px',fontWeight:'900'},children:[trade===null||trade===void 0?void 0:trade.crypto_amount,\" \",trade===null||trade===void 0?void 0:trade.crypto_currency]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{borderTop:'1px solid rgba(255, 255, 255, 0.1)',paddingTop:'1rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'13px',marginBottom:'4px'},children:\"Price\"}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#fff',fontSize:'20px',fontWeight:'700'},children:[\"\\xA3\",trade===null||trade===void 0?void 0:(_trade$price_per_unit=trade.price_per_unit)===null||_trade$price_per_unit===void 0?void 0:_trade$price_per_unit.toFixed(2),\" / \",trade===null||trade===void 0?void 0:trade.crypto_currency]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{borderTop:'1px solid rgba(255, 255, 255, 0.1)',paddingTop:'1rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'13px',marginBottom:'4px'},children:\"Total Amount\"}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#00F0FF',fontSize:'28px',fontWeight:'900'},children:[\"\\xA3\",(_ref2=(trade===null||trade===void 0?void 0:trade.crypto_amount)*(trade===null||trade===void 0?void 0:trade.price_per_unit))===null||_ref2===void 0?void 0:_ref2.toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{borderTop:'1px solid rgba(255, 255, 255, 0.1)',paddingTop:'1rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'13px',marginBottom:'4px'},children:\"Payment Method\"}),/*#__PURE__*/_jsx(\"div\",{style:{background:'rgba(0, 240, 255, 0.1)',border:'1px solid rgba(0, 240, 255, 0.3)',borderRadius:'8px',padding:'0.75rem 1rem',color:'#00F0FF',fontSize:'15px',fontWeight:'600'},children:trade===null||trade===void 0?void 0:(_trade$payment_method=trade.payment_method)===null||_trade$payment_method===void 0?void 0:_trade$payment_method.replace(/_/g,' ').toUpperCase()})]}),/*#__PURE__*/_jsxs(\"div\",{style:{borderTop:'1px solid rgba(255, 255, 255, 0.1)',paddingTop:'1rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'13px',marginBottom:'4px'},children:isBuyer?'Seller':'Buyer'}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#fff',fontSize:'16px',fontWeight:'600'},children:isBuyer?seller===null||seller===void 0?void 0:seller.full_name:trade===null||trade===void 0?void 0:trade.buyer_name})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(0, 240, 255, 0.2)',borderRadius:'16px',padding:'2rem'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{fontSize:'18px',fontWeight:'900',color:'#00F0FF',marginBottom:'1.5rem'},children:\"Actions\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',gap:'1rem'},children:[isBuyer&&(trade===null||trade===void 0?void 0:trade.status)==='pending_payment'&&/*#__PURE__*/_jsx(\"button\",{onClick:handleMarkAsPaid,style:{background:'linear-gradient(135deg, #22C55E, #16A34A)',border:'none',borderRadius:'12px',padding:'1rem',color:'#fff',fontSize:'16px',fontWeight:'900',cursor:'pointer',boxShadow:'0 0 20px rgba(34, 197, 94, 0.4)',transition:'all 0.3s'},onMouseEnter:e=>{e.currentTarget.style.transform='translateY(-2px)';e.currentTarget.style.boxShadow='0 0 30px rgba(34, 197, 94, 0.6)';},onMouseLeave:e=>{e.currentTarget.style.transform='translateY(0)';e.currentTarget.style.boxShadow='0 0 20px rgba(34, 197, 94, 0.4)';},children:\"\\u2705 I Have Paid\"}),isSeller&&(trade===null||trade===void 0?void 0:trade.status)==='payment_sent'&&/*#__PURE__*/_jsx(\"button\",{onClick:handleReleaseCrypto,style:{background:'linear-gradient(135deg, #22C55E, #16A34A)',border:'none',borderRadius:'12px',padding:'1rem',color:'#fff',fontSize:'16px',fontWeight:'900',cursor:'pointer',boxShadow:'0 0 20px rgba(34, 197, 94, 0.4)',transition:'all 0.3s'},onMouseEnter:e=>{e.currentTarget.style.transform='translateY(-2px)';e.currentTarget.style.boxShadow='0 0 30px rgba(34, 197, 94, 0.6)';},onMouseLeave:e=>{e.currentTarget.style.transform='translateY(0)';e.currentTarget.style.boxShadow='0 0 20px rgba(34, 197, 94, 0.4)';},children:\"\\uD83D\\uDE80 Release Crypto\"}),(trade===null||trade===void 0?void 0:trade.status)!=='completed'&&(trade===null||trade===void 0?void 0:trade.status)!=='disputed'&&/*#__PURE__*/_jsxs(\"button\",{onClick:handleDispute,style:{background:'rgba(239, 68, 68, 0.2)',border:'2px solid #EF4444',borderRadius:'12px',padding:'1rem',color:'#EF4444',fontSize:'15px',fontWeight:'700',cursor:'pointer',transition:'all 0.3s'},onMouseEnter:e=>{e.currentTarget.style.background='rgba(239, 68, 68, 0.3)';e.currentTarget.style.transform='translateY(-2px)';},onMouseLeave:e=>{e.currentTarget.style.background='rgba(239, 68, 68, 0.2)';e.currentTarget.style.transform='translateY(0)';},children:[/*#__PURE__*/_jsx(IoWarning,{size:16,style:{display:'inline',marginRight:'8px'}}),\"Raise Dispute\"]})]})]})]})]})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}