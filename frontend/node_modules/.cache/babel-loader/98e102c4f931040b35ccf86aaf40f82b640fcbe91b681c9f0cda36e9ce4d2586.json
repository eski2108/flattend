{"ast":null,"code":"import _objectSpread from\"/app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import axios from'axios';import{toast}from'react-hot-toast';import Layout from'@/components/Layout';import{IoChatbubbles,IoCheckmark as Check,IoCheckmarkCircle,IoCloudUpload,IoDocument,IoImage as Image,IoSend,IoWarning}from'react-icons/io5';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;function DisputeCentre(){var _dispute$trade,_dispute$trade2;const{disputeId}=useParams();const navigate=useNavigate();const[dispute,setDispute]=useState(null);const[loading,setLoading]=useState(true);const[message,setMessage]=useState('');const[uploadingFile,setUploadingFile]=useState(false);const[isMobile,setIsMobile]=useState(window.innerWidth<=768);const userData=JSON.parse(localStorage.getItem('cryptobank_user')||'{}');const userId=userData.user_id;useEffect(()=>{if(disputeId)fetchDispute();const handleResize=()=>setIsMobile(window.innerWidth<=768);window.addEventListener('resize',handleResize);return()=>window.removeEventListener('resize',handleResize);},[disputeId]);const fetchDispute=async()=>{try{setLoading(true);const apiUrl=\"\".concat(API,\"/api/disputes/\").concat(disputeId);const response=await axios.get(apiUrl);if(response.data.success){setDispute(response.data.dispute);}else{console.error('Invalid dispute response:',response.data);toast.error('Dispute not found');}}catch(error){var _error$response,_error$response2,_error$response2$data;console.error('Error fetching dispute:',error);console.error('Error details:',(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);toast.error(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.detail)||'Failed to load dispute');}finally{setLoading(false);}};const sendMessage=async()=>{if(!message.trim())return;try{await axios.post(\"\".concat(API,\"/api/p2p/disputes/\").concat(disputeId,\"/message\"),{user_id:userId,message:message.trim()});setMessage('');toast.success('Message sent');fetchDispute();}catch(error){console.error('Error sending message:',error);toast.error('Failed to send message');}};const handleFileUpload=async event=>{const file=event.target.files[0];if(!file)return;const allowedTypes=['image/png','image/jpeg','image/jpg','application/pdf'];if(!allowedTypes.includes(file.type)){toast.error('Only images (PNG, JPG) and PDFs are allowed');return;}if(file.size>5*1024*1024){toast.error('File size must be less than 5MB');return;}try{setUploadingFile(true);const reader=new FileReader();reader.onloadend=async()=>{try{await axios.post(\"\".concat(API,\"/api/p2p/disputes/\").concat(disputeId,\"/evidence\"),{user_id:userId,file_name:file.name,file_type:file.type,file_data:reader.result,description:\"Evidence uploaded by user\"});toast.success('Evidence uploaded successfully');fetchDispute();}catch(error){console.error('Error uploading evidence:',error);toast.error('Failed to upload evidence');}finally{setUploadingFile(false);}};reader.readAsDataURL(file);}catch(error){console.error('Error processing file:',error);toast.error('Failed to process file');setUploadingFile(false);}};if(loading){return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(\"div\",{style:{padding:'2rem',textAlign:'center',color:'#888',background:'linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%)',minHeight:'100vh'},children:\"Loading dispute...\"})});}if(!dispute){return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsxs(\"div\",{style:{padding:'2rem',textAlign:'center',background:'linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%)',minHeight:'100vh'},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'16px',marginBottom:'1rem'},children:\"Dispute not found\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/dashboard'),style:{padding:'0.75rem 1.5rem',background:'linear-gradient(135deg, #00F0FF, #A855F7)',border:'none',borderRadius:'8px',color:'#000',fontWeight:'700',cursor:'pointer'},children:\"Back to Dashboard\"})]})});}const cardStyle={padding:'1.5rem',background:'rgba(15, 23, 42, 0.6)',border:'1px solid rgba(0, 240, 255, 0.2)',borderRadius:'12px'};return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(\"div\",{style:{background:'linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%)',minHeight:'100vh'},children:/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'1200px',margin:'0 auto',padding:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsx(\"h1\",{style:{fontSize:'28px',fontWeight:'900',color:'#00F0FF',margin:'0 0 1rem 0'},children:\"Dispute Centre\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'1rem',flexWrap:'wrap'},children:[/*#__PURE__*/_jsxs(\"span\",{style:{color:'#888',fontSize:'14px'},children:[\"Dispute ID: \",dispute.dispute_id]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'inline-flex',alignItems:'center',gap:'0.5rem',padding:'0.5rem 0.75rem',background:dispute.status==='open'?'rgba(252, 211, 77, 0.15)':'rgba(34, 197, 94, 0.15)',border:\"1px solid \".concat(dispute.status==='open'?'rgba(252, 211, 77, 0.4)':'rgba(34, 197, 94, 0.4)'),borderRadius:'6px'},children:[dispute.status==='open'?/*#__PURE__*/_jsx(IoWarning,{size:16,color:\"#FCD34D\"}):/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:16,color:\"#22C55E\"}),/*#__PURE__*/_jsx(\"span\",{style:{color:dispute.status==='open'?'#FCD34D':'#22C55E',fontWeight:'700',fontSize:'12px',textTransform:'uppercase'},children:dispute.status})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:_objectSpread(_objectSpread({},cardStyle),{},{marginBottom:'1.5rem'}),children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'16px',fontWeight:'700',color:'#fff',margin:'0 0 1rem 0'},children:\"Timeline\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',gap:'1rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem',alignItems:'flex-start'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'36px',height:'36px',borderRadius:'50%',background:'rgba(34, 197, 94, 0.15)',border:'2px solid #22C55E',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0},children:/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:18,color:\"#22C55E\"})}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#fff',fontSize:'14px',fontWeight:'600',marginBottom:'0.25rem'},children:\"Order Created\"}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'13px'},children:(_dispute$trade=dispute.trade)!==null&&_dispute$trade!==void 0&&_dispute$trade.created_at?new Date(dispute.trade.created_at).toLocaleString():'N/A'})]})]}),((_dispute$trade2=dispute.trade)===null||_dispute$trade2===void 0?void 0:_dispute$trade2.payment_marked_at)&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem',alignItems:'flex-start'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'36px',height:'36px',borderRadius:'50%',background:'rgba(34, 197, 94, 0.15)',border:'2px solid #22C55E',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0},children:/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:18,color:\"#22C55E\"})}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#fff',fontSize:'14px',fontWeight:'600',marginBottom:'0.25rem'},children:\"Payment Marked\"}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'13px'},children:new Date(dispute.trade.payment_marked_at).toLocaleString()})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem',alignItems:'flex-start'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'36px',height:'36px',borderRadius:'50%',background:'rgba(252, 211, 77, 0.15)',border:'2px solid #FCD34D',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0},children:/*#__PURE__*/_jsx(IoWarning,{size:18,color:\"#FCD34D\"})}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#fff',fontSize:'14px',fontWeight:'600',marginBottom:'0.25rem'},children:\"Dispute Opened\"}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'13px',marginBottom:'0.25rem'},children:new Date(dispute.created_at).toLocaleString()}),dispute.reason&&/*#__PURE__*/_jsxs(\"div\",{style:{color:'#666',fontSize:'12px'},children:[\"Reason: \",dispute.reason]})]})]}),dispute.status==='resolved'&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem',alignItems:'flex-start'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'36px',height:'36px',borderRadius:'50%',background:'rgba(34, 197, 94, 0.15)',border:'2px solid #22C55E',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0},children:/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:18,color:\"#22C55E\"})}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#fff',fontSize:'14px',fontWeight:'600',marginBottom:'0.25rem'},children:\"Admin Decision\"}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:'13px',marginBottom:'0.25rem'},children:new Date(dispute.resolved_at).toLocaleString()}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#22C55E',fontSize:'13px',fontWeight:'600'},children:dispute.resolution==='release_to_buyer'?'Crypto released to buyer':'Funds returned to seller'})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:isMobile?'1fr':'1fr 1fr',gap:'1.5rem',alignItems:'start'},children:[/*#__PURE__*/_jsxs(\"div\",{style:_objectSpread(_objectSpread({},cardStyle),{},{display:'flex',flexDirection:'column',height:isMobile?'auto':'500px',overflow:'hidden'}),children:[/*#__PURE__*/_jsxs(\"h3\",{style:{fontSize:'16px',fontWeight:'700',color:'#fff',margin:'0 0 1rem 0',display:'flex',alignItems:'center',gap:'0.5rem'},children:[/*#__PURE__*/_jsx(IoChatbubbles,{size:18}),\" Dispute Chat\"]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1,overflowY:'auto',display:'flex',flexDirection:'column',gap:'0.75rem',marginBottom:'1rem',minHeight:isMobile?'300px':'auto'},children:dispute.messages&&dispute.messages.length>0?dispute.messages.map((msg,idx)=>{const isCurrentUser=msg.user_id===userId;const isBuyer=msg.user_id===dispute.buyer_id;return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'0.875rem',background:isCurrentUser?'rgba(0, 240, 255, 0.1)':'rgba(168, 85, 247, 0.1)',border:\"1px solid \".concat(isCurrentUser?'rgba(0, 240, 255, 0.3)':'rgba(168, 85, 247, 0.3)'),borderRadius:'8px',width:'85%',alignSelf:isCurrentUser?'flex-end':'flex-start',wordWrap:'break-word',boxSizing:'border-box'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{color:'#888',fontSize:'11px',marginBottom:'0.375rem',fontWeight:'600'},children:[isBuyer?'Buyer':'Seller',\" \\u2022 \",new Date(msg.timestamp).toLocaleTimeString()]}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#fff',fontSize:'13px',lineHeight:'1.5'},children:msg.message})]},idx);}):/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center',height:'100%',color:'#666',fontSize:'13px'},children:\"No messages yet. Start the conversation.\"})}),dispute.status==='open'&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.75rem',width:'100%',boxSizing:'border-box'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:message,onChange:e=>setMessage(e.target.value),onKeyPress:e=>e.key==='Enter'&&sendMessage(),placeholder:\"Type your message...\",style:{flex:1,padding:'0.875rem',background:'rgba(0, 0, 0, 0.5)',border:'1px solid rgba(255, 255, 255, 0.15)',borderRadius:'8px',color:'#fff',fontSize:'14px',boxSizing:'border-box'}}),/*#__PURE__*/_jsxs(\"button\",{onClick:sendMessage,disabled:!message.trim(),style:{padding:'0.875rem 1.25rem',background:message.trim()?'linear-gradient(135deg, #00F0FF, #A855F7)':'rgba(100, 100, 100, 0.3)',border:'none',borderRadius:'8px',color:message.trim()?'#000':'#666',fontWeight:'700',cursor:message.trim()?'pointer':'not-allowed',display:'flex',alignItems:'center',gap:'0.5rem',fontSize:'14px',whiteSpace:'nowrap',boxSizing:'border-box'},children:[/*#__PURE__*/_jsx(IoSend,{size:16}),\" Send\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:_objectSpread(_objectSpread({},cardStyle),{},{display:'flex',flexDirection:'column',height:isMobile?'auto':'500px'}),children:[/*#__PURE__*/_jsxs(\"h3\",{style:{fontSize:'16px',fontWeight:'700',color:'#fff',margin:'0 0 1rem 0',display:'flex',alignItems:'center',gap:'0.5rem'},children:[/*#__PURE__*/_jsx(IoDocument,{size:18}),\" Evidence & Attachments\"]}),dispute.status==='open'&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem'},children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'inline-flex',alignItems:'center',gap:'0.5rem',padding:'0.875rem 1.25rem',background:uploadingFile?'rgba(100, 100, 100, 0.3)':'linear-gradient(135deg, #22C55E, #16A34A)',border:'none',borderRadius:'8px',color:'#fff',fontWeight:'700',cursor:uploadingFile?'not-allowed':'pointer',opacity:uploadingFile?0.5:1,fontSize:'14px'},children:[/*#__PURE__*/_jsx(IoCloudUpload,{size:16}),\" \",uploadingFile?'Uploading...':'Upload Evidence',/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*,.pdf\",onChange:handleFileUpload,disabled:uploadingFile,style:{display:'none'}})]}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#666',fontSize:'11px',marginTop:'0.5rem'},children:\"Images (PNG, JPG) and PDF \\u2022 Max 5MB\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1,overflowY:'auto',display:'flex',flexDirection:'column',gap:'0.75rem',minHeight:isMobile?'200px':'auto'},children:dispute.evidence&&dispute.evidence.length>0?dispute.evidence.map((ev,idx)=>{const isImage=ev.file_type.startsWith('image/');return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem',background:'rgba(0, 0, 0, 0.3)',border:'1px solid rgba(255, 255, 255, 0.1)',borderRadius:'8px',display:'flex',alignItems:'center',gap:'1rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'44px',height:'44px',borderRadius:'8px',background:isImage?'rgba(0, 240, 255, 0.1)':'rgba(239, 68, 68, 0.1)',border:\"1px solid \".concat(isImage?'rgba(0, 240, 255, 0.3)':'rgba(239, 68, 68, 0.3)'),display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0},children:isImage?/*#__PURE__*/_jsx(ImageIcon,{size:20,color:\"#00F0FF\"}):/*#__PURE__*/_jsx(IoDocument,{size:20,color:\"#EF4444\"})}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,minWidth:0},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#fff',fontSize:'13px',fontWeight:'600',marginBottom:'0.25rem',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'},children:ev.file_name}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#888',fontSize:'11px'},children:[\"Uploaded by \",ev.user_id===dispute.buyer_id?'Buyer':'Seller']}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#666',fontSize:'11px'},children:new Date(ev.uploaded_at).toLocaleString()})]})]},idx);}):/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center',height:'100%',color:'#666',fontSize:'13px'},children:\"No evidence uploaded yet\"})})]})]})]})})});}export default DisputeCentre;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}