{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import Layout from'@/components/Layout';import{ArrowLeft,IoAdd,IoArrowBack,IoClose,Plus}from'react-icons/io5';import axios from'axios';import{toast}from'sonner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BACKEND_URL=process.env.REACT_APP_BACKEND_URL;const API=BACKEND_URL;export default function CreateOffer(){var _config$currencies$fi;const navigate=useNavigate();const[config,setConfig]=useState(null);const[currentUser,setCurrentUser]=useState(null);const[loading,setLoading]=useState(true);const[creating,setCreating]=useState(false);// Form state\nconst[cryptoCurrency,setCryptoCurrency]=useState('BTC');const[cryptoAmount,setCryptoAmount]=useState('');const[fiatCurrency,setFiatCurrency]=useState('GBP');const[pricePerUnit,setPricePerUnit]=useState('');const[minPurchase,setMinPurchase]=useState('');const[maxPurchase,setMaxPurchase]=useState('');const[selectedPaymentMethods,setSelectedPaymentMethods]=useState([]);const[sellerRequirements,setSellerRequirements]=useState([]);const[newRequirement,setNewRequirement]=useState('');useEffect(()=>{const userData=localStorage.getItem('cryptobank_user');if(!userData){navigate('/login');return;}const user=JSON.parse(userData);setCurrentUser(user);fetchConfig();},[navigate]);const fetchConfig=async()=>{try{const response=await axios.get(\"\".concat(API,\"/api/p2p/config\"));if(response.data.success){setConfig(response.data);}}catch(error){console.error('Error fetching config:',error);toast.error('Failed to load configuration');}finally{setLoading(false);}};const togglePaymentMethod=pmId=>{if(selectedPaymentMethods.includes(pmId)){setSelectedPaymentMethods(selectedPaymentMethods.filter(id=>id!==pmId));}else{setSelectedPaymentMethods([...selectedPaymentMethods,pmId]);}};const addRequirement=()=>{if(!newRequirement.trim())return;setSellerRequirements([...sellerRequirements,{tag:newRequirement.toLowerCase().replace(/\\s+/g,'_'),label:newRequirement}]);setNewRequirement('');};const removeRequirement=index=>{setSellerRequirements(sellerRequirements.filter((_,i)=>i!==index));};const handleSubmit=async e=>{e.preventDefault();// Validation\nif(!cryptoAmount||parseFloat(cryptoAmount)<=0){toast.error('Please enter a valid crypto amount');return;}if(!pricePerUnit||parseFloat(pricePerUnit)<=0){toast.error('Please enter a valid price per unit');return;}if(!minPurchase||parseFloat(minPurchase)<=0){toast.error('Please enter a valid minimum purchase');return;}if(!maxPurchase||parseFloat(maxPurchase)<=0){toast.error('Please enter a valid maximum purchase');return;}if(parseFloat(minPurchase)>parseFloat(maxPurchase)){toast.error('Minimum purchase cannot be greater than maximum');return;}if(parseFloat(maxPurchase)>parseFloat(cryptoAmount)){toast.error('Maximum purchase cannot exceed total amount');return;}if(selectedPaymentMethods.length===0){toast.error('Please select at least one payment method');return;}setCreating(true);try{const response=await axios.post(\"\".concat(API,\"/api/p2p/create-offer\"),{seller_id:currentUser.user_id,crypto_currency:cryptoCurrency,crypto_amount:parseFloat(cryptoAmount),fiat_currency:fiatCurrency,price_per_unit:parseFloat(pricePerUnit),min_purchase:parseFloat(minPurchase),max_purchase:parseFloat(maxPurchase),payment_methods:selectedPaymentMethods,seller_requirements:sellerRequirements});if(response.data.success){toast.success('Offer created successfully!');navigate('/p2p-marketplace');}}catch(error){var _error$response,_error$response$data;console.error('Error creating offer:',error);toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.detail)||'Failed to create offer');}finally{setCreating(false);}};if(loading){return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center',minHeight:'60vh'},children:/*#__PURE__*/_jsx(\"div\",{style:{width:'48px',height:'48px',border:'4px solid rgba(0, 240, 255, 0.3)',borderTopColor:'#00F0FF',borderRadius:'50%',animation:'spin 1s linear infinite'}})})});}const totalValue=cryptoAmount&&pricePerUnit?(parseFloat(cryptoAmount)*parseFloat(pricePerUnit)).toLocaleString():'0';const currencySymbol=(config===null||config===void 0?void 0:(_config$currencies$fi=config.currencies[fiatCurrency])===null||_config$currencies$fi===void 0?void 0:_config$currencies$fi.symbol)||'';return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'900px',margin:'0 auto',padding:'2rem 1rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'2rem',display:'flex',alignItems:'center',gap:'1rem'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/p2p-marketplace'),style:{padding:'0.75rem',background:'rgba(0, 240, 255, 0.1)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'10px',color:'#00F0FF',cursor:'pointer',display:'flex',alignItems:'center'},children:/*#__PURE__*/_jsx(IoArrowBack,{size:24})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{style:{fontSize:'2rem',fontWeight:'900',background:'linear-gradient(135deg, #00F0FF, #A855F7)',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent'},children:\"Create Sell Offer\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'rgba(255,255,255,0.6)',fontSize:'0.875rem',marginTop:'0.25rem'},children:\"List your crypto for sale on the P2P marketplace\"})]})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'linear-gradient(135deg, rgba(0, 240, 255, 0.05), rgba(168, 85, 247, 0.05))',border:'2px solid rgba(0, 240, 255, 0.2)',borderRadius:'16px',padding:'2rem',marginBottom:'2rem'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'1.375rem',fontWeight:'700',color:'#FFFFFF',marginBottom:'1.5rem'},children:\"Crypto Details\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:window.innerWidth>768?'repeat(2, 1fr)':'1fr',gap:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:'0.875rem',fontWeight:'600',color:'rgba(255,255,255,0.8)',marginBottom:'0.5rem'},children:\"Cryptocurrency *\"}),/*#__PURE__*/_jsxs(\"select\",{value:cryptoCurrency,onChange:e=>setCryptoCurrency(e.target.value),required:true,style:{width:'100%',padding:'0.875rem',background:'rgba(0, 0, 0, 0.3)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'10px',color:'#FFFFFF',fontSize:'1rem',outline:'none'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"BTC\",children:\"Bitcoin (BTC)\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ETH\",children:\"Ethereum (ETH)\"}),/*#__PURE__*/_jsx(\"option\",{value:\"USDT\",children:\"Tether (USDT)\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:'0.875rem',fontWeight:'600',color:'rgba(255,255,255,0.8)',marginBottom:'0.5rem'},children:\"Total Amount *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.00000001\",placeholder:\"0.00\",value:cryptoAmount,onChange:e=>setCryptoAmount(e.target.value),required:true,style:{width:'100%',padding:'0.875rem',background:'rgba(0, 0, 0, 0.3)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'10px',color:'#FFFFFF',fontSize:'1rem',outline:'none'}})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'linear-gradient(135deg, rgba(168, 85, 247, 0.05), rgba(0, 240, 255, 0.05))',border:'2px solid rgba(168, 85, 247, 0.2)',borderRadius:'16px',padding:'2rem',marginBottom:'2rem'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'1.375rem',fontWeight:'700',color:'#FFFFFF',marginBottom:'1.5rem'},children:\"Price & Currency\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:window.innerWidth>768?'repeat(2, 1fr)':'1fr',gap:'1.5rem',marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:'0.875rem',fontWeight:'600',color:'rgba(255,255,255,0.8)',marginBottom:'0.5rem'},children:\"Fiat Currency *\"}),/*#__PURE__*/_jsx(\"select\",{value:fiatCurrency,onChange:e=>setFiatCurrency(e.target.value),required:true,style:{width:'100%',padding:'0.875rem',background:'rgba(0, 0, 0, 0.3)',border:'2px solid rgba(168, 85, 247, 0.3)',borderRadius:'10px',color:'#FFFFFF',fontSize:'1rem',outline:'none'},children:config&&Object.entries(config.currencies).map(_ref=>{let[code,info]=_ref;return/*#__PURE__*/_jsxs(\"option\",{value:code,children:[info.symbol,\" \",info.name,\" (\",code,\")\"]},code);})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'block',fontSize:'0.875rem',fontWeight:'600',color:'rgba(255,255,255,0.8)',marginBottom:'0.5rem'},children:[\"Price per \",cryptoCurrency,\" *\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",placeholder:\"0.00\",value:pricePerUnit,onChange:e=>setPricePerUnit(e.target.value),required:true,style:{width:'100%',padding:'0.875rem',background:'rgba(0, 0, 0, 0.3)',border:'2px solid rgba(168, 85, 247, 0.3)',borderRadius:'10px',color:'#FFFFFF',fontSize:'1rem',outline:'none'}})]})]}),cryptoAmount&&pricePerUnit&&/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem',background:'rgba(168, 85, 247, 0.1)',border:'2px solid rgba(168, 85, 247, 0.3)',borderRadius:'10px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.875rem',color:'rgba(255,255,255,0.7)',marginBottom:'0.25rem'},children:\"Total Value\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'1.5rem',fontWeight:'900',color:'#A855F7'},children:[currencySymbol,totalValue]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'linear-gradient(135deg, rgba(0, 240, 255, 0.05), rgba(168, 85, 247, 0.05))',border:'2px solid rgba(0, 240, 255, 0.2)',borderRadius:'16px',padding:'2rem',marginBottom:'2rem'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'1.375rem',fontWeight:'700',color:'#FFFFFF',marginBottom:'1.5rem'},children:\"Trade Limits\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:window.innerWidth>768?'repeat(2, 1fr)':'1fr',gap:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'block',fontSize:'0.875rem',fontWeight:'600',color:'rgba(255,255,255,0.8)',marginBottom:'0.5rem'},children:[\"Minimum Purchase (\",cryptoCurrency,\") *\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.00000001\",placeholder:\"0.00\",value:minPurchase,onChange:e=>setMinPurchase(e.target.value),required:true,style:{width:'100%',padding:'0.875rem',background:'rgba(0, 0, 0, 0.3)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'10px',color:'#FFFFFF',fontSize:'1rem',outline:'none'}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'block',fontSize:'0.875rem',fontWeight:'600',color:'rgba(255,255,255,0.8)',marginBottom:'0.5rem'},children:[\"Maximum Purchase (\",cryptoCurrency,\") *\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.00000001\",placeholder:\"0.00\",value:maxPurchase,onChange:e=>setMaxPurchase(e.target.value),required:true,style:{width:'100%',padding:'0.875rem',background:'rgba(0, 0, 0, 0.3)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'10px',color:'#FFFFFF',fontSize:'1rem',outline:'none'}})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'linear-gradient(135deg, rgba(168, 85, 247, 0.05), rgba(0, 240, 255, 0.05))',border:'2px solid rgba(168, 85, 247, 0.2)',borderRadius:'16px',padding:'2rem',marginBottom:'2rem'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'1.375rem',fontWeight:'700',color:'#FFFFFF',marginBottom:'1.5rem'},children:\"Payment Methods *\"}),/*#__PURE__*/_jsx(\"div\",{style:{display:'grid',gridTemplateColumns:window.innerWidth>768?'repeat(3, 1fr)':'repeat(2, 1fr)',gap:'1rem'},children:config&&Object.values(config.payment_methods).map(pm=>/*#__PURE__*/_jsxs(\"div\",{onClick:()=>togglePaymentMethod(pm.id),style:{padding:'1rem',background:selectedPaymentMethods.includes(pm.id)?'rgba(168, 85, 247, 0.2)':'rgba(0, 0, 0, 0.2)',border:\"2px solid \".concat(selectedPaymentMethods.includes(pm.id)?'#A855F7':'rgba(255, 255, 255, 0.1)'),borderRadius:'10px',cursor:'pointer',transition:'all 0.3s ease',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'1.5rem',marginBottom:'0.5rem'},children:pm.icon}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.875rem',fontWeight:'600',color:'#FFFFFF'},children:pm.name}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'0.75rem',color:'rgba(255,255,255,0.6)',marginTop:'0.25rem'},children:[\"~\",pm.estimated_time_minutes,\"m\"]})]},pm.id))})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'linear-gradient(135deg, rgba(0, 240, 255, 0.05), rgba(168, 85, 247, 0.05))',border:'2px solid rgba(0, 240, 255, 0.2)',borderRadius:'16px',padding:'2rem',marginBottom:'2rem'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'1.375rem',fontWeight:'700',color:'#FFFFFF',marginBottom:'1.5rem'},children:\"Advertiser Requirements (Optional)\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:'0.875rem',fontWeight:'600',color:'rgba(255,255,255,0.8)',marginBottom:'0.5rem'},children:\"Add Requirement\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.75rem'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"e.g., KYC Required, UK Banks Only\",value:newRequirement,onChange:e=>setNewRequirement(e.target.value),onKeyPress:e=>e.key==='Enter'&&(e.preventDefault(),addRequirement()),style:{flex:1,padding:'0.875rem',background:'rgba(0, 0, 0, 0.3)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'10px',color:'#FFFFFF',fontSize:'1rem',outline:'none'}}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:addRequirement,style:{padding:'0.875rem 1.5rem',background:'linear-gradient(135deg, #00F0FF, #00B8E6)',border:'none',borderRadius:'10px',color:'#000000',fontSize:'1rem',fontWeight:'700',cursor:'pointer',display:'flex',alignItems:'center',gap:'0.5rem'},children:[/*#__PURE__*/_jsx(IoAdd,{size:20}),\"Add\"]})]})]}),sellerRequirements.length>0&&/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexWrap:'wrap',gap:'0.75rem'},children:sellerRequirements.map((req,index)=>/*#__PURE__*/_jsxs(\"div\",{style:{padding:'0.75rem 1rem',background:'rgba(245, 158, 11, 0.1)',border:'2px solid rgba(245, 158, 11, 0.3)',borderRadius:'8px',display:'flex',alignItems:'center',gap:'0.75rem'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'0.875rem',fontWeight:'600',color:'#F59E0B'},children:req.label}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>removeRequirement(index),style:{background:'none',border:'none',color:'#EF4444',cursor:'pointer',padding:'0.25rem',display:'flex',alignItems:'center'},children:/*#__PURE__*/_jsx(IoClose,{size:16})})]},index))})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem'},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>navigate('/p2p-marketplace'),style:{flex:1,padding:'1rem',background:'rgba(255, 255, 255, 0.05)',border:'2px solid rgba(255, 255, 255, 0.2)',borderRadius:'12px',color:'#FFFFFF',fontSize:'1.125rem',fontWeight:'700',cursor:'pointer'},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:creating,style:{flex:1,padding:'1rem',background:creating?'rgba(0, 240, 255, 0.5)':'linear-gradient(135deg, #00F0FF, #A855F7)',border:'none',borderRadius:'12px',color:'#000000',fontSize:'1.125rem',fontWeight:'700',cursor:creating?'not-allowed':'pointer'},children:creating?'Creating Offer...':'Create Offer'})]})]})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}