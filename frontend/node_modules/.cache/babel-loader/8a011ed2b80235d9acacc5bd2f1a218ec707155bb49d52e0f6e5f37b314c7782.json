{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{IoAlertCircle,IoArrowBack}from'react-icons/io5';import{AiOutlineLoading3Quarters}from'react-icons/ai';;import axios from'axios';import{toast}from'sonner';import Layout from'@/components/Layout';import OTPModal from'@/components/OTPModal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;export default function WithdrawalRequest(){const{coin}=useParams();const navigate=useNavigate();const[user,setUser]=useState(null);const[selectedCrypto,setSelectedCrypto]=useState((coin===null||coin===void 0?void 0:coin.toUpperCase())||'BTC');const[amount,setAmount]=useState('');const[withdrawalAddress,setWithdrawalAddress]=useState('');const[submitting,setSubmitting]=useState(false);const[showOTPModal,setShowOTPModal]=useState(false);const[pendingWithdrawal,setPendingWithdrawal]=useState(null);const[availableBalance,setAvailableBalance]=useState(0);const[balances,setBalances]=useState([]);useEffect(()=>{const userData=localStorage.getItem('cryptobank_user');if(!userData){navigate('/login');return;}const u=JSON.parse(userData);setUser(u);loadBalances(u.user_id);},[navigate]);useEffect(()=>{if(coin){setSelectedCrypto(coin.toUpperCase());}},[coin]);const loadBalances=async userId=>{try{const response=await axios.get(\"\".concat(API,\"/api/wallets/balances/\").concat(userId));if(response.data.success){const bals=response.data.balances||[];setBalances(bals);const currentAsset=bals.find(b=>b.currency===selectedCrypto);if(currentAsset){setAvailableBalance(currentAsset.available_balance);}}}catch(error){console.error('Failed to load balances:',error);}};useEffect(()=>{if(balances.length>0){const currentAsset=balances.find(b=>b.currency===selectedCrypto);if(currentAsset){setAvailableBalance(currentAsset.available_balance);}}},[selectedCrypto,balances]);const handleSubmitWithdrawal=()=>{if(!amount||parseFloat(amount)<=0){toast.error('Please enter a valid amount');return;}if(!withdrawalAddress||withdrawalAddress.trim().length<20){toast.error('Please enter a valid withdrawal address');return;}if(parseFloat(amount)>availableBalance){toast.error('Insufficient balance');return;}setPendingWithdrawal({currency:selectedCrypto,amount:parseFloat(amount),address:withdrawalAddress.trim()});setShowOTPModal(true);};const handleOTPVerified=async otp=>{setSubmitting(true);try{const response=await axios.post(\"\".concat(API,\"/api/wallet/withdraw\"),{user_id:user.user_id,currency:pendingWithdrawal.currency,amount:pendingWithdrawal.amount,wallet_address:pendingWithdrawal.address,otp_code:otp});if(response.data.success){toast.success('Withdrawal request submitted successfully!');setAmount('');setWithdrawalAddress('');setShowOTPModal(false);setPendingWithdrawal(null);setTimeout(()=>{navigate('/wallet');},2000);}else{toast.error(response.data.message||'Withdrawal failed');}}catch(error){var _error$response,_error$response$data;console.error('Withdrawal error:',error);toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Failed to process withdrawal');}finally{setSubmitting(false);}};const setMaxAmount=()=>{setAmount(availableBalance.toString());};const getCoinColor=curr=>{const colors={'BTC':'#F7931A','ETH':'#627EEA','USDT':'#26A17B','BNB':'#F3BA2F','SOL':'#9945FF','LTC':'#345D9D','DOGE':'#C3A634'};return colors[curr]||'#00F0FF';};return/*#__PURE__*/_jsxs(Layout,{children:[/*#__PURE__*/_jsx(\"div\",{style:{minHeight:'100vh',background:'linear-gradient(135deg, #05060B 0%, #080B14 100%)',padding:'20px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'800px',margin:'0 auto'},children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/wallet'),className:\"premium-btn-secondary\",style:{display:'flex',alignItems:'center',gap:'8px',padding:'10px 16px',marginBottom:'24px',fontSize:'14px'},children:[/*#__PURE__*/_jsx(IoArrowBack,{size:18}),\"Back to Wallet\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'32px'},children:[/*#__PURE__*/_jsxs(\"h1\",{style:{fontSize:'28px',fontWeight:'700',color:'#FFFFFF',marginBottom:'8px'},children:[\"Withdraw \",selectedCrypto]}),/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:'15px',color:'#A3AEC2'},children:[\"Send \",selectedCrypto,\" to your external wallet. Withdrawals require OTP verification.\"]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'linear-gradient(135deg, #08192B 0%, #04101F 100%)',border:\"2px solid \".concat(getCoinColor(selectedCrypto),\"44\"),borderRadius:'22px',padding:'24px',marginBottom:'24px',boxShadow:\"0 0 20px \".concat(getCoinColor(selectedCrypto),\"22\"),opacity:0.94},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'24px',padding:'16px',background:'rgba(0, 240, 255, 0.05)',borderRadius:'12px',border:'1px solid rgba(0, 240, 255, 0.2)'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'13px',color:'#A3AEC2',marginBottom:'4px'},children:\"Available Balance\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'24px',fontWeight:'700',color:'#00F0FF'},children:[availableBalance.toFixed(8),\" \",selectedCrypto]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{fontSize:'14px',color:'#A3AEC2',marginBottom:'8px',display:'block'},children:\"Amount to Withdraw\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'8px'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:amount,onChange:e=>setAmount(e.target.value),placeholder:\"0.00000000\",className:\"premium-input\",style:{flex:1}}),/*#__PURE__*/_jsx(\"button\",{onClick:setMaxAmount,className:\"premium-btn-secondary\",style:{padding:'0 20px',fontSize:'14px',fontWeight:'600'},children:\"MAX\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{fontSize:'14px',color:'#A3AEC2',marginBottom:'8px',display:'block'},children:\"Withdrawal Address\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:withdrawalAddress,onChange:e=>setWithdrawalAddress(e.target.value),placeholder:\"Enter \".concat(selectedCrypto,\" address\"),className:\"premium-input\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'24px',padding:'12px',background:'rgba(0, 0, 0, 0.3)',borderRadius:'8px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginBottom:'8px'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'13px',color:'#A3AEC2'},children:\"Network Fee\"}),/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:'13px',color:'#FFFFFF'},children:[\"~0.0001 \",selectedCrypto]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'14px',color:'#FFFFFF',fontWeight:'600'},children:\"You will receive\"}),/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:'14px',color:'#00F0FF',fontWeight:'600'},children:[amount?(parseFloat(amount)-0.0001).toFixed(8):'0.00000000',\" \",selectedCrypto]})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmitWithdrawal,disabled:submitting||!amount||!withdrawalAddress,className:\"premium-btn-primary\",style:{width:'100%',padding:'16px',fontSize:'16px',fontWeight:'600'},children:submitting?/*#__PURE__*/_jsxs(\"span\",{style:{display:'flex',alignItems:'center',justifyContent:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(AiOutlineLoading3Quarters,{size:18,style:{animation:'spin 1s linear infinite'}}),\"Processing...\"]}):'Withdraw '+selectedCrypto})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(255, 191, 0, 0.05)',border:'1px solid rgba(255, 191, 0, 0.3)',borderRadius:'16px',padding:'16px',display:'flex',gap:'12px'},children:[/*#__PURE__*/_jsx(IoAlertCircle,{size:20,color:\"#FBBF24\",style:{flexShrink:0,marginTop:'2px'}}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'14px',fontWeight:'600',color:'#FBBF24',marginBottom:'4px'},children:\"Important\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'13px',color:'#FDE68A',lineHeight:'1.5'},children:[\"Double-check the withdrawal address. Sending \",selectedCrypto,\" to a wrong address will result in permanent loss. Withdrawals require OTP verification for security.\"]})]})]})]})}),showOTPModal&&/*#__PURE__*/_jsx(OTPModal,{isOpen:showOTPModal,onClose:()=>{setShowOTPModal(false);setPendingWithdrawal(null);},onVerify:handleOTPVerified,action:\"withdraw\"})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}