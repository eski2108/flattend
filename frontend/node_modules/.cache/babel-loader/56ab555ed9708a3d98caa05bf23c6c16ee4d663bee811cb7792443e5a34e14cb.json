{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{useTranslation}from'react-i18next';import axios from'axios';import{toast}from'sonner';import{IoRefresh,IoSearch}from'react-icons/io5';import DepositModal from'@/components/modals/DepositModal';import WithdrawModal from'@/components/modals/WithdrawModal';import SwapModal from'@/components/modals/SwapModal';import MobileBottomNav from'@/components/MobileBottomNav';import{getCoinLogo,getGenericCoinIcon}from'@/utils/coinLogos';const API=process.env.REACT_APP_BACKEND_URL;const COIN_COLORS={BTC:'#F7931A',ETH:'#627EEA',BNB:'#F3BA2F',SOL:'#A78BFA',XRP:'#00AAE4',ADA:'#0033AD',DOT:'#E6007A',USDT:'#26A17B',DOGE:'#C2A633',LTC:'#345D9D',MATIC:'#8247E5'};// Import the unified 3D Coin Icon component\nimport Coin3DIcon from'@/components/Coin3DIcon';// Alias for backwards compatibility\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CoinIcon=_ref=>{let{symbol,size=40}=_ref;return/*#__PURE__*/_jsx(Coin3DIcon,{symbol:symbol,size:size});};export default function WalletPage(){const navigate=useNavigate();const{t}=useTranslation();const[user,setUser]=useState(null);const[allCoins,setAllCoins]=useState([]);const[balances,setBalances]=useState([]);const[priceData,setPriceData]=useState({});const[loading,setLoading]=useState(true);const[refreshing,setRefreshing]=useState(false);const[searchTerm,setSearchTerm]=useState('');const[depositModal,setDepositModal]=useState({isOpen:false,currency:null});const[withdrawModal,setWithdrawModal]=useState({isOpen:false,currency:null,balance:0});const[swapModal,setSwapModal]=useState({isOpen:false,fromCurrency:null});const[activeTab,setActiveTab]=useState('Crypto');// Only used for Crypto tab now\nuseEffect(()=>{const userData=localStorage.getItem('cryptobank_user');if(!userData){navigate('/login');return;}const u=JSON.parse(userData);setUser(u);loadAllData(u.user_id);const interval=setInterval(()=>{loadBalances(u.user_id);loadPriceData();},15000);return()=>clearInterval(interval);},[navigate]);const loadAllData=async userId=>{// FAST: Load balances first (critical), show page immediately\ntry{const balanceResp=await axios.get(\"\".concat(API,\"/api/wallets/balances/\").concat(userId,\"?_t=\").concat(Date.now()));if(balanceResp.data.success){setBalances(balanceResp.data.balances||[]);}}catch(e){console.error('Balance load error:',e);}// STOP SPINNER - page is usable now\nsetLoading(false);// Load non-critical data in background (non-blocking)\nloadCoinMetadata();loadPriceData();};const loadCoinMetadata=async()=>{try{const response=await axios.get(\"\".concat(API,\"/api/wallets/coin-metadata\"));if(response.data.success){setAllCoins(response.data.coins||[]);}}catch(error){console.error('Failed to load coin metadata:',error);}};const loadBalances=async userId=>{try{const response=await axios.get(\"\".concat(API,\"/api/wallets/balances/\").concat(userId,\"?_t=\").concat(Date.now()));if(response.data.success){setBalances(response.data.balances||[]);}}catch(error){console.error('Failed to load balances:',error);}finally{setRefreshing(false);}};const loadPriceData=async()=>{try{const response=await axios.get(\"\".concat(API,\"/api/prices/live\"));if(response.data.success){setPriceData(response.data.prices||{});}}catch(error){console.error('Failed to load price data:',error);}};// Transactions now loaded on separate /transactions page\nconst handleRefresh=()=>{if(!refreshing&&user){setRefreshing(true);loadBalances(user.user_id);loadPriceData();toast.success('Refreshing...');}};const getCoinColor=symbol=>COIN_COLORS[symbol]||'#00E5FF';const mergedAssets=allCoins.map(coin=>{const balance=balances.find(b=>b.currency===coin.symbol);const price=priceData[coin.symbol]||{};const totalBalance=(balance===null||balance===void 0?void 0:balance.total_balance)||0;const priceGbp=(balance===null||balance===void 0?void 0:balance.price_gbp)||price.gbp||0;const gbpValue=totalBalance*priceGbp;const change24h=price.change_24h||price.change_24h_gbp||0;return{currency:coin.symbol,name:coin.name,logoUrl:getCoinLogo(coin.symbol),color:getCoinColor(coin.symbol),total_balance:totalBalance,available_balance:(balance===null||balance===void 0?void 0:balance.available_balance)||0,locked_balance:(balance===null||balance===void 0?void 0:balance.locked_balance)||0,gbp_value:gbpValue,price_gbp:priceGbp,change_24h:change24h,has_balance:totalBalance>0};});const filteredAssets=searchTerm?mergedAssets.filter(a=>a.currency.toLowerCase().includes(searchTerm.toLowerCase())||a.name.toLowerCase().includes(searchTerm.toLowerCase())):mergedAssets;const assetsWithBalance=mergedAssets.filter(a=>a.total_balance>0);const totalValue=assetsWithBalance.reduce((sum,a)=>sum+a.gbp_value,0);let portfolioChange24h=0;if(totalValue>0&&assetsWithBalance.length>0){portfolioChange24h=assetsWithBalance.reduce((sum,asset)=>{const weight=asset.gbp_value/totalValue;return sum+asset.change_24h*weight;},0);}if(loading){return/*#__PURE__*/_jsx(\"div\",{style:{minHeight:'100vh',background:'#0B1220',display:'flex',alignItems:'center',justifyContent:'center',fontFamily:'Inter, sans-serif'},children:/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'20px',color:'#00E5FF',fontWeight:'600'},children:t('common.loading')})});}return/*#__PURE__*/_jsxs(\"div\",{style:{background:'#060B1A',fontFamily:'Inter, sans-serif',paddingBottom:0},children:[/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'1400px',margin:'0 auto',padding:'0 20px',paddingBottom:0},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'32px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{style:{fontSize:'36px',fontWeight:'700',color:'#FFFFFF',margin:'0 0 8px 0'},children:t('wallet.title')}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'14px',color:'#8FA3BF',margin:0,fontWeight:'400'},children:t('wallet.manage_assets')})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleRefresh,disabled:refreshing,style:{padding:'10px 20px',background:'transparent',border:'1.5px solid #00E5FF',borderRadius:'12px',color:'#00E5FF',fontSize:'14px',fontWeight:'600',cursor:refreshing?'not-allowed':'pointer',display:'flex',alignItems:'center',gap:'8px',transition:'all 0.3s ease',opacity:refreshing?0.6:1},children:[/*#__PURE__*/_jsx(IoRefresh,{size:18,style:{animation:refreshing?'spin 1s linear infinite':'none'}}),t('common.refresh')]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'24px 20px 20px',marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'11px',color:'#8FA3C8',fontWeight:'500',marginBottom:'8px',textTransform:'uppercase',letterSpacing:'0.5px'},children:t('wallet.total_balance')}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'40px',fontWeight:'700',color:'#FFFFFF',lineHeight:'1',marginBottom:'8px'},children:[\"\\xA3\",totalValue.toLocaleString('en-GB',{minimumFractionDigits:2,maximumFractionDigits:2})]}),assetsWithBalance.length>0?/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'15px',fontWeight:'600',color:portfolioChange24h>=0?'#16C784':'#EA3943'},children:[portfolioChange24h>=0?'+':'',portfolioChange24h.toFixed(2),\"% \",t('wallet.today')]}):/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'14px',color:'#8FA3C8'},children:t('wallet.no_holdings')})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'20px',marginBottom:'24px',padding:'0 20px',justifyContent:'flex-start'},children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/buy-crypto'),style:{display:'flex',flexDirection:'column',alignItems:'center',gap:'6px',background:'none',border:'none',cursor:'pointer',padding:0},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'48px',height:'48px',borderRadius:'50%',background:'#0047D9',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'20px',color:'#fff',fontWeight:'600'},children:\"+\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#8FA3C8',fontWeight:'400'},children:t('trading.buy')})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/swap-crypto'),style:{display:'flex',flexDirection:'column',alignItems:'center',gap:'6px',background:'none',border:'none',cursor:'pointer',padding:0},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'48px',height:'48px',borderRadius:'50%',background:'#0047D9',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'20px',color:'#fff',fontWeight:'600'},children:\"\\u21C4\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#8FA3C8',fontWeight:'400'},children:t('wallet.swap')})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{// Send to first asset with balance, or BTC if none\nconst firstAsset=balances.find(b=>b.total_balance>0);const currency=firstAsset?firstAsset.currency.toLowerCase():'btc';navigate(\"/send/\".concat(currency));},style:{display:'flex',flexDirection:'column',alignItems:'center',gap:'6px',background:'none',border:'none',cursor:'pointer',padding:0},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'48px',height:'48px',borderRadius:'50%',background:'#0047D9',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'20px',color:'#fff',fontWeight:'600'},children:\"\\u2191\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#8FA3C8',fontWeight:'400'},children:t('wallet.send')})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{// Receive to first asset or BTC\nconst firstAsset=balances.find(b=>b.total_balance>0);const currency=firstAsset?firstAsset.currency:'BTC';navigate(\"/receive?asset=\".concat(currency));},style:{display:'flex',flexDirection:'column',alignItems:'center',gap:'6px',background:'none',border:'none',cursor:'pointer',padding:0},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'48px',height:'48px',borderRadius:'50%',background:'#0047D9',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'20px',color:'#fff',fontWeight:'600'},children:\"\\u2193\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#8FA3C8',fontWeight:'400'},children:t('wallet.receive')})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',borderBottom:'1px solid rgba(255,255,255,0.06)',marginBottom:'16px'},children:[{name:t('wallet.crypto'),route:'/wallet'},{name:t('wallet.activity'),route:'/transactions'},{name:t('nav.dashboard'),route:'/dashboard'}].map(tab=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(tab.route==='/wallet'){setActiveTab('Crypto');}else{navigate(tab.route);}},style:{flex:1,padding:'12px 0',background:'none',border:'none',borderBottom:tab.route==='/wallet'&&activeTab==='Crypto'?'1px solid #0047D9':'1px solid transparent',color:tab.route==='/wallet'&&activeTab==='Crypto'?'#FFFFFF':'#6B7A99',fontSize:'14px',fontWeight:'500',cursor:'pointer',transition:'color 0.2s',opacity:tab.route==='/wallet'&&activeTab==='Crypto'?1:0.7},children:tab.name},tab.name))}),/*#__PURE__*/_jsx(\"div\",{style:{padding:'0 20px',marginBottom:'16px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative'},children:[/*#__PURE__*/_jsx(IoSearch,{size:18,style:{position:'absolute',left:'12px',top:'50%',transform:'translateY(-50%)',color:'#6B7A99'}}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search assets\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),style:{width:'100%',padding:'10px 10px 10px 38px',background:'rgba(255,255,255,0.03)',border:'none',borderRadius:'10px',color:'#FFFFFF',fontSize:'14px',outline:'none',fontWeight:'400'}})]})}),activeTab==='Crypto'&&/*#__PURE__*/_jsx(\"div\",{children:filteredAssets.length===0?/*#__PURE__*/_jsx(\"div\",{style:{padding:'60px 20px',textAlign:'center',color:'#8FA3C8'},children:/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'14px',margin:0},children:\"No assets yet\"})}):filteredAssets.map((asset,idx)=>{const hasBalance=asset.total_balance>0;return/*#__PURE__*/_jsxs(\"div\",{onClick:()=>navigate(\"/asset/\".concat(asset.currency.toLowerCase())),style:{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'14px 20px',background:'transparent',borderBottom:'1px solid rgba(255,255,255,0.04)',cursor:'pointer',transition:'background 0.15s'},onMouseEnter:e=>e.currentTarget.style.background='rgba(255,255,255,0.02)',onMouseLeave:e=>e.currentTarget.style.background='transparent',children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'12px',flex:1},children:[/*#__PURE__*/_jsx(CoinIcon,{symbol:asset.currency,size:40}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'15px',fontWeight:'600',color:'#FFFFFF',marginBottom:'2px'},children:asset.currency}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'13px',color:'#6B7A99',fontWeight:'400'},children:asset.name})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'right'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'15px',fontWeight:'600',color:'#FFFFFF',marginBottom:'2px'},children:[\"\\xA3\",asset.gbp_value.toFixed(2)]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'13px',color:'#6B7A99',fontWeight:'400'},children:[asset.total_balance.toFixed(4),\" \",asset.currency]})]})]},asset.currency);})})]}),/*#__PURE__*/_jsx(DepositModal,{isOpen:depositModal.isOpen,onClose:()=>setDepositModal({isOpen:false,currency:null}),currency:depositModal.currency,userId:user===null||user===void 0?void 0:user.user_id}),/*#__PURE__*/_jsx(WithdrawModal,{isOpen:withdrawModal.isOpen,onClose:()=>setWithdrawModal({isOpen:false,currency:null,balance:0}),currency:withdrawModal.currency,availableBalance:withdrawModal.balance,userId:user===null||user===void 0?void 0:user.user_id,onSuccess:()=>loadBalances(user===null||user===void 0?void 0:user.user_id)}),/*#__PURE__*/_jsx(SwapModal,{isOpen:swapModal.isOpen,onClose:()=>setSwapModal({isOpen:false,fromCurrency:null}),fromCurrency:swapModal.fromCurrency,balances:balances,userId:user===null||user===void 0?void 0:user.user_id,onSuccess:()=>loadBalances(user===null||user===void 0?void 0:user.user_id)}),/*#__PURE__*/_jsx(MobileBottomNav,{}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n        @keyframes spin {\\n          from { transform: rotate(0deg); }\\n          to { transform: rotate(360deg); }\\n        }\\n      \"})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}