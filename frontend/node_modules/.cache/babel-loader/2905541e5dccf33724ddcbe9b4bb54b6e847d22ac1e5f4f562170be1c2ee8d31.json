{"ast":null,"code":"import _objectSpread from\"/app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{IoClose,IoCheckmarkCircle,IoLink,IoUnlink,IoRefresh}from'react-icons/io5';import{FaTelegramPlane}from'react-icons/fa';import{toast}from'sonner';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;const TelegramSettings=_ref=>{let{user,onClose}=_ref;const[loading,setLoading]=useState(false);const[linkLoading,setLinkLoading]=useState(false);const[telegramStatus,setTelegramStatus]=useState({linked:false,username:null,chat_id:null});const[preferences,setPreferences]=useState({telegram_enabled:true,telegram_disputes_enabled:true,p2p_trades:true,deposits:true,withdrawals:true});useEffect(()=>{fetchTelegramStatus();fetchPreferences();},[]);const fetchTelegramStatus=async()=>{try{const token=localStorage.getItem('token');const response=await axios.get(\"\".concat(API,\"/api/telegram/status\"),{headers:{'Authorization':\"Bearer \".concat(token)},params:{user_id:user.user_id}});if(response.data.success){setTelegramStatus({linked:response.data.linked,username:response.data.telegram_username,chat_id:response.data.telegram_chat_id});}}catch(error){console.error('Failed to fetch Telegram status:',error);}};const fetchPreferences=async()=>{try{const token=localStorage.getItem('token');const response=await axios.get(\"\".concat(API,\"/api/telegram/notification-settings\"),{headers:{'Authorization':\"Bearer \".concat(token)},params:{user_id:user.user_id}});if(response.data.success){setPreferences(response.data.settings);}}catch(error){console.error('Failed to fetch preferences:',error);}};const handleConnectTelegram=async()=>{setLinkLoading(true);try{const token=localStorage.getItem('token');const response=await axios.get(\"\".concat(API,\"/api/telegram/link-url\"),{headers:{'Authorization':\"Bearer \".concat(token)},params:{user_id:user.user_id}});if(response.data.success){if(response.data.already_linked){toast.info(\"Already linked to @\".concat(response.data.telegram_username));}else{// Open Telegram link\nwindow.open(response.data.link_url,'_blank');toast.success('Opening Telegram... Click START in the bot!');// Poll for link completion\nsetTimeout(()=>{fetchTelegramStatus();},5000);}}}catch(error){toast.error('Failed to generate Telegram link');}finally{setLinkLoading(false);}};const handleUnlinkTelegram=async()=>{if(!window.confirm('Are you sure you want to unlink your Telegram account?')){return;}setLinkLoading(true);try{const token=localStorage.getItem('token');const response=await axios.post(\"\".concat(API,\"/api/telegram/unlink\"),{user_id:user.user_id},{headers:{'Authorization':\"Bearer \".concat(token)}});if(response.data.success){toast.success('Telegram unlinked successfully');setTelegramStatus({linked:false,username:null,chat_id:null});}}catch(error){toast.error('Failed to unlink Telegram');}finally{setLinkLoading(false);}};const handleSavePreferences=async()=>{setLoading(true);try{const token=localStorage.getItem('token');const response=await axios.put(\"\".concat(API,\"/api/telegram/notification-settings\"),{user_id:user.user_id,settings:preferences},{headers:{'Authorization':\"Bearer \".concat(token)}});if(response.data.success){toast.success('âœ… Telegram preferences saved!');}}catch(error){toast.error('Failed to save preferences');}finally{setLoading(false);}};const ToggleSwitch=_ref2=>{let{enabled,onChange,label,description,disabled}=_ref2;return/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'16px',background:'rgba(0, 0, 0, 0.2)',border:'1px solid rgba(0, 240, 255, 0.2)',borderRadius:'12px',marginBottom:'12px',opacity:disabled?0.5:1},children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"p\",{style:{color:'#FFFFFF',fontSize:'15px',fontWeight:'700',marginBottom:'4px'},children:label}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#666',fontSize:'13px',margin:0},children:description})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>!disabled&&onChange(!enabled),disabled:disabled,style:{width:'52px',height:'28px',borderRadius:'14px',background:enabled?'linear-gradient(135deg, #00F0FF, #9B4DFF)':'rgba(255, 255, 255, 0.2)',border:'none',cursor:disabled?'not-allowed':'pointer',position:'relative',transition:'all 0.3s',boxShadow:enabled?'0 0 20px rgba(0, 240, 255, 0.5)':'none'},children:/*#__PURE__*/_jsx(\"div\",{style:{width:'22px',height:'22px',borderRadius:'50%',background:'#1a1f3a',position:'absolute',top:'3px',left:enabled?'27px':'3px',transition:'all 0.3s',boxShadow:'0 2px 4px rgba(0, 0, 0, 0.2)'}})})]});};return/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0, 0, 0, 0.7)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:99999999,padding:'20px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#1a1f3a',border:'2px solid rgba(0, 136, 204, 0.4)',borderRadius:'20px',maxWidth:'550px',width:'100%',maxHeight:'90vh',overflow:'auto',boxShadow:'0 0 40px rgba(0, 136, 204, 0.3)'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'24px',borderBottom:'1px solid rgba(0, 136, 204, 0.2)',display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(\"h2\",{style:{fontSize:'24px',fontWeight:'800',color:'#FFFFFF',margin:0,display:'flex',alignItems:'center',gap:'10px'},children:[/*#__PURE__*/_jsx(FaTelegramPlane,{size:28,color:\"#0088cc\"}),\"Telegram Notifications\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,style:{background:'none',border:'none',color:'#666',cursor:'pointer',padding:'8px'},children:/*#__PURE__*/_jsx(IoClose,{size:28})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'24px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{background:telegramStatus.linked?'linear-gradient(135deg, rgba(0, 200, 83, 0.1), rgba(0, 136, 204, 0.1))':'rgba(255, 255, 255, 0.05)',border:telegramStatus.linked?'2px solid rgba(0, 200, 83, 0.4)':'2px dashed rgba(255, 255, 255, 0.2)',borderRadius:'16px',padding:'20px',marginBottom:'24px',textAlign:'center'},children:telegramStatus.linked?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'60px',height:'60px',borderRadius:'50%',background:'linear-gradient(135deg, #00C853, #0088cc)',display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 16px',boxShadow:'0 0 30px rgba(0, 200, 83, 0.4)'},children:/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:32,color:\"#fff\"})}),/*#__PURE__*/_jsx(\"h3\",{style:{color:'#00C853',margin:'0 0 8px',fontSize:'18px'},children:\"Connected to Telegram\"}),/*#__PURE__*/_jsxs(\"p\",{style:{color:'#aaa',margin:'0 0 16px',fontSize:'14px'},children:[\"@\",telegramStatus.username||'Unknown']}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleUnlinkTelegram,disabled:linkLoading,style:{padding:'10px 20px',background:'rgba(255, 100, 100, 0.2)',border:'1px solid rgba(255, 100, 100, 0.4)',borderRadius:'10px',color:'#ff6464',fontSize:'14px',fontWeight:'600',cursor:linkLoading?'not-allowed':'pointer',display:'flex',alignItems:'center',gap:'8px',margin:'0 auto'},children:[/*#__PURE__*/_jsx(IoUnlink,{size:18}),linkLoading?'Unlinking...':'Unlink Telegram']})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'60px',height:'60px',borderRadius:'50%',background:'rgba(0, 136, 204, 0.2)',display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 16px'},children:/*#__PURE__*/_jsx(FaTelegramPlane,{size:32,color:\"#0088cc\"})}),/*#__PURE__*/_jsx(\"h3\",{style:{color:'#fff',margin:'0 0 8px',fontSize:'18px'},children:\"Connect Your Telegram\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#888',margin:'0 0 16px',fontSize:'14px'},children:\"Get instant notifications for trades, disputes & more\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleConnectTelegram,disabled:linkLoading,style:{padding:'14px 28px',background:'linear-gradient(135deg, #0088cc, #00aced)',border:'none',borderRadius:'12px',color:'#fff',fontSize:'16px',fontWeight:'700',cursor:linkLoading?'not-allowed':'pointer',display:'flex',alignItems:'center',gap:'10px',margin:'0 auto',boxShadow:'0 4px 20px rgba(0, 136, 204, 0.4)'},children:[/*#__PURE__*/_jsx(IoLink,{size:20}),linkLoading?'Generating Link...':'Connect Telegram']})]})}),telegramStatus.linked&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{style:{color:'#fff',fontSize:'16px',marginBottom:'16px'},children:\"Notification Preferences\"}),/*#__PURE__*/_jsx(ToggleSwitch,{enabled:preferences.telegram_enabled,onChange:val=>setPreferences(_objectSpread(_objectSpread({},preferences),{},{telegram_enabled:val})),label:\"\\uD83D\\uDCF1 Enable Telegram Notifications\",description:\"Master switch for all Telegram alerts\"}),/*#__PURE__*/_jsx(ToggleSwitch,{enabled:preferences.telegram_disputes_enabled,onChange:val=>setPreferences(_objectSpread(_objectSpread({},preferences),{},{telegram_disputes_enabled:val})),label:\"\\u26A0\\uFE0F Dispute Alerts\",description:\"Get notified when disputes are raised or resolved\",disabled:!preferences.telegram_enabled}),/*#__PURE__*/_jsx(ToggleSwitch,{enabled:preferences.p2p_trades,onChange:val=>setPreferences(_objectSpread(_objectSpread({},preferences),{},{p2p_trades:val})),label:\"\\uD83E\\uDD1D P2P Trade Updates\",description:\"New trades, payment confirmations, completions\",disabled:!preferences.telegram_enabled}),/*#__PURE__*/_jsx(ToggleSwitch,{enabled:preferences.deposits,onChange:val=>setPreferences(_objectSpread(_objectSpread({},preferences),{},{deposits:val})),label:\"\\uD83D\\uDCB0 Deposit Alerts\",description:\"Get notified when deposits are confirmed\",disabled:!preferences.telegram_enabled}),/*#__PURE__*/_jsx(ToggleSwitch,{enabled:preferences.withdrawals,onChange:val=>setPreferences(_objectSpread(_objectSpread({},preferences),{},{withdrawals:val})),label:\"\\uD83D\\uDCB8 Withdrawal Alerts\",description:\"Get notified about withdrawal status\",disabled:!preferences.telegram_enabled}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSavePreferences,disabled:loading,style:{width:'100%',padding:'14px',background:loading?'rgba(0, 240, 255, 0.3)':'linear-gradient(135deg, #00F0FF 0%, #9B4DFF 100%)',border:'none',borderRadius:'12px',color:'#FFFFFF',fontSize:'15px',fontWeight:'700',cursor:loading?'not-allowed':'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:'8px',marginTop:'20px',boxShadow:loading?'none':'0 4px 20px rgba(0, 240, 255, 0.4)'},children:loading?'Saving...':/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:20}),\"Save Preferences\"]})})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:fetchTelegramStatus,style:{width:'100%',padding:'12px',background:'transparent',border:'1px solid rgba(255, 255, 255, 0.2)',borderRadius:'10px',color:'#888',fontSize:'14px',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:'8px',marginTop:'16px'},children:[/*#__PURE__*/_jsx(IoRefresh,{size:18}),\"Refresh Status\"]})]})]})});};export default TelegramSettings;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}