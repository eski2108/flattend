{"ast":null,"code":"import _objectSpread from\"/app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{IoClose,IoCard,IoAdd,IoTrash,IoCheckmarkCircle,IoWarning,IoPencil}from'react-icons/io5';import{toast}from'sonner';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;const PaymentMethodsManager=_ref=>{let{user,onClose}=_ref;const[loading,setLoading]=useState(false);const[view,setView]=useState('list');// 'list' | 'add' | 'edit'\nconst[paymentMethods,setPaymentMethods]=useState([]);const[currentMethod,setCurrentMethod]=useState(null);const[formData,setFormData]=useState({method_label:'',method_type:'bank_transfer',account_holder_name:'',bank_name:'',sort_code:'',account_number:'',iban:'',swift:'',is_primary:false});const paymentTypes=[{value:'bank_transfer',label:'Bank Transfer',icon:'ðŸ¦',fields:['account_holder_name','bank_name','sort_code','account_number']},{value:'faster_payments',label:'Faster Payments (UK)',icon:'âš¡',fields:['account_holder_name','bank_name','sort_code','account_number']},{value:'sepa',label:'SEPA Transfer',icon:'ðŸ‡ªðŸ‡º',fields:['account_holder_name','bank_name','iban','swift']},{value:'paypal',label:'PayPal',icon:'ðŸ”µ',fields:['account_holder_name']},{value:'revolut',label:'Revolut',icon:'ðŸ’³',fields:['account_holder_name']},{value:'wise',label:'Wise',icon:'ðŸŸ¢',fields:['account_holder_name','account_number']},{value:'cashapp',label:'Cash App',icon:'ðŸ’µ',fields:['account_holder_name']}];useEffect(()=>{fetchPaymentMethods();},[]);const fetchPaymentMethods=async()=>{setLoading(true);try{const token=localStorage.getItem('token');const response=await axios.get(\"\".concat(API,\"/api/user/payment-methods\"),{headers:{'Authorization':\"Bearer \".concat(token)},params:{user_id:user.user_id}});if(response.data.success){setPaymentMethods(response.data.methods||[]);}}catch(error){console.error('Failed to fetch payment methods:',error);}finally{setLoading(false);}};const handleAdd=()=>{setFormData({method_label:'',method_type:'bank_transfer',account_holder_name:'',bank_name:'',sort_code:'',account_number:'',iban:'',swift:'',is_primary:paymentMethods.length===0});setCurrentMethod(null);setView('add');};const handleEdit=method=>{var _method$details,_method$details2,_method$details3,_method$details4,_method$details5,_method$details6;setCurrentMethod(method);setFormData({method_label:method.method_label||'',method_type:method.method_type,account_holder_name:((_method$details=method.details)===null||_method$details===void 0?void 0:_method$details.account_holder_name)||'',bank_name:((_method$details2=method.details)===null||_method$details2===void 0?void 0:_method$details2.bank_name)||'',sort_code:((_method$details3=method.details)===null||_method$details3===void 0?void 0:_method$details3.sort_code)||'',account_number:((_method$details4=method.details)===null||_method$details4===void 0?void 0:_method$details4.account_number)||'',iban:((_method$details5=method.details)===null||_method$details5===void 0?void 0:_method$details5.iban)||'',swift:((_method$details6=method.details)===null||_method$details6===void 0?void 0:_method$details6.swift)||'',is_primary:method.is_primary||false});setView('edit');};const handleSave=async()=>{// Validation\nif(!formData.method_label){toast.error('Please enter a label for this payment method');return;}if(!formData.account_holder_name){toast.error('Account holder name is required');return;}setLoading(true);try{const token=localStorage.getItem('token');const methodData={user_id:user.user_id,method_label:formData.method_label,method_type:formData.method_type,details:{account_holder_name:formData.account_holder_name,bank_name:formData.bank_name,sort_code:formData.sort_code,account_number:formData.account_number,iban:formData.iban,swift:formData.swift},is_primary:formData.is_primary};const endpoint=currentMethod?\"\".concat(API,\"/api/user/payment-methods/\").concat(currentMethod.method_id):\"\".concat(API,\"/api/user/payment-methods\");const method=currentMethod?'put':'post';const response=await axios[method](endpoint,methodData,{headers:{'Authorization':\"Bearer \".concat(token)}});if(response.data.success){toast.success(\"\\u2705 Payment method \".concat(currentMethod?'updated':'added',\" successfully!\"));await fetchPaymentMethods();setView('list');}}catch(error){var _error$response,_error$response$data;toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.detail)||'Failed to save payment method');}finally{setLoading(false);}};const handleDelete=async(methodId,hasActiveOffers)=>{if(hasActiveOffers){toast.error('Cannot delete: This payment method is used in active P2P offers');return;}if(!window.confirm('Are you sure you want to delete this payment method?')){return;}setLoading(true);try{const token=localStorage.getItem('token');const response=await axios.delete(\"\".concat(API,\"/api/user/payment-methods/\").concat(methodId),{headers:{'Authorization':\"Bearer \".concat(token)},params:{user_id:user.user_id}});if(response.data.success){toast.success('Payment method deleted');await fetchPaymentMethods();}}catch(error){var _error$response2,_error$response2$data;toast.error(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.detail)||'Failed to delete payment method');}finally{setLoading(false);}};const selectedType=paymentTypes.find(t=>t.value===formData.method_type);return/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0, 0, 0, 0.7)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:99999999,padding:'20px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#1a1f3a',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'20px',maxWidth:'650px',width:'100%',maxHeight:'90vh',overflow:'auto',boxShadow:'0 0 40px rgba(0, 240, 255, 0.3)'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'24px',borderBottom:'1px solid rgba(0, 240, 255, 0.2)',display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(\"h2\",{style:{fontSize:'24px',fontWeight:'800',color:'#FFFFFF',margin:0,display:'flex',alignItems:'center',gap:'10px'},children:[/*#__PURE__*/_jsx(IoCard,{size:28,color:\"#00F0FF\"}),\"Payment Methods\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,style:{background:'none',border:'none',color:'#666',cursor:'pointer',padding:'8px'},children:/*#__PURE__*/_jsx(IoClose,{size:28})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'24px'},children:[view==='list'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{background:'rgba(0, 240, 255, 0.1)',border:'1px solid rgba(0, 240, 255, 0.3)',borderRadius:'12px',padding:'16px',marginBottom:'20px'},children:/*#__PURE__*/_jsxs(\"p\",{style:{color:'#00F0FF',fontSize:'14px',margin:0},children:[\"\\uD83D\\uDD17 \",/*#__PURE__*/_jsx(\"strong\",{children:\"P2P Integration:\"}),\" These payment methods are automatically available in your P2P offers\"]})}),paymentMethods.length===0?/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',padding:'40px 20px'},children:[/*#__PURE__*/_jsx(IoCard,{size:64,color:\"#888\",style:{marginBottom:'16px'}}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#666',fontSize:'16px',marginBottom:'24px'},children:\"No payment methods added yet\"})]}):/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'20px'},children:paymentMethods.map(method=>{var _paymentTypes$find,_paymentTypes$find2,_method$details7,_method$details8;return/*#__PURE__*/_jsx(\"div\",{style:{background:'rgba(0, 0, 0, 0.2)',border:\"2px solid \".concat(method.is_primary?'#00F0FF':'rgba(0, 240, 255, 0.2)'),borderRadius:'12px',padding:'16px',marginBottom:'12px',boxShadow:method.is_primary?'0 0 20px rgba(0, 240, 255, 0.2)':'none'},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'flex-start',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'8px',marginBottom:'8px'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'24px'},children:((_paymentTypes$find=paymentTypes.find(t=>t.value===method.method_type))===null||_paymentTypes$find===void 0?void 0:_paymentTypes$find.icon)||'ðŸ’³'}),/*#__PURE__*/_jsx(\"h3\",{style:{color:'#FFFFFF',fontSize:'16px',fontWeight:'700',margin:0},children:method.method_label||((_paymentTypes$find2=paymentTypes.find(t=>t.value===method.method_type))===null||_paymentTypes$find2===void 0?void 0:_paymentTypes$find2.label)}),method.is_primary&&/*#__PURE__*/_jsx(\"span\",{style:{background:'linear-gradient(135deg, #00F0FF, #9B4DFF)',padding:'4px 8px',borderRadius:'6px',fontSize:'11px',fontWeight:'700',color:'#FFFFFF'},children:\"PRIMARY\"})]}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#666',fontSize:'13px',margin:'4px 0'},children:(_method$details7=method.details)===null||_method$details7===void 0?void 0:_method$details7.account_holder_name}),((_method$details8=method.details)===null||_method$details8===void 0?void 0:_method$details8.bank_name)&&/*#__PURE__*/_jsxs(\"p\",{style:{color:'#666',fontSize:'13px',margin:'4px 0'},children:[method.details.bank_name,method.details.account_number&&\" \\u2022 ****\".concat(method.details.account_number.slice(-4))]}),method.in_use&&/*#__PURE__*/_jsxs(\"p\",{style:{color:'#FFC800',fontSize:'12px',margin:'8px 0 0',display:'flex',alignItems:'center',gap:'4px'},children:[/*#__PURE__*/_jsx(IoWarning,{size:14}),\"Used in active P2P offers\"]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'8px'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleEdit(method),style:{background:'rgba(0, 240, 255, 0.2)',border:'1px solid rgba(0, 240, 255, 0.4)',borderRadius:'8px',padding:'8px',color:'#00F0FF',cursor:'pointer'},children:/*#__PURE__*/_jsx(IoPencil,{size:18})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(method.method_id,method.in_use),disabled:method.in_use,style:{background:method.in_use?'rgba(255, 68, 68, 0.1)':'rgba(255, 68, 68, 0.2)',border:'1px solid rgba(255, 68, 68, 0.4)',borderRadius:'8px',padding:'8px',color:'#FF4444',cursor:method.in_use?'not-allowed':'pointer',opacity:method.in_use?0.5:1},children:/*#__PURE__*/_jsx(IoTrash,{size:18})})]})]})},method.method_id);})}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleAdd,style:{width:'100%',padding:'16px',background:'linear-gradient(135deg, #00F0FF 0%, #9B4DFF 100%)',border:'none',borderRadius:'12px',color:'#FFFFFF',fontSize:'16px',fontWeight:'700',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:'8px',boxShadow:'0 4px 20px rgba(0, 240, 255, 0.4)'},children:[/*#__PURE__*/_jsx(IoAdd,{size:24}),\"Add Payment Method\"]})]}),(view==='add'||view==='edit')&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('list'),style:{background:'none',border:'none',color:'#00F0FF',fontSize:'14px',fontWeight:'700',cursor:'pointer',marginBottom:'20px',padding:0},children:\"\\u2190 Back to list\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'#FFFFFF',fontSize:'13px',fontWeight:'700',marginBottom:'8px',display:'block',textTransform:'uppercase'},children:\"Payment Method Type *\"}),/*#__PURE__*/_jsx(\"select\",{value:formData.method_type,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{method_type:e.target.value})),disabled:view==='edit',style:{width:'100%',padding:'14px 16px',background:'rgba(0, 0, 0, 0.4)',border:'1px solid rgba(0, 240, 255, 0.4)',borderRadius:'12px',color:'#FFFFFF',fontSize:'15px',outline:'none',boxSizing:'border-box',cursor:view==='edit'?'not-allowed':'pointer'},children:paymentTypes.map(type=>/*#__PURE__*/_jsxs(\"option\",{value:type.value,children:[type.icon,\" \",type.label]},type.value))})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'#FFFFFF',fontSize:'13px',fontWeight:'700',marginBottom:'8px',display:'block',textTransform:'uppercase'},children:\"Method Label (e.g., \\\"My Barclays GBP\\\") *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.method_label,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{method_label:e.target.value})),placeholder:\"Give this method a friendly name\",style:{width:'100%',padding:'14px 16px',background:'rgba(0, 0, 0, 0.4)',border:'1px solid rgba(0, 240, 255, 0.4)',borderRadius:'12px',color:'#FFFFFF',fontSize:'15px',outline:'none',boxSizing:'border-box'}})]}),(selectedType===null||selectedType===void 0?void 0:selectedType.fields.includes('account_holder_name'))&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'#FFFFFF',fontSize:'13px',fontWeight:'700',marginBottom:'8px',display:'block',textTransform:'uppercase'},children:\"Account Holder Name *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.account_holder_name,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{account_holder_name:e.target.value})),style:{width:'100%',padding:'14px 16px',background:'rgba(0, 0, 0, 0.4)',border:'1px solid rgba(0, 240, 255, 0.4)',borderRadius:'12px',color:'#FFFFFF',fontSize:'15px',outline:'none',boxSizing:'border-box'}})]}),(selectedType===null||selectedType===void 0?void 0:selectedType.fields.includes('bank_name'))&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'#FFFFFF',fontSize:'13px',fontWeight:'700',marginBottom:'8px',display:'block',textTransform:'uppercase'},children:\"Bank Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.bank_name,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{bank_name:e.target.value})),style:{width:'100%',padding:'14px 16px',background:'rgba(0, 0, 0, 0.4)',border:'1px solid rgba(0, 240, 255, 0.4)',borderRadius:'12px',color:'#FFFFFF',fontSize:'15px',outline:'none',boxSizing:'border-box'}})]}),(selectedType===null||selectedType===void 0?void 0:selectedType.fields.includes('sort_code'))&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'#FFFFFF',fontSize:'13px',fontWeight:'700',marginBottom:'8px',display:'block',textTransform:'uppercase'},children:\"Sort Code\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.sort_code,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{sort_code:e.target.value})),placeholder:\"12-34-56\",style:{width:'100%',padding:'14px 16px',background:'rgba(0, 0, 0, 0.4)',border:'1px solid rgba(0, 240, 255, 0.4)',borderRadius:'12px',color:'#FFFFFF',fontSize:'15px',outline:'none',boxSizing:'border-box'}})]}),(selectedType===null||selectedType===void 0?void 0:selectedType.fields.includes('account_number'))&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'#FFFFFF',fontSize:'13px',fontWeight:'700',marginBottom:'8px',display:'block',textTransform:'uppercase'},children:\"Account Number\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.account_number,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{account_number:e.target.value})),placeholder:\"12345678\",style:{width:'100%',padding:'14px 16px',background:'rgba(0, 0, 0, 0.4)',border:'1px solid rgba(0, 240, 255, 0.4)',borderRadius:'12px',color:'#FFFFFF',fontSize:'15px',outline:'none',boxSizing:'border-box'}})]}),(selectedType===null||selectedType===void 0?void 0:selectedType.fields.includes('iban'))&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'#FFFFFF',fontSize:'13px',fontWeight:'700',marginBottom:'8px',display:'block',textTransform:'uppercase'},children:\"IBAN\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.iban,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{iban:e.target.value})),placeholder:\"GB29 NWBK 6016 1331 9268 19\",style:{width:'100%',padding:'14px 16px',background:'rgba(0, 0, 0, 0.4)',border:'1px solid rgba(0, 240, 255, 0.4)',borderRadius:'12px',color:'#FFFFFF',fontSize:'15px',outline:'none',boxSizing:'border-box'}})]}),(selectedType===null||selectedType===void 0?void 0:selectedType.fields.includes('swift'))&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'#FFFFFF',fontSize:'13px',fontWeight:'700',marginBottom:'8px',display:'block',textTransform:'uppercase'},children:\"SWIFT/BIC Code\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.swift,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{swift:e.target.value})),placeholder:\"NWBKGB2L\",style:{width:'100%',padding:'14px 16px',background:'rgba(0, 0, 0, 0.4)',border:'1px solid rgba(0, 240, 255, 0.4)',borderRadius:'12px',color:'#FFFFFF',fontSize:'15px',outline:'none',boxSizing:'border-box'}})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'16px',background:'rgba(0, 0, 0, 0.2)',border:'1px solid rgba(0, 240, 255, 0.2)',borderRadius:'12px',marginBottom:'24px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{style:{color:'#FFFFFF',fontSize:'15px',fontWeight:'700',marginBottom:'4px'},children:\"Set as Primary Method\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#666',fontSize:'13px',margin:0},children:\"Default method for P2P transactions\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setFormData(_objectSpread(_objectSpread({},formData),{},{is_primary:!formData.is_primary})),style:{width:'52px',height:'28px',borderRadius:'14px',background:formData.is_primary?'linear-gradient(135deg, #00F0FF, #9B4DFF)':'rgba(255, 255, 255, 0.2)',border:'none',cursor:'pointer',position:'relative',transition:'all 0.3s',boxShadow:formData.is_primary?'0 0 20px rgba(0, 240, 255, 0.5)':'none'},children:/*#__PURE__*/_jsx(\"div\",{style:{width:'22px',height:'22px',borderRadius:'50%',background:'#1a1f3a',position:'absolute',top:'3px',left:formData.is_primary?'27px':'3px',transition:'all 0.3s',boxShadow:'0 2px 4px rgba(0, 0, 0, 0.2)'}})})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,disabled:loading,style:{width:'100%',padding:'16px',background:loading?'rgba(0, 240, 255, 0.3)':'linear-gradient(135deg, #00F0FF 0%, #9B4DFF 100%)',border:'none',borderRadius:'12px',color:'#FFFFFF',fontSize:'16px',fontWeight:'700',cursor:loading?'not-allowed':'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:'8px',boxShadow:loading?'none':'0 4px 20px rgba(0, 240, 255, 0.4)'},children:loading?'Saving...':/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:24}),view==='add'?'Add Payment Method':'Save Changes']})})]})]})]})});};export default PaymentMethodsManager;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}