{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{IoClose,IoChatbubbles,IoSend,IoCloudUpload,IoShield}from'react-icons/io5';import axios from'axios';import{toast}from'sonner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;export default function DisputeChatModal(_ref){let{isOpen,onClose,disputeId,userId,userRole}=_ref;const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[loading,setLoading]=useState(false);const[evidence,setEvidence]=useState(null);const messagesEndRef=useRef(null);useEffect(()=>{if(isOpen&&disputeId){loadMessages();const interval=setInterval(loadMessages,5000);// Poll every 5 seconds\nreturn()=>clearInterval(interval);}},[isOpen,disputeId]);useEffect(()=>{scrollToBottom();},[messages]);const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};const loadMessages=async()=>{try{const response=await axios.get(\"\".concat(API,\"/api/p2p/disputes/\").concat(disputeId));if(response.data.success){setMessages(response.data.dispute.messages||[]);}}catch(error){console.error('Error loading messages:',error);}};const handleSendMessage=async()=>{if(!newMessage.trim())return;setLoading(true);try{const response=await axios.post(\"\".concat(API,\"/api/p2p/disputes/\").concat(disputeId,\"/message\"),{sender_id:userId,sender_type:userRole,message:newMessage});if(response.data.success){setNewMessage('');loadMessages();}}catch(error){console.error('Error sending message:',error);toast.error('Failed to send message');}finally{setLoading(false);}};const handleUploadEvidence=async e=>{const file=e.target.files[0];if(!file)return;const formData=new FormData();formData.append('file',file);formData.append('dispute_id',disputeId);formData.append('uploaded_by',userId);try{const response=await axios.post(\"\".concat(API,\"/api/p2p/disputes/\").concat(disputeId,\"/evidence\"),formData,{headers:{'Content-Type':'multipart/form-data'}});if(response.data.success){toast.success('Evidence uploaded successfully');loadMessages();}}catch(error){console.error('Error uploading evidence:',error);toast.error('Failed to upload evidence');}};if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-900 border-2 border-orange-500 rounded-2xl max-w-3xl w-full h-[600px] shadow-2xl flex flex-col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-orange-600 to-red-600 p-4 rounded-t-2xl flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(IoChatbubbles,{className:\"w-6 h-6 text-white\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-white\",children:\"Dispute Chat\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-orange-100 text-sm\",children:[\"ID: \",disputeId===null||disputeId===void 0?void 0:disputeId.slice(0,8)]})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-white/80 hover:text-white transition-colors\",children:/*#__PURE__*/_jsx(IoClose,{className:\"w-6 h-6\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto p-4 space-y-3\",children:[messages.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-full text-gray-500\",children:/*#__PURE__*/_jsx(\"p\",{children:\"No messages yet. Start the conversation.\"})}):messages.map((msg,idx)=>/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(msg.sender_type==='admin'?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-[70%] rounded-lg p-3 \".concat(msg.sender_type==='admin'?'bg-gradient-to-r from-purple-600 to-indigo-600 text-white':'bg-slate-800 text-gray-200'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-1\",children:[msg.sender_type==='admin'&&/*#__PURE__*/_jsx(IoShield,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-sm capitalize\",children:msg.sender_type}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs opacity-70\",children:new Date(msg.timestamp).toLocaleTimeString()})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:msg.message})]})},idx)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-4 border-t border-slate-700\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"cursor-pointer bg-slate-700 hover:bg-slate-600 p-3 rounded-lg transition-colors\",children:[/*#__PURE__*/_jsx(IoCloudUpload,{className:\"w-5 h-5 text-cyan-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:handleUploadEvidence,className:\"hidden\",accept:\"image/*,.pdf\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newMessage,onChange:e=>setNewMessage(e.target.value),onKeyPress:e=>e.key==='Enter'&&handleSendMessage(),placeholder:\"Type your message...\",className:\"flex-1 bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-orange-500 focus:outline-none\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSendMessage,disabled:loading||!newMessage.trim(),className:\"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 disabled:opacity-50 p-3 rounded-lg transition-all\",children:/*#__PURE__*/_jsx(IoSend,{className:\"w-5 h-5 text-white\"})})]})})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}