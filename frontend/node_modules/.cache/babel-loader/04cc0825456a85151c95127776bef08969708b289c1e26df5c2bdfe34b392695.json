{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import Layout from'@/components/Layout';import{Card}from'@/components/ui/card';import{Button}from'@/components/ui/button';import{IoCloudDownload,IoFilter}from'react-icons/io5';import{BiArrowToTop,BiArrowFromTop}from'react-icons/bi';;import axios from'axios';import{toast}from'sonner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BACKEND_URL=process.env.REACT_APP_BACKEND_URL;const API=BACKEND_URL;export default function Transactions(){const navigate=useNavigate();const[transactions,setTransactions]=useState([]);const[filteredTransactions,setFilteredTransactions]=useState([]);const[loading,setLoading]=useState(true);const[currentUser,setCurrentUser]=useState(null);const[filterType,setFilterType]=useState('all');// all, deposit, withdrawal\nconst[filterCurrency,setFilterCurrency]=useState('all');// all, BTC, ETH, USDT\nuseEffect(()=>{const userData=localStorage.getItem('cryptobank_user');if(!userData){navigate('/');return;}const user=JSON.parse(userData);setCurrentUser(user);fetchTransactions(user.user_id);},[navigate]);useEffect(()=>{applyFilters();},[transactions,filterType,filterCurrency]);const fetchTransactions=async userId=>{try{setLoading(true);const response=await axios.get(\"\".concat(API,\"/api/crypto-bank/transactions/\").concat(userId,\"?limit=100\"));if(response.data.success){setTransactions(response.data.transactions);}}catch(error){console.error('Error fetching transactions:',error);toast.error('Failed to load transactions');}finally{setLoading(false);}};const applyFilters=()=>{let filtered=[...transactions];if(filterType!=='all'){filtered=filtered.filter(tx=>tx.transaction_type===filterType);}if(filterCurrency!=='all'){filtered=filtered.filter(tx=>tx.currency===filterCurrency);}setFilteredTransactions(filtered);};const formatCurrency=(amount,currency)=>{if(currency==='USDT'){return\"$\".concat(amount.toFixed(2));}return\"\".concat(amount.toFixed(6),\" \").concat(currency);};const formatDate=dateString=>{return new Date(dateString).toLocaleString('en-US',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});};const getStatusColor=status=>{switch(status){case'completed':return'status-completed';case'pending':return'status-pending';case'failed':return'status-failed';default:return'';}};if(loading){return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(\"div\",{className:\"loading-container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"})})});}return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"transactions-page\",\"data-testid\":\"transactions-page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"page-header\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"page-title\",children:\"Transaction History\"}),/*#__PURE__*/_jsx(\"p\",{className:\"page-subtitle\",children:\"View all your deposits and withdrawals\"})]}),/*#__PURE__*/_jsxs(Button,{className:\"download-btn\",onClick:()=>toast.info('Export feature coming soon!'),children:[/*#__PURE__*/_jsx(IoCloudDownload,{size:18}),\"Export\"]})]}),/*#__PURE__*/_jsx(Card,{className:\"filters-card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"filters-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(IoFilter,{size:18}),/*#__PURE__*/_jsx(\"label\",{children:\"Type:\"}),/*#__PURE__*/_jsxs(\"select\",{value:filterType,onChange:e=>setFilterType(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Types\"}),/*#__PURE__*/_jsx(\"option\",{value:\"deposit\",children:\"Deposits\"}),/*#__PURE__*/_jsx(\"option\",{value:\"withdrawal\",children:\"Withdrawals\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Currency:\"}),/*#__PURE__*/_jsxs(\"select\",{value:filterCurrency,onChange:e=>setFilterCurrency(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Currencies\"}),/*#__PURE__*/_jsx(\"option\",{value:\"BTC\",children:\"Bitcoin (BTC)\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ETH\",children:\"Ethereum (ETH)\"}),/*#__PURE__*/_jsx(\"option\",{value:\"USDT\",children:\"Tether (USDT)\"})]})]}),/*#__PURE__*/_jsx(Button,{variant:\"outline\",onClick:()=>{setFilterType('all');setFilterCurrency('all');},children:\"Clear Filters\"})]})}),filteredTransactions.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"transactions-list-container\",children:filteredTransactions.map(tx=>/*#__PURE__*/_jsx(Card,{className:\"transaction-card\",\"data-testid\":\"transaction-card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"transaction-card-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"transaction-icon-wrapper\",children:tx.transaction_type==='deposit'?/*#__PURE__*/_jsx(\"div\",{className:\"transaction-icon-bg deposit\",children:/*#__PURE__*/_jsx(BiArrowFromTop,{size:24})}):/*#__PURE__*/_jsx(\"div\",{className:\"transaction-icon-bg withdrawal\",children:/*#__PURE__*/_jsx(BiArrowToTop,{size:24})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"transaction-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"transaction-main\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"transaction-type\",children:tx.transaction_type.charAt(0).toUpperCase()+tx.transaction_type.slice(1)}),/*#__PURE__*/_jsxs(\"p\",{className:\"transaction-id\",children:[\"ID: \",tx.transaction_id.substring(0,8),\"...\"]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"transaction-date\",children:formatDate(tx.created_at)}),tx.reference&&/*#__PURE__*/_jsxs(\"p\",{className:\"transaction-reference\",children:[\"To: \",tx.reference.substring(0,10),\"...\",tx.reference.substring(tx.reference.length-10)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"transaction-amount-wrapper\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"transaction-amount \".concat(tx.transaction_type),children:[tx.transaction_type==='deposit'?'+':'-',formatCurrency(tx.amount,tx.currency)]}),/*#__PURE__*/_jsx(\"span\",{className:\"transaction-status \".concat(getStatusColor(tx.status)),children:tx.status})]})]})},tx.transaction_id))}):/*#__PURE__*/_jsxs(Card,{className:\"empty-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"empty-icon-wrapper\",children:/*#__PURE__*/_jsx(BiArrowFromTop,{size:48,className:\"empty-icon\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"No Transactions Found\"}),/*#__PURE__*/_jsx(\"p\",{children:filterType!=='all'||filterCurrency!=='all'?'Try adjusting your filters':'Make your first deposit to get started'}),filterType==='all'&&filterCurrency==='all'&&/*#__PURE__*/_jsx(Button,{onClick:()=>navigate('/wallet'),children:\"Go to Wallet\"})]})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}