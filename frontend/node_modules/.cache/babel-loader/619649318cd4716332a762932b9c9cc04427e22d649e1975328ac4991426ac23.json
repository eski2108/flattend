{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import axios from'axios';import{toast}from'sonner';import{IoAlertCircle,IoChatbubbles,IoCheckmark as Check,IoCheckmarkCircle,IoCloudUpload,IoShield,IoTime}from'react-icons/io5';import OTPModal from'@/components/OTPModal';import P2PNotifications from'@/components/P2PNotifications';import DisputeModal from'@/components/DisputeModal';import DisputeChatModal from'@/components/DisputeChatModal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;export default function P2PTradeDetailDemo(){var _trade$trade_id,_dispute$dispute_id,_dispute$reason,_trade$price_per_unit,_trade$fiat_amount,_trade$trade_id2;const{tradeId}=useParams();const navigate=useNavigate();const[trade,setTrade]=useState(null);const[loading,setLoading]=useState(true);const[timeRemaining,setTimeRemaining]=useState(0);const[chatMessages,setChatMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[showOtpModal,setShowOtpModal]=useState(false);const[otpCode,setOtpCode]=useState('');const[proofFile,setProofFile]=useState(null);const[user,setUser]=useState(null);const[showDisputeModal,setShowDisputeModal]=useState(false);const[showDisputeChatModal,setShowDisputeChatModal]=useState(false);const[dispute,setDispute]=useState(null);useEffect(()=>{const userData=JSON.parse(localStorage.getItem('cryptobank_user')||'{}');setUser(userData);loadTradeDetails();},[tradeId]);useEffect(()=>{if(timeRemaining>0){const timer=setTimeout(()=>setTimeRemaining(timeRemaining-1),1000);return()=>clearTimeout(timer);}},[timeRemaining]);const loadTradeDetails=async()=>{try{const response=await axios.get(\"\".concat(API,\"/api/p2p/trade/\").concat(tradeId));if(response.data.success){setTrade(response.data.trade);setTimeRemaining(response.data.time_remaining_seconds||0);// Load chat messages (mock for now)\nsetChatMessages([{sender:'seller',text:'Hi! Please transfer to the account details shown above.',time:'2 min ago'},{sender:'buyer',text:'Payment sent! Uploading proof now.',time:'1 min ago'}]);}}catch(error){console.error('Error loading trade:',error);toast.error('Failed to load trade details');}finally{setLoading(false);}};const handleMarkPaid=async()=>{try{const response=await axios.post(\"\".concat(API,\"/api/p2p/mark-paid\"),{trade_id:tradeId,buyer_id:user.user_id});if(response.data.success){toast.success('Payment marked as complete!');loadTradeDetails();}}catch(error){console.error('Error marking as paid:',error);toast.error('Failed to mark as paid');}};const handleReleaseCrypto=()=>{setShowOtpModal(true);};const confirmRelease=async()=>{try{const response=await axios.post(\"\".concat(API,\"/api/p2p/release-crypto\"),{trade_id:tradeId,seller_id:user.user_id,otp_code:otpCode});if(response.data.success){toast.success('Crypto released successfully!');setShowOtpModal(false);loadTradeDetails();}}catch(error){console.error('Error releasing crypto:',error);toast.error('Failed to release crypto');}};const handleSendMessage=()=>{if(newMessage.trim()){setChatMessages([...chatMessages,{sender:user.user_id===(trade===null||trade===void 0?void 0:trade.buyer_id)?'buyer':'seller',text:newMessage,time:'Just now'}]);setNewMessage('');}};const formatTime=seconds=>{const mins=Math.floor(seconds/60);const secs=seconds%60;return\"\".concat(mins,\":\").concat(secs.toString().padStart(2,'0'));};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-white text-xl\",children:\"Loading trade...\"})});}if(!trade){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-white text-xl\",children:\"Trade not found\"})});}const isBuyer=(user===null||user===void 0?void 0:user.user_id)===trade.buyer_id;const isSeller=(user===null||user===void 0?void 0:user.user_id)===trade.seller_id;return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/p2p-marketplace'),className:\"text-cyan-400 mb-4\",children:\"\\u2190 Back to Marketplace\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"h1\",{className:\"text-3xl font-bold text-white\",children:[\"Trade #\",(_trade$trade_id=trade.trade_id)===null||_trade$trade_id===void 0?void 0:_trade$trade_id.slice(0,8)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[timeRemaining>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 bg-orange-900/30 px-6 py-3 rounded-xl border border-orange-500/30\",children:[/*#__PURE__*/_jsx(IoTime,{className:\"w-6 h-6 text-orange-400\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-orange-400 font-bold text-2xl\",children:formatTime(timeRemaining)}),/*#__PURE__*/_jsx(\"div\",{className:\"text-orange-300 text-xs\",children:\"Time remaining\"})]})]}),(user===null||user===void 0?void 0:user.user_id)&&/*#__PURE__*/_jsx(P2PNotifications,{userId:user.user_id,tradeId:tradeId,onNotificationClick:notification=>{// Handle notification click (e.g., scroll to relevant section)\nif(notification.notification_type==='message_received'){var _document$getElementB;(_document$getElementB=document.getElementById('chat-section'))===null||_document$getElementB===void 0?void 0:_document$getElementB.scrollIntoView({behavior:'smooth'});}}})]})]})]}),trade.status==='disputed'&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-r from-red-900/50 to-orange-900/50 border-2 border-red-500 rounded-xl p-6 mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-4\",children:[/*#__PURE__*/_jsx(IoAlertCircle,{className:\"w-8 h-8 text-red-400 flex-shrink-0\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-red-300 mb-2\",children:\"\\u26A0\\uFE0F Dispute In Progress\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-300 mb-3\",children:\"This trade is under admin review. Both parties can submit evidence and communicate with the admin. The losing party will be charged a \\xA35 dispute fee.\"}),dispute&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-black/20 rounded-lg p-4 mb-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-3 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Dispute ID:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white ml-2 font-mono\",children:(_dispute$dispute_id=dispute.dispute_id)===null||_dispute$dispute_id===void 0?void 0:_dispute$dispute_id.slice(0,8)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Status:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-orange-400 ml-2 font-semibold\",children:dispute.status})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Opened:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white ml-2\",children:new Date(dispute.created_at).toLocaleString()})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Reason:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white ml-2 capitalize\",children:(_dispute$reason=dispute.reason)===null||_dispute$reason===void 0?void 0:_dispute$reason.replace(/_/g,' ')})]})]})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowDisputeChatModal(true),className:\"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white px-6 py-3 rounded-lg font-semibold transition-all\",children:\"View Dispute Chat\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-2 space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-4\",children:[/*#__PURE__*/_jsx(IoShield,{className:\"w-6 h-6 text-cyan-400\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white\",children:\"Trade Status\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[trade.status==='waiting_payment'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IoAlertCircle,{className:\"w-8 h-8 text-yellow-400\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-yellow-400 font-bold text-lg\",children:\"Waiting for Payment\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-sm\",children:\"Buyer must complete payment\"})]})]}),trade.status==='paid'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{className:\"w-8 h-8 text-green-400\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-green-400 font-bold text-lg\",children:\"Payment Received\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-sm\",children:\"Waiting for seller to release crypto\"})]})]}),trade.status==='completed'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{className:\"w-8 h-8 text-green-400\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-green-400 font-bold text-lg\",children:\"Completed\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-sm\",children:\"Trade completed successfully\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-cyan-500/30 rounded-xl p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-4\",children:[/*#__PURE__*/_jsx(IoShield,{className:\"w-6 h-6 text-cyan-400\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white\",children:\"Escrow Protection\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4 \".concat(trade.status==='completed'?'bg-green-900/20 border-green-500/30':'bg-cyan-900/20 border-cyan-500/30'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-300\",children:\"Amount in Escrow:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-cyan-400 font-bold text-lg\",children:[trade.crypto_amount,\" \",trade.crypto_currency]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-300\",children:\"Escrow Status:\"}),trade.status==='completed'?/*#__PURE__*/_jsx(\"span\",{className:\"text-green-400 font-semibold\",children:\"\\u2713 Released\"}):trade.escrow_locked?/*#__PURE__*/_jsx(\"span\",{className:\"text-yellow-400 font-semibold\",children:\"\\uD83D\\uDD12 Locked\"}):/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400 font-semibold\",children:\"\\u25CB Not Locked\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-3 text-xs text-gray-400\",children:trade.status==='completed'?'âœ… Funds have been successfully released to the buyer.':'ðŸ”’ Funds are safely held in escrow and will be released once seller confirms payment.'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white mb-4\",children:\"Trade Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Amount:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-white font-semibold\",children:[trade.crypto_amount,\" \",trade.crypto_currency]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Price:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-white font-semibold\",children:[\"\\xA3\",(_trade$price_per_unit=trade.price_per_unit)===null||_trade$price_per_unit===void 0?void 0:_trade$price_per_unit.toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Total:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-white font-bold text-lg\",children:[\"\\xA3\",(_trade$fiat_amount=trade.fiat_amount)===null||_trade$fiat_amount===void 0?void 0:_trade$fiat_amount.toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Payment Method:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:trade.payment_method})]}),isBuyer&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Seller:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"John Seller \\u2B50\"})]}),isSeller&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Buyer:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"gads21083\"})]})]})]}),isBuyer&&trade.status==='waiting_payment'&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-blue-500/30 rounded-xl p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white mb-4\",children:\"\\uD83D\\uDCB3 Payment Instructions\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Bank:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"HSBC\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Account:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"12345678\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Sort Code:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"40-47-84\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Reference:\"}),\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"text-cyan-400 font-mono\",children:[\"TRADE\",(_trade$trade_id2=trade.trade_id)===null||_trade$trade_id2===void 0?void 0:_trade$trade_id2.slice(0,8)]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 text-sm text-yellow-400\",children:\"\\u26A0\\uFE0F Please include the reference code in your transfer!\"})]}),isBuyer&&trade.status==='waiting_payment'&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white mb-4\",children:\"\\uD83D\\uDCCE Upload Payment Proof\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-2 border-dashed border-slate-600 rounded-lg p-8 text-center hover:border-cyan-500 transition-colors cursor-pointer\",children:[/*#__PURE__*/_jsx(IoCloudUpload,{className:\"w-12 h-12 text-gray-400 mx-auto mb-3\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",className:\"hidden\",id:\"proof-upload\",onChange:e=>setProofFile(e.target.files[0])}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"proof-upload\",className:\"cursor-pointer\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-white mb-2\",children:\"Click to upload or drag and drop\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-sm\",children:\"PNG, JPG or PDF (max. 5MB)\"})]}),proofFile&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 text-green-400\",children:[\"\\u2713 \",proofFile.name]})]})]}),isSeller&&trade.status==='paid'&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-green-500/30 rounded-xl p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white mb-4\",children:\"\\u2705 Buyer Marked Payment Complete\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-900/20 border border-green-500/30 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-green-400 font-semibold mb-2\",children:\"Payment Confirmation Received\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-300 text-sm mb-3\",children:\"The buyer has marked the payment as complete. Please verify the payment in your bank account before releasing crypto.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-yellow-400\",children:\"\\u26A0\\uFE0F Only release crypto after confirming the payment has arrived in your account!\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-4\",children:[isBuyer&&trade.status==='waiting_payment'&&/*#__PURE__*/_jsx(\"button\",{onClick:handleMarkPaid,className:\"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition-colors shadow-lg hover:shadow-green-500/50\",children:\"\\u2713 I Have Paid\"}),isSeller&&trade.status==='paid'&&/*#__PURE__*/_jsx(\"button\",{onClick:handleReleaseCrypto,className:\"flex-1 bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-4 px-6 rounded-xl transition-colors shadow-lg hover:shadow-cyan-500/50\",children:\"\\uD83D\\uDD13 Release Crypto\"}),trade.status==='completed'&&/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 bg-green-900/30 border border-green-500/30 text-green-400 font-bold py-4 px-6 rounded-xl text-center\",children:\"\\u2705 Trade Completed\"}),(trade.status==='waiting_payment'||trade.status==='paid')&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(window.confirm('Are you sure you want to cancel this trade? Funds will be returned to seller.')){// Cancel trade logic\ntoast.info('Cancel trade functionality coming soon');}},className:\"bg-slate-700 hover:bg-slate-600 text-white px-6 py-4 rounded-xl transition-colors\",children:\"Cancel Trade\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowDisputeModal(true),className:\"bg-orange-600 hover:bg-orange-700 text-white px-6 py-4 rounded-xl transition-colors\",children:\"Open Dispute\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"lg:col-span-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 h-[600px] flex flex-col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-4\",children:[/*#__PURE__*/_jsx(IoChatbubbles,{className:\"w-5 h-5 text-cyan-400\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-white\",children:\"Chat\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-y-auto space-y-3 mb-4\",children:chatMessages.map((msg,idx)=>/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(msg.sender==='buyer'?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-[80%] rounded-lg p-3 \".concat(msg.sender==='buyer'?'bg-cyan-600 text-white':'bg-slate-700 text-gray-200'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm\",children:msg.text}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs opacity-70 mt-1\",children:msg.time})]})},idx))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newMessage,onChange:e=>setNewMessage(e.target.value),onKeyPress:e=>e.key==='Enter'&&handleSendMessage(),placeholder:\"Type message...\",className:\"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSendMessage,className:\"bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg\",children:\"Send\"})]})]})})]})]}),/*#__PURE__*/_jsx(OTPModal,{isOpen:showOtpModal,onClose:()=>setShowOtpModal(false),onVerify:async code=>{try{const response=await axios.post(\"\".concat(API,\"/api/crypto-market/release-crypto\"),{order_id:tradeId,otp_code:code,seller_id:user.user_id});if(response.data.success){toast.success('Crypto released successfully!');setShowOtpModal(false);loadTradeDetails();}else{toast.error(response.data.message||'Failed to release crypto');}}catch(error){var _error$response,_error$response$data;console.error('Error releasing crypto:',error);toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.detail)||'Failed to release crypto');}},title:\"\\uD83D\\uDD10 Confirm Release\",description:trade?\"You are about to release \".concat(trade.crypto_amount,\" \").concat(trade.crypto_currency,\" to the buyer. Enter the 6-digit OTP code sent to your email.\"):'Verify your identity to release crypto.',userId:user===null||user===void 0?void 0:user.user_id,action:\"p2p_release\"}),/*#__PURE__*/_jsx(DisputeModal,{isOpen:showDisputeModal,onClose:()=>setShowDisputeModal(false),tradeId:tradeId,userId:user===null||user===void 0?void 0:user.user_id,onDisputeCreated:newDispute=>{setDispute(newDispute);setShowDisputeModal(false);loadTradeDetails();}}),dispute&&/*#__PURE__*/_jsx(DisputeChatModal,{isOpen:showDisputeChatModal,onClose:()=>setShowDisputeChatModal(false),disputeId:dispute.dispute_id,userId:user===null||user===void 0?void 0:user.user_id,userRole:(user===null||user===void 0?void 0:user.user_id)===(trade===null||trade===void 0?void 0:trade.buyer_id)?'buyer':'seller'})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}