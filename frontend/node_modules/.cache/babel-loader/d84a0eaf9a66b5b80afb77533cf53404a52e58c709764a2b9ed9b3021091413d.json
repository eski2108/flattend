{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate,useLocation}from'react-router-dom';import axios from'axios';import{toast}from'react-hot-toast';import Layout from'@/components/Layout';import{ArrowLeft,IoAlertCircle,IoArrowBack,IoCheckmark as Check,IoCheckmarkCircle,IoShield,IoTime as Clock}from'react-icons/io5';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;function OrderConfirmation(){var _offer$ad_data3,_offer$ad_data4,_offer$ad_data5,_offer$ad_data6,_offer$ad_data7,_offer$price_per_unit,_offer$ad_data8;const navigate=useNavigate();const location=useLocation();const{offer,orderType,crypto}=location.state||{};const[amount,setAmount]=useState('');const[buyerWalletAddress,setBuyerWalletAddress]=useState('');const[walletNetwork,setWalletNetwork]=useState('');const[isValidatingWallet,setIsValidatingWallet]=useState(false);const[walletValid,setWalletValid]=useState(null);const[processing,setProcessing]=useState(false);const[termsAccepted,setTermsAccepted]=useState(false);useEffect(()=>{if(!offer||!orderType){toast.error('Invalid order data');navigate('/p2p');}},[offer,orderType,navigate]);// Validate wallet address in real-time\nuseEffect(()=>{if(buyerWalletAddress&&buyerWalletAddress.length>10&&orderType==='buy'){validateWallet();}},[buyerWalletAddress]);const validateWallet=async()=>{setIsValidatingWallet(true);try{var _offer$ad_data;const response=await axios.post(\"\".concat(API,\"/api/wallet/validate\"),{address:buyerWalletAddress,currency:crypto||((_offer$ad_data=offer.ad_data)===null||_offer$ad_data===void 0?void 0:_offer$ad_data.crypto_currency),network:walletNetwork||'mainnet'});if(response.data.valid){setWalletValid(true);}else{setWalletValid(false);}}catch(error){setWalletValid(false);}finally{setIsValidatingWallet(false);}};const calculateTotal=()=>{const amountNum=parseFloat(amount)||0;return(amountNum*offer.price_per_unit).toFixed(2);};const handleConfirmOrder=async()=>{// Validation\nif(!amount||parseFloat(amount)<=0){toast.error('Please enter a valid amount');return;}const amountNum=parseFloat(amount);if(amountNum<offer.min_limit){toast.error(\"Minimum amount is \".concat(offer.min_limit,\" GBP\"));return;}if(amountNum>offer.max_limit){toast.error(\"Maximum amount is \".concat(offer.max_limit,\" GBP\"));return;}if(orderType==='buy'&&(!buyerWalletAddress||!walletValid)){toast.error('Please enter a valid wallet address');return;}if(!termsAccepted){toast.error('Please accept the terms and conditions');return;}setProcessing(true);try{var _offer$ad_data2;// Get user from localStorage\nconst userStr=localStorage.getItem('user');if(!userStr){toast.error('Please login to create orders');navigate('/login');return;}const user=JSON.parse(userStr);// Calculate crypto amount from fiat\nconst cryptoAmount=amountNum/offer.price_per_unit;// Create trade via backend\nconst tradeData={sell_order_id:offer.offer_id||((_offer$ad_data2=offer.ad_data)===null||_offer$ad_data2===void 0?void 0:_offer$ad_data2.ad_id),buyer_id:user.user_id,crypto_amount:cryptoAmount,fiat_amount:parseFloat(calculateTotal()),buyer_wallet_address:buyerWalletAddress,buyer_wallet_network:walletNetwork||'mainnet',payment_method:offer.payment_methods[0]// Use first payment method\n};const response=await axios.post(\"\".concat(API,\"/api/p2p/create-trade\"),tradeData);if(response.data.success){toast.success('Order created successfully! Crypto locked in escrow.');navigate(\"/trade/\".concat(response.data.trade.trade_id));}}catch(error){var _error$response,_error$response$data;console.error('Error creating order:',error);toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.detail)||'Failed to create order');}finally{setProcessing(false);}};if(!offer){return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(\"div\",{style:{padding:'2rem',textAlign:'center',color:'#fff'},children:\"Loading...\"})});}return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'1000px',margin:'0 auto',padding:'2rem 1rem'},children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/p2p'),style:{display:'flex',alignItems:'center',gap:'0.5rem',padding:'0.75rem 1.5rem',background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'12px',color:'#00F0FF',fontSize:'0.875rem',fontWeight:'600',cursor:'pointer',marginBottom:'2rem'},children:[/*#__PURE__*/_jsx(IoArrowBack,{size:18}),\"Back to P2P Trading\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'linear-gradient(135deg, rgba(0, 240, 255, 0.1), rgba(168, 85, 247, 0.1))',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'16px',padding:'1.5rem',marginBottom:'2rem'},children:[/*#__PURE__*/_jsxs(\"h1\",{style:{fontSize:'1.75rem',fontWeight:'900',color:'#00F0FF',marginBottom:'0.5rem',textTransform:'uppercase'},children:[orderType==='buy'?'Buy':'Sell',\" \",crypto||((_offer$ad_data3=offer.ad_data)===null||_offer$ad_data3===void 0?void 0:_offer$ad_data3.crypto_currency)]}),/*#__PURE__*/_jsx(\"p\",{style:{color:'rgba(255,255,255,0.6)',fontSize:'0.875rem'},children:\"Confirm your order details below\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'2rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'16px',padding:'2rem'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#00F0FF',fontSize:'1.25rem',fontWeight:'700',marginBottom:'1.5rem'},children:\"Order Details\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'block',color:'rgba(255,255,255,0.8)',fontSize:'0.875rem',marginBottom:'0.5rem',fontWeight:'600'},children:[\"I want to \",orderType==='buy'?'spend':'receive',\" (GBP)\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:amount,onChange:e=>setAmount(e.target.value),placeholder:\"Min: \\xA3\".concat(offer.min_limit,\" - Max: \\xA3\").concat(offer.max_limit),style:{width:'100%',padding:'0.875rem',background:'rgba(0, 0, 0, 0.4)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'10px',color:'#fff',fontSize:'1rem'}}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginTop:'0.5rem',fontSize:'0.75rem',color:'rgba(255,255,255,0.6)'},children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Min: \\xA3\",offer.min_limit]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Max: \\xA3\",offer.max_limit]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem',background:'rgba(0, 240, 255, 0.1)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'10px',marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'0.75rem',color:'rgba(255,255,255,0.6)',marginBottom:'0.25rem'},children:[\"You will \",orderType==='buy'?'receive':'send',\":\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'1.5rem',fontWeight:'700',color:'#00F0FF'},children:[amount?(parseFloat(amount)/offer.price_per_unit).toFixed(8):'0.00000000',\" \",crypto||((_offer$ad_data4=offer.ad_data)===null||_offer$ad_data4===void 0?void 0:_offer$ad_data4.crypto_currency)]})]}),orderType==='buy'&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'block',color:'rgba(255,255,255,0.8)',fontSize:'0.875rem',marginBottom:'0.5rem',fontWeight:'600'},children:[\"Your Wallet Address \",/*#__PURE__*/_jsx(\"span\",{style:{color:'#EF4444'},children:\"*\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:buyerWalletAddress,onChange:e=>setBuyerWalletAddress(e.target.value),placeholder:\"Enter your \".concat(crypto||((_offer$ad_data5=offer.ad_data)===null||_offer$ad_data5===void 0?void 0:_offer$ad_data5.crypto_currency),\" wallet address\"),style:{width:'100%',padding:'0.875rem',background:'rgba(0, 0, 0, 0.4)',border:\"2px solid \".concat(walletValid===true?'#22C55E':walletValid===false?'#EF4444':'rgba(0, 240, 255, 0.3)'),borderRadius:'10px',color:'#fff',fontSize:'0.875rem'}}),isValidatingWallet&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.75rem',color:'#00F0FF',marginTop:'0.5rem'},children:\"Validating wallet address...\"}),walletValid===true&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem',fontSize:'0.75rem',color:'#22C55E',marginTop:'0.5rem'},children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:14}),\"Valid wallet address\"]}),walletValid===false&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem',fontSize:'0.75rem',color:'#EF4444',marginTop:'0.5rem'},children:[/*#__PURE__*/_jsx(IoAlertCircle,{size:14}),\"Invalid wallet address\"]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',color:'rgba(255,255,255,0.8)',fontSize:'0.875rem',marginBottom:'0.5rem',fontWeight:'600'},children:\"Payment Method\"}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexWrap:'wrap',gap:'0.5rem'},children:offer.payment_methods&&offer.payment_methods.map((method,idx)=>/*#__PURE__*/_jsx(\"span\",{style:{padding:'0.5rem 1rem',background:'rgba(0, 240, 255, 0.2)',border:'2px solid #00F0FF',borderRadius:'8px',fontSize:'0.875rem',color:'#00F0FF',fontWeight:'600'},children:method},idx))})]}),/*#__PURE__*/_jsx(\"div\",{style:{padding:'1rem',background:'rgba(168, 85, 247, 0.1)',border:'2px solid rgba(168, 85, 247, 0.3)',borderRadius:'10px',marginBottom:'1.5rem'},children:/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'flex-start',gap:'0.75rem',cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:termsAccepted,onChange:e=>setTermsAccepted(e.target.checked),style:{marginTop:'0.25rem',width:'18px',height:'18px',cursor:'pointer'}}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'0.875rem',color:'rgba(255,255,255,0.8)',lineHeight:'1.5'},children:\"I agree to the terms and conditions. I understand that crypto will be locked in escrow until payment is confirmed.\"})]})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleConfirmOrder,disabled:processing||orderType==='buy'&&!walletValid,style:{width:'100%',padding:'1.25rem',background:processing||orderType==='buy'&&!walletValid?'rgba(0, 240, 255, 0.3)':'linear-gradient(135deg, #00F0FF, #00B8E6)',border:'none',borderRadius:'12px',color:processing||orderType==='buy'&&!walletValid?'rgba(255,255,255,0.5)':'#0a1628',fontSize:'1.125rem',fontWeight:'700',cursor:processing||orderType==='buy'&&!walletValid?'not-allowed':'pointer',boxShadow:processing||orderType==='buy'&&!walletValid?'none':'0 4px 20px rgba(0, 240, 255, 0.4)'},children:processing?'Creating Order...':\"\".concat(orderType==='buy'?'Buy':'Sell',\" \").concat(crypto||((_offer$ad_data6=offer.ad_data)===null||_offer$ad_data6===void 0?void 0:_offer$ad_data6.crypto_currency))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'16px',padding:'1.5rem',marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsxs(\"h3\",{style:{color:'#00F0FF',fontSize:'1rem',fontWeight:'700',marginBottom:'1rem'},children:[orderType==='buy'?'Seller':'Buyer',\" Information\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'1rem',marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'50px',height:'50px',borderRadius:'50%',background:'linear-gradient(135deg, #00F0FF, #A855F7)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'1.5rem',fontWeight:'700',color:'#0a1628'},children:(offer.seller_name||offer.buyer_name||'U')[0].toUpperCase()}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'1.125rem',fontWeight:'700',color:'#fff'},children:offer.seller_name||offer.buyer_name||'User'}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'0.875rem',color:'rgba(255,255,255,0.6)'},children:[\"\\u2B50 \",offer.seller_rating||offer.buyer_rating||4.8,\" | \",offer.completed_trades||0,\" trades\"]})]})]}),offer.verified&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem',fontSize:'0.875rem',color:'#22C55E'},children:[/*#__PURE__*/_jsx(IoShield,{size:16}),\"Verified Trader\"]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(26, 31, 58, 0.8)',border:'2px solid rgba(0, 240, 255, 0.3)',borderRadius:'16px',padding:'1.5rem',marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{color:'#00F0FF',fontSize:'1rem',fontWeight:'700',marginBottom:'1rem'},children:\"Order Summary\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',gap:'0.75rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',fontSize:'0.875rem'},children:[/*#__PURE__*/_jsxs(\"span\",{style:{color:'rgba(255,255,255,0.6)'},children:[\"Price per \",crypto||((_offer$ad_data7=offer.ad_data)===null||_offer$ad_data7===void 0?void 0:_offer$ad_data7.crypto_currency),\":\"]}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#fff',fontWeight:'600'},children:[\"\\xA3\",(_offer$price_per_unit=offer.price_per_unit)===null||_offer$price_per_unit===void 0?void 0:_offer$price_per_unit.toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',fontSize:'0.875rem'},children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'rgba(255,255,255,0.6)'},children:\"Amount:\"}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#fff',fontWeight:'600'},children:[amount?(parseFloat(amount)/offer.price_per_unit).toFixed(8):'0.00000000',\" \",crypto||((_offer$ad_data8=offer.ad_data)===null||_offer$ad_data8===void 0?void 0:_offer$ad_data8.crypto_currency)]})]}),/*#__PURE__*/_jsx(\"div\",{style:{height:'1px',background:'rgba(0, 240, 255, 0.3)',margin:'0.5rem 0'}}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',fontSize:'1.125rem'},children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'#fff',fontWeight:'700'},children:\"Total:\"}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#00F0FF',fontWeight:'700'},children:[\"\\xA3\",calculateTotal()]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem',background:'rgba(34, 197, 94, 0.1)',border:'2px solid rgba(34, 197, 94, 0.3)',borderRadius:'12px',display:'flex',gap:'0.75rem'},children:[/*#__PURE__*/_jsx(IoShield,{size:20,color:\"#22C55E\",style:{flexShrink:0,marginTop:'0.125rem'}}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'0.875rem',color:'rgba(255,255,255,0.8)',lineHeight:'1.6'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:'700',color:'#22C55E',marginBottom:'0.25rem'},children:\"Secure Escrow Protection\"}),\"Your crypto will be safely locked in escrow until payment is confirmed. Never send payment outside the platform.\"]})]})]})]})]})});}export default OrderConfirmation;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}