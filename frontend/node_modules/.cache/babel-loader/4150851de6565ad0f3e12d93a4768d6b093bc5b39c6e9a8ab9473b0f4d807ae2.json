{"ast":null,"code":"import _objectSpread from\"/app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{IoAlertCircle,IoChatbubbles,IoCheckmark as Check,IoClose as X,IoNotifications,IoShield,IoTrendingUp}from'react-icons/io5';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BACKEND_URL=process.env.REACT_APP_BACKEND_URL;export default function NotificationBell(){const[notifications,setNotifications]=useState([]);const[unreadCount,setUnreadCount]=useState(0);const[isOpen,setIsOpen]=useState(false);const[loading,setLoading]=useState(false);const dropdownRef=useRef(null);const navigate=useNavigate();// Poll for notifications every 30 seconds\nuseEffect(()=>{fetchNotifications();const interval=setInterval(fetchNotifications,30000);return()=>clearInterval(interval);},[]);// Close dropdown when clicking outside\nuseEffect(()=>{function handleClickOutside(event){if(dropdownRef.current&&!dropdownRef.current.contains(event.target)){setIsOpen(false);}}document.addEventListener('mousedown',handleClickOutside);return()=>document.removeEventListener('mousedown',handleClickOutside);},[]);const fetchNotifications=async()=>{try{const token=localStorage.getItem('token');if(!token)return;const response=await fetch(\"\".concat(BACKEND_URL,\"/api/notifications?limit=10\"),{headers:{'Authorization':\"Bearer \".concat(token),'Content-Type':'application/json'}});if(response.ok){const data=await response.json();setNotifications(data.notifications||[]);setUnreadCount(data.unread_count||0);}}catch(error){console.error('Failed to fetch notifications:',error);}};const markAsRead=async notificationIds=>{try{const token=localStorage.getItem('token');if(!token)return;const response=await fetch(\"\".concat(BACKEND_URL,\"/api/notifications/mark-read\"),{method:'POST',headers:{'Authorization':\"Bearer \".concat(token),'Content-Type':'application/json'},body:JSON.stringify({notification_ids:notificationIds})});if(response.ok){// Update local state\nsetNotifications(prev=>prev.map(n=>notificationIds.includes(n.id)?_objectSpread(_objectSpread({},n),{},{is_read:true}):n));setUnreadCount(prev=>Math.max(0,prev-notificationIds.length));}}catch(error){console.error('Failed to mark as read:',error);}};const markAllAsRead=async()=>{try{setLoading(true);const token=localStorage.getItem('token');if(!token)return;const response=await fetch(\"\".concat(BACKEND_URL,\"/api/notifications/mark-all-read\"),{method:'POST',headers:{'Authorization':\"Bearer \".concat(token),'Content-Type':'application/json'}});if(response.ok){// Update local state\nsetNotifications(prev=>prev.map(n=>_objectSpread(_objectSpread({},n),{},{is_read:true})));setUnreadCount(0);}}catch(error){console.error('Failed to mark all as read:',error);}finally{setLoading(false);}};const handleNotificationClick=async notification=>{// Mark as read if unread\nif(!notification.is_read){await markAsRead([notification.id]);}// Navigate to link if exists\nif(notification.link){navigate(notification.link);}setIsOpen(false);};const getNotificationIcon=type=>{switch(type){case'login_alert':return/*#__PURE__*/_jsx(IoShield,{size:18,style:{color:'#00F0FF'}});case'p2p_trade_update':case'deposit_confirmed':case'withdrawal_completed':case'swap_completed':case'staking_reward':return/*#__PURE__*/_jsx(IoTrendingUp,{size:18,style:{color:'#22C55E'}});case'dispute_update':return/*#__PURE__*/_jsx(IoAlertCircle,{size:18,style:{color:'#EF4444'}});case'admin_announcement':return/*#__PURE__*/_jsx(IoChatbubbles,{size:18,style:{color:'#A855F7'}});default:return/*#__PURE__*/_jsx(IoNotifications,{size:18,style:{color:'#64748B'}});}};const getTimeAgo=timestamp=>{const now=new Date();const time=new Date(timestamp);const diffMs=now-time;const diffMins=Math.floor(diffMs/60000);const diffHours=Math.floor(diffMs/3600000);const diffDays=Math.floor(diffMs/86400000);if(diffMins<1)return'Just now';if(diffMins<60)return\"\".concat(diffMins,\" min ago\");if(diffHours<24)return\"\".concat(diffHours,\" hour\").concat(diffHours>1?'s':'',\" ago\");if(diffDays<7)return\"\".concat(diffDays,\" day\").concat(diffDays>1?'s':'',\" ago\");return time.toLocaleDateString();};return/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative'},ref:dropdownRef,children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setIsOpen(!isOpen),style:{position:'relative',background:'rgba(0, 240, 255, 0.1)',border:'1px solid rgba(0, 240, 255, 0.3)',borderRadius:'10px',padding:'0.625rem',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',transition:'all 0.3s ease'},onMouseEnter:e=>{e.currentTarget.style.background='rgba(0, 240, 255, 0.15)';e.currentTarget.style.borderColor='rgba(0, 240, 255, 0.5)';},onMouseLeave:e=>{e.currentTarget.style.background='rgba(0, 240, 255, 0.1)';e.currentTarget.style.borderColor='rgba(0, 240, 255, 0.3)';},children:[/*#__PURE__*/_jsx(IoNotifications,{size:20,style:{color:'#00F0FF'}}),unreadCount>0&&/*#__PURE__*/_jsx(\"span\",{style:{position:'absolute',top:'-4px',right:'-4px',background:'linear-gradient(135deg, #EF4444, #DC2626)',color:'white',borderRadius:'50%',width:'18px',height:'18px',fontSize:'0.625rem',fontWeight:'700',display:'flex',alignItems:'center',justifyContent:'center',boxShadow:'0 2px 8px rgba(239, 68, 68, 0.4)'},children:unreadCount>9?'9+':unreadCount})]}),isOpen&&/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',top:'calc(100% + 10px)',right:0,width:'380px',maxWidth:'90vw',maxHeight:'500px',background:'linear-gradient(135deg, #0F172A 0%, #1E293B 100%)',border:'1px solid rgba(0, 240, 255, 0.2)',borderRadius:'12px',boxShadow:'0 8px 32px rgba(0, 0, 0, 0.5)',overflow:'hidden',zIndex:1000},children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem 1.25rem',borderBottom:'1px solid rgba(0, 240, 255, 0.2)',display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:0,fontSize:'1rem',fontWeight:'700',background:'linear-gradient(135deg, #00F0FF, #A855F7)',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent'},children:\"Notifications\"}),unreadCount>0&&/*#__PURE__*/_jsx(\"button\",{onClick:markAllAsRead,disabled:loading,style:{background:'none',border:'none',color:'#00F0FF',fontSize:'0.75rem',fontWeight:'600',cursor:'pointer',padding:'0.25rem 0.5rem',borderRadius:'6px',transition:'all 0.2s ease',opacity:loading?0.5:1},onMouseEnter:e=>{if(!loading)e.currentTarget.style.background='rgba(0, 240, 255, 0.1)';},onMouseLeave:e=>{e.currentTarget.style.background='none';},children:loading?'Marking...':'Mark all read'})]}),/*#__PURE__*/_jsx(\"div\",{style:{maxHeight:'400px',overflowY:'auto'},children:notifications.length===0?/*#__PURE__*/_jsxs(\"div\",{style:{padding:'3rem 1.5rem',textAlign:'center',color:'#64748B'},children:[/*#__PURE__*/_jsx(IoNotifications,{size:48,style:{margin:'0 auto 1rem',opacity:0.3}}),/*#__PURE__*/_jsx(\"p\",{style:{margin:0,fontSize:'0.875rem'},children:\"No notifications yet\"})]}):notifications.map(notification=>/*#__PURE__*/_jsxs(\"div\",{onClick:()=>handleNotificationClick(notification),style:{padding:'1rem 1.25rem',borderBottom:'1px solid rgba(0, 240, 255, 0.1)',cursor:'pointer',background:notification.is_read?'transparent':'rgba(0, 240, 255, 0.05)',transition:'all 0.2s ease',display:'flex',gap:'0.75rem'},onMouseEnter:e=>{e.currentTarget.style.background='rgba(0, 240, 255, 0.1)';},onMouseLeave:e=>{e.currentTarget.style.background=notification.is_read?'transparent':'rgba(0, 240, 255, 0.05)';},children:[/*#__PURE__*/_jsx(\"div\",{style:{flexShrink:0,width:'36px',height:'36px',background:'rgba(0, 240, 255, 0.1)',borderRadius:'8px',display:'flex',alignItems:'center',justifyContent:'center'},children:getNotificationIcon(notification.type)}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,minWidth:0},children:[/*#__PURE__*/_jsx(\"p\",{style:{margin:0,fontSize:'0.875rem',fontWeight:notification.is_read?'400':'600',color:notification.is_read?'#94A3B8':'#E2E8F0',marginBottom:'0.25rem'},children:notification.title}),/*#__PURE__*/_jsx(\"p\",{style:{margin:0,fontSize:'0.75rem',color:'#64748B',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'},children:notification.message}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'0.25rem 0 0',fontSize:'0.625rem',color:'#475569'},children:getTimeAgo(notification.created_at)})]}),!notification.is_read&&/*#__PURE__*/_jsx(\"div\",{style:{flexShrink:0,width:'8px',height:'8px',background:'#00F0FF',borderRadius:'50%',boxShadow:'0 0 8px rgba(0, 240, 255, 0.6)'}})]},notification.id))}),notifications.length>0&&/*#__PURE__*/_jsx(\"div\",{style:{padding:'0.75rem 1.25rem',borderTop:'1px solid rgba(0, 240, 255, 0.2)',textAlign:'center'},children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>{navigate('/notifications');setIsOpen(false);},style:{background:'none',border:'none',color:'#00F0FF',fontSize:'0.875rem',fontWeight:'600',cursor:'pointer',padding:'0.5rem 1rem',borderRadius:'6px',transition:'all 0.2s ease'},onMouseEnter:e=>{e.currentTarget.style.background='rgba(0, 240, 255, 0.1)';},onMouseLeave:e=>{e.currentTarget.style.background='none';},children:\"View all notifications \\u2192\"})})]})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}