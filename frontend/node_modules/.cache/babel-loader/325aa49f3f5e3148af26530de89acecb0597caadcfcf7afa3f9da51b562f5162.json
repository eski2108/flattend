{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate,useParams}from'react-router-dom';import{IoArrowBack,IoCheckmarkCircle,IoAlertCircle,IoCopyOutline,IoQrCodeOutline}from'react-icons/io5';import axios from'axios';import{getCoinLogo}from'@/utils/coinLogos';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;export default function SendPage(){const navigate=useNavigate();const{currency}=useParams();const[loading,setLoading]=useState(true);const[submitting,setSubmitting]=useState(false);const[success,setSuccess]=useState(false);const[error,setError]=useState('');// ALL data from backend\nconst[metadata,setMetadata]=useState(null);const[recipientAddress,setRecipientAddress]=useState('');const[amount,setAmount]=useState('');const[txResult,setTxResult]=useState(null);useEffect(()=>{if(!currency){navigate('/wallet');return;}loadMetadata();},[currency]);const loadMetadata=async()=>{const userData=localStorage.getItem('cryptobank_user');if(!userData){navigate('/login');return;}const user=JSON.parse(userData);try{setLoading(true);setError('');// Get ALL metadata from backend\nconst res=await axios.get(\"\".concat(API,\"/api/wallet/send/\").concat(currency.toUpperCase(),\"/metadata\"),{params:{user_id:user.user_id}});if(res.data.success){setMetadata(res.data);}else{setError(res.data.error||'Failed to load data');}}catch(err){var _err$response,_err$response$data;console.error('Failed to load metadata:',err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||'Failed to load page data');}finally{setLoading(false);}};const handlePaste=async()=>{try{const text=await navigator.clipboard.readText();setRecipientAddress(text);}catch(err){console.error('Paste failed:',err);}};const handleMax=()=>{if(!metadata)return;const maxAmount=Math.max(0,metadata.available_balance-metadata.estimated_network_fee);setAmount(maxAmount.toFixed(metadata.decimals));};const handleSend=async()=>{setError('');if(!recipientAddress){setError('Please enter recipient address');return;}if(!amount||parseFloat(amount)<=0){setError('Please enter a valid amount');return;}setSubmitting(true);try{const userData=localStorage.getItem('cryptobank_user');const user=JSON.parse(userData);const res=await axios.post(\"\".concat(API,\"/api/wallet/send/\").concat(currency.toUpperCase()),{user_id:user.user_id,recipient_address:recipientAddress,amount:parseFloat(amount)});if(res.data.success){setSuccess(true);setTxResult(res.data);// Refresh balance\nawait loadMetadata();// Redirect after 5 seconds\nsetTimeout(()=>{navigate('/wallet');},5000);}else{setError(res.data.error||'Transaction failed');}}catch(err){var _err$response2,_err$response2$data;console.error('Send failed:',err);setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.error)||'Failed to send. Please try again.');}finally{setSubmitting(false);}};if(loading){return/*#__PURE__*/_jsxs(\"div\",{style:{minHeight:'100vh',background:'linear-gradient(180deg, #0B1120 0%, #060A14 100%)',display:'flex',alignItems:'center',justifyContent:'center',color:'#6B7A99'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'12px',fontSize:'15px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'18px',height:'18px',border:'2px solid rgba(0,229,255,0.2)',borderTop:'2px solid #00E5FF',borderRadius:'50%',animation:'spin 0.8s linear infinite'}}),\"Loading...\"]}),/*#__PURE__*/_jsx(\"style\",{children:\"@keyframes spin { to { transform: rotate(360deg); } }\"})]});}if(!metadata){return/*#__PURE__*/_jsxs(\"div\",{style:{minHeight:'100vh',background:'linear-gradient(180deg, #0B1120 0%, #060A14 100%)',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',color:'#fff',padding:'20px'},children:[/*#__PURE__*/_jsx(IoAlertCircle,{size:48,color:\"#EA3943\",style:{marginBottom:'16px'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'18px',fontWeight:'600',marginBottom:'8px'},children:\"Failed to load\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'14px',color:'#8FA3C8',marginBottom:'20px'},children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/wallet'),style:{padding:'12px 24px',borderRadius:'12px',border:'none',background:'#00E5FF',color:'#001018',fontSize:'15px',fontWeight:'600',cursor:'pointer'},children:\"Go Back\"})]});}const isDisabled=submitting||success||!recipientAddress||!amount;return/*#__PURE__*/_jsxs(\"div\",{style:{minHeight:'100vh',background:'linear-gradient(180deg, #0B1120 0%, #060A14 100%)',color:'#fff',fontFamily:'\"Inter\", -apple-system, BlinkMacSystemFont, sans-serif'},children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:'24px 20px',borderBottom:'1px solid rgba(255,255,255,0.06)'},children:/*#__PURE__*/_jsx(\"div\",{style:{maxWidth:'600px',margin:'0 auto'},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'16px',marginBottom:'8px'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(-1),style:{width:'40px',height:'40px',borderRadius:'12px',border:'1px solid rgba(255,255,255,0.08)',background:'rgba(255,255,255,0.04)',color:'#fff',display:'flex',alignItems:'center',justifyContent:'center',cursor:'pointer',transition:'all 0.2s'},onMouseEnter:e=>e.target.style.background='rgba(255,255,255,0.08)',onMouseLeave:e=>e.target.style.background='rgba(255,255,255,0.04)',children:/*#__PURE__*/_jsx(IoArrowBack,{size:20})}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'22px',fontWeight:'700',letterSpacing:'-0.02em'},children:[\"Send \",metadata.currency]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'14px',opacity:0.7,marginTop:'2px'},children:[\"Send \",metadata.currency_name,\" to an external address\"]})]}),/*#__PURE__*/_jsx(\"div\",{style:{padding:'6px 14px',borderRadius:'999px',background:'rgba(0,229,255,0.08)',border:'1px solid rgba(0,229,255,0.2)',fontSize:'12px',fontWeight:'600',color:'#00E5FF'},children:metadata.network})]})})}),/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'600px',margin:'0 auto',padding:'32px 20px'},children:[success&&txResult&&/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'24px',padding:'20px',borderRadius:'16px',background:'rgba(22,199,132,0.08)',border:'1px solid rgba(22,199,132,0.2)',boxShadow:'0 8px 32px rgba(22,199,132,0.12), 0 0 0 1px rgba(22,199,132,0.1)'},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'14px'},children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:28,color:\"#16C784\",style:{flexShrink:0,marginTop:'2px'}}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'16px',fontWeight:'700',color:'#16C784',marginBottom:'8px'},children:\"Withdrawal Submitted\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'14px',color:'#C5D0E6',marginBottom:'12px'},children:txResult.message}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'13px',color:'#8FA3C8',fontFamily:'monospace',lineHeight:'1.6'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"TX ID: \",/*#__PURE__*/_jsx(\"span\",{style:{color:'#fff'},children:txResult.tx_id})]}),txResult.provider_tx_id&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'4px'},children:[\"Provider: \",/*#__PURE__*/_jsx(\"span\",{style:{color:'#fff'},children:txResult.provider_tx_id})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'4px'},children:[\"Status: \",/*#__PURE__*/_jsx(\"span\",{style:{color:'#F0B90B',textTransform:'uppercase'},children:txResult.status})]})]})]})]})}),error&&!success&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'24px',padding:'16px 18px',borderRadius:'14px',background:'rgba(234,57,67,0.08)',border:'1px solid rgba(234,57,67,0.25)',display:'flex',alignItems:'flex-start',gap:'12px'},children:[/*#__PURE__*/_jsx(IoAlertCircle,{size:22,color:\"#EA3943\",style:{flexShrink:0,marginTop:'1px'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'14px',color:'#EA3943',lineHeight:'1.5'},children:error})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'28px',padding:'20px',borderRadius:'18px',background:'linear-gradient(135deg, rgba(0,71,217,0.06) 0%, rgba(0,229,255,0.06) 100%)',border:'1px solid rgba(0,229,255,0.15)',boxShadow:'0 8px 32px rgba(0,0,0,0.3), 0 0 0 1px rgba(0,229,255,0.05), 0 4px 16px rgba(0,229,255,0.08)',position:'relative',overflow:'hidden'},children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:'-50%',right:'-30%',width:'200px',height:'200px',background:'radial-gradient(circle, rgba(0,229,255,0.15) 0%, transparent 70%)',filter:'blur(40px)',pointerEvents:'none'}}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative',display:'flex',alignItems:'center',gap:'16px'},children:[/*#__PURE__*/_jsx(\"img\",{src:getCoinLogo(metadata.currency),alt:metadata.currency,style:{width:'48px',height:'48px',borderRadius:'50%',boxShadow:'0 4px 12px rgba(0,0,0,0.3)'}}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'13px',color:'#8FA3C8',marginBottom:'4px',fontWeight:'500'},children:[\"Available \",metadata.currency]}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'28px',fontWeight:'700',color:'#00E5FF',letterSpacing:'-0.02em'},children:metadata.available_balance.toFixed(metadata.decimals)}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'14px',color:'#6B7A99',marginTop:'2px'},children:[\"\\u2248 \\xA3\",metadata.gbp_value.toFixed(2)]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:'13px',fontWeight:'600',color:'#8FA3C8',marginBottom:'10px'},children:\"Recipient Address\"}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:recipientAddress,onChange:e=>setRecipientAddress(e.target.value),placeholder:\"Enter \".concat(metadata.currency,\" address\"),disabled:submitting||success,style:{width:'100%',height:'52px',padding:'0 90px 0 16px',borderRadius:'14px',border:'1px solid rgba(255,255,255,0.08)',background:'rgba(255,255,255,0.03)',color:'#fff',fontSize:'14px',fontFamily:'monospace',outline:'none',transition:'all 0.2s'},onFocus:e=>{e.target.style.border='1px solid rgba(0,229,255,0.4)';e.target.style.boxShadow='0 0 0 3px rgba(0,229,255,0.08)';},onBlur:e=>{e.target.style.border='1px solid rgba(255,255,255,0.08)';e.target.style.boxShadow='none';}}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',right:'8px',top:'50%',transform:'translateY(-50%)',display:'flex',gap:'6px'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:handlePaste,disabled:submitting||success,style:{width:'36px',height:'36px',borderRadius:'10px',border:'none',background:'rgba(255,255,255,0.06)',color:'#8FA3C8',display:'flex',alignItems:'center',justifyContent:'center',cursor:submitting||success?'not-allowed':'pointer',transition:'all 0.2s'},onMouseEnter:e=>!submitting&&!success&&(e.target.style.background='rgba(255,255,255,0.1)',e.target.style.color='#fff'),onMouseLeave:e=>(e.target.style.background='rgba(255,255,255,0.06)',e.target.style.color='#8FA3C8'),children:/*#__PURE__*/_jsx(IoCopyOutline,{size:18})}),/*#__PURE__*/_jsx(\"button\",{disabled:true,style:{width:'36px',height:'36px',borderRadius:'10px',border:'none',background:'rgba(255,255,255,0.03)',color:'#4A5568',display:'flex',alignItems:'center',justifyContent:'center',cursor:'not-allowed',opacity:0.4},children:/*#__PURE__*/_jsx(IoQrCodeOutline,{size:18})})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'24px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'10px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{fontSize:'13px',fontWeight:'600',color:'#8FA3C8'},children:\"Amount\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',color:'#6B7A99'},children:[\"Available: \",/*#__PURE__*/_jsxs(\"span\",{style:{color:'#8FA3C8',fontWeight:'500'},children:[metadata.available_balance.toFixed(metadata.decimals),\" \",metadata.currency]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"any\",value:amount,onChange:e=>setAmount(e.target.value),placeholder:\"0.00\",disabled:submitting||success,style:{width:'100%',height:'52px',padding:'0 70px 0 16px',borderRadius:'14px',border:'1px solid rgba(255,255,255,0.08)',background:'rgba(255,255,255,0.03)',color:'#fff',fontSize:'18px',fontWeight:'600',outline:'none',transition:'all 0.2s'},onFocus:e=>{e.target.style.border='1px solid rgba(0,229,255,0.4)';e.target.style.boxShadow='0 0 0 3px rgba(0,229,255,0.08)';},onBlur:e=>{e.target.style.border='1px solid rgba(255,255,255,0.08)';e.target.style.boxShadow='none';}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleMax,disabled:submitting||success,style:{position:'absolute',right:'8px',top:'8px',height:'36px',padding:'0 16px',borderRadius:'999px',border:'none',background:'linear-gradient(135deg, rgba(0,229,255,0.15) 0%, rgba(0,184,212,0.15) 100%)',color:'#00E5FF',fontSize:'13px',fontWeight:'700',cursor:submitting||success?'not-allowed':'pointer',boxShadow:'0 0 12px rgba(0,229,255,0.2)',transition:'all 0.2s'},onMouseEnter:e=>!submitting&&!success&&(e.target.style.boxShadow='0 0 20px rgba(0,229,255,0.35)'),onMouseLeave:e=>e.target.style.boxShadow='0 0 12px rgba(0,229,255,0.2)',children:\"MAX\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'32px',padding:'14px 18px',borderRadius:'12px',background:'rgba(255,255,255,0.02)',border:'1px solid rgba(255,255,255,0.04)'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginBottom:'8px'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'13px',color:'#8FA3C8'},children:\"Estimated network fee\"}),/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:'13px',fontWeight:'600',color:'#fff'},children:[metadata.estimated_network_fee,\" \",metadata.currency]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'13px',color:'#8FA3C8'},children:\"Minimum withdrawal\"}),/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:'13px',fontWeight:'600',color:'#fff'},children:[metadata.minimum_withdrawal,\" \",metadata.currency]})]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleSend,disabled:isDisabled,style:{width:'100%',height:'56px',borderRadius:'16px',border:'none',background:isDisabled?'rgba(0,229,255,0.15)':'linear-gradient(135deg, #00E5FF 0%, #7B2CFF 100%)',color:isDisabled?'#4A5568':'#fff',fontSize:'16px',fontWeight:'700',cursor:isDisabled?'not-allowed':'pointer',boxShadow:isDisabled?'none':'0 8px 32px rgba(0,229,255,0.3), 0 0 0 1px rgba(0,229,255,0.2)',transition:'all 0.2s',display:'flex',alignItems:'center',justifyContent:'center',gap:'10px'},onMouseEnter:e=>{if(!isDisabled){e.target.style.transform='translateY(-2px)';e.target.style.boxShadow='0 12px 40px rgba(0,229,255,0.4), 0 0 0 1px rgba(0,229,255,0.3)';}},onMouseLeave:e=>{e.target.style.transform='translateY(0)';if(!isDisabled){e.target.style.boxShadow='0 8px 32px rgba(0,229,255,0.3), 0 0 0 1px rgba(0,229,255,0.2)';}},children:[submitting&&/*#__PURE__*/_jsx(\"div\",{style:{width:'18px',height:'18px',border:'2px solid rgba(255,255,255,0.3)',borderTop:'2px solid #fff',borderRadius:'50%',animation:'spin 0.8s linear infinite'}}),submitting?'Sending...':success?'Sent!':\"Send \".concat(metadata.currency)]})]}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n        @keyframes spin {\\n          to { transform: rotate(360deg); }\\n        }\\n        input[type=\\\"number\\\"]::-webkit-inner-spin-button,\\n        input[type=\\\"number\\\"]::-webkit-outer-spin-button {\\n          -webkit-appearance: none;\\n          margin: 0;\\n        }\\n        input[type=\\\"number\\\"] {\\n          -moz-appearance: textfield;\\n        }\\n      \"})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}