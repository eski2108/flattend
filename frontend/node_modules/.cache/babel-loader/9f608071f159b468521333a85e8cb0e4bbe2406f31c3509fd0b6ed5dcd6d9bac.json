{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import axios from'axios';import{toast}from'sonner';import Layout from'@/components/Layout';import{IoAlertCircle,IoCheckmarkCircle,IoTime,IoEye,IoWarning,IoCopy}from'react-icons/io5';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API=process.env.REACT_APP_BACKEND_URL;export default function AdminDisputes(){var _selectedDispute$disp,_selectedDispute$buye,_selectedDispute$sell;const navigate=useNavigate();const[disputes,setDisputes]=useState([]);const[filteredDisputes,setFilteredDisputes]=useState([]);const[loading,setLoading]=useState(true);const[selectedDispute,setSelectedDispute]=useState(null);const[showResolveModal,setShowResolveModal]=useState(false);const[adminNote,setAdminNote]=useState('');const[winner,setWinner]=useState('');const[resolution,setResolution]=useState('');const[statusFilter,setStatusFilter]=useState('all');useEffect(()=>{loadDisputes();},[]);useEffect(()=>{// Apply filter\nif(statusFilter==='all'){setFilteredDisputes(disputes);}else{setFilteredDisputes(disputes.filter(d=>d.status===statusFilter));}},[disputes,statusFilter]);const loadDisputes=async()=>{try{const response=await axios.get(\"\".concat(API,\"/api/admin/disputes/all\"));if(response.data.success){setDisputes(response.data.disputes);}}catch(error){console.error('Error loading disputes:',error);toast.error('Failed to load disputes');}finally{setLoading(false);}};const handleResolve=async()=>{if(!winner||!resolution.trim()){toast.error('Please select a winner and provide resolution details');return;}try{const response=await axios.post(\"\".concat(API,\"/api/admin/disputes/\").concat(selectedDispute.dispute_id,\"/resolve\"),{winner:winner,resolution:resolution,admin_id:'admin',admin_note:adminNote});if(response.data.success){toast.success('Dispute resolved successfully');setShowResolveModal(false);setSelectedDispute(null);setWinner('');setResolution('');setAdminNote('');loadDisputes();}}catch(error){console.error('Error resolving dispute:',error);toast.error('Failed to resolve dispute');}};const getStatusColor=status=>{switch(status){case'open':return'bg-yellow-500/20 text-yellow-400 border-yellow-500/50';case'under_review':return'bg-orange-500/20 text-orange-400 border-orange-500/50';case'resolved':return'bg-green-500/20 text-green-400 border-green-500/50';default:return'bg-gray-500/20 text-gray-400 border-gray-500/50';}};return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-950 via-purple-950 to-slate-900 p-4 md:p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl md:text-4xl font-bold text-white mb-2\",children:\"\\uD83D\\uDEA8 Admin Dispute Management\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-sm md:text-base\",children:\"Review and resolve P2P trade disputes\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 flex flex-wrap gap-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setStatusFilter('all'),className:\"px-4 py-2 rounded-lg font-semibold transition-colors \".concat(statusFilter==='all'?'bg-cyan-600 text-white':'bg-slate-700 text-gray-300 hover:bg-slate-600'),children:[\"All (\",disputes.length,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setStatusFilter('open'),className:\"px-4 py-2 rounded-lg font-semibold transition-colors \".concat(statusFilter==='open'?'bg-yellow-600 text-white':'bg-slate-700 text-gray-300 hover:bg-slate-600'),children:[\"Open (\",disputes.filter(d=>d.status==='open').length,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setStatusFilter('under_review'),className:\"px-4 py-2 rounded-lg font-semibold transition-colors \".concat(statusFilter==='under_review'?'bg-orange-600 text-white':'bg-slate-700 text-gray-300 hover:bg-slate-600'),children:[\"Under Review (\",disputes.filter(d=>d.status==='under_review').length,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setStatusFilter('resolved'),className:\"px-4 py-2 rounded-lg font-semibold transition-colors \".concat(statusFilter==='resolved'?'bg-green-600 text-white':'bg-slate-700 text-gray-300 hover:bg-slate-600'),children:[\"Resolved (\",disputes.filter(d=>d.status==='resolved').length,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setStatusFilter('cancelled'),className:\"px-4 py-2 rounded-lg font-semibold transition-colors \".concat(statusFilter==='cancelled'?'bg-red-600 text-white':'bg-slate-700 text-gray-300 hover:bg-slate-600'),children:[\"Cancelled (\",disputes.filter(d=>d.status==='cancelled').length,\")\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 border border-yellow-500/30 rounded-xl p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-2\",children:[/*#__PURE__*/_jsx(IoAlertCircle,{className:\"w-5 h-5 text-yellow-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-semibold text-white\",children:\"Open Disputes\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-yellow-400\",children:disputes.filter(d=>d.status==='open').length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 border border-orange-500/30 rounded-xl p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-2\",children:[/*#__PURE__*/_jsx(IoTime,{className:\"w-5 h-5 text-orange-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-semibold text-white\",children:\"Under Review\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-orange-400\",children:disputes.filter(d=>d.status==='under_review').length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 border border-green-500/30 rounded-xl p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-2\",children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{className:\"w-5 h-5 text-green-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-semibold text-white\",children:\"Resolved\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-green-400\",children:disputes.filter(d=>d.status==='resolved').length})]})]}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center text-white py-12\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin w-12 h-12 border-4 border-cyan-400 border-t-transparent rounded-full mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading disputes...\"})]}):disputes.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 rounded-xl p-12 text-center\",children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{className:\"w-16 h-16 text-green-400 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-lg\",children:\"No disputes to review\"})]}):filteredDisputes.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 rounded-xl p-12 text-center\",children:[/*#__PURE__*/_jsx(IoAlertCircle,{className:\"w-16 h-16 text-yellow-400 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-lg\",children:\"No disputes match the selected filter\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setStatusFilter('all'),className:\"mt-4 bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg transition-colors\",children:\"Show All Disputes\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:filteredDisputes.map(dispute=>{var _dispute$status,_dispute$trade_id,_dispute$reason;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-800/50 border border-slate-700 rounded-xl p-4 hover:border-cyan-500/50 transition-colors\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 flex-wrap\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 rounded-full text-xs font-semibold border \".concat(getStatusColor(dispute.status)),children:(_dispute$status=dispute.status)===null||_dispute$status===void 0?void 0:_dispute$status.toUpperCase()}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-400 text-xs\",children:[\"Trade: \",/*#__PURE__*/_jsxs(\"span\",{className:\"text-white font-mono\",children:[(_dispute$trade_id=dispute.trade_id)===null||_dispute$trade_id===void 0?void 0:_dispute$trade_id.slice(0,12),\"...\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{const link=\"\".concat(window.location.origin,\"/admin/disputes/\").concat(dispute.dispute_id);navigator.clipboard.writeText(link);toast.success('Dispute link copied!');},className:\"bg-slate-600 hover:bg-slate-500 text-white px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-2\",children:/*#__PURE__*/_jsx(IoCopy,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate(\"/admin/disputes/\".concat(dispute.dispute_id)),className:\"bg-cyan-600 hover:bg-cyan-700 text-white px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-2 flex-1 md:flex-none justify-center\",children:[/*#__PURE__*/_jsx(IoEye,{className:\"w-4 h-4\"}),\"View\"]}),dispute.status!=='resolved'&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{setSelectedDispute(dispute);setShowResolveModal(true);},className:\"bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-2 flex-1 md:flex-none justify-center\",children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{className:\"w-4 h-4\"}),\"Resolve\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-xs mb-1\",children:\"Amount\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-white font-semibold text-sm\",children:[dispute.amount,\" \",dispute.currency]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-xs mb-1\",children:\"Reason\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-white capitalize text-sm\",children:(_dispute$reason=dispute.reason)===null||_dispute$reason===void 0?void 0:_dispute$reason.replace(/_/g,' ')})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-xs mb-1\",children:\"Initiated By\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-orange-400 font-semibold capitalize text-sm\",children:dispute.initiated_by})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-xs mb-1\",children:\"Created\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-white text-sm\",children:new Date(dispute.created_at).toLocaleDateString()})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-900/50 rounded-lg p-3\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-xs mb-1\",children:\"Description:\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-white text-sm\",children:dispute.description})]})]},dispute.dispute_id);})})]}),showResolveModal&&selectedDispute&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-900 border-2 border-green-500 rounded-2xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-green-600 to-emerald-600 p-4 rounded-t-2xl sticky top-0\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl md:text-2xl font-bold text-white\",children:\"Resolve Dispute\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-green-100 text-xs mt-1\",children:[\"ID: \",(_selectedDispute$disp=selectedDispute.dispute_id)===null||_selectedDispute$disp===void 0?void 0:_selectedDispute$disp.slice(0,12),\"...\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 md:p-6 space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-300 font-semibold mb-2 text-sm\",children:\"Select Winner *\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-3\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setWinner('buyer'),className:\"p-3 rounded-lg border-2 transition-all text-sm \".concat(winner==='buyer'?'border-cyan-500 bg-cyan-500/20 text-cyan-300':'border-slate-700 bg-slate-800 text-gray-400 hover:border-slate-600'),children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold\",children:\"Buyer Wins\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs opacity-75 truncate\",children:[\"ID: \",(_selectedDispute$buye=selectedDispute.buyer_id)===null||_selectedDispute$buye===void 0?void 0:_selectedDispute$buye.slice(0,8)]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setWinner('seller'),className:\"p-3 rounded-lg border-2 transition-all text-sm \".concat(winner==='seller'?'border-purple-500 bg-purple-500/20 text-purple-300':'border-slate-700 bg-slate-800 text-gray-400 hover:border-slate-600'),children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold\",children:\"Seller Wins\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs opacity-75 truncate\",children:[\"ID: \",(_selectedDispute$sell=selectedDispute.seller_id)===null||_selectedDispute$sell===void 0?void 0:_selectedDispute$sell.slice(0,8)]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-300 font-semibold mb-2 text-sm\",children:\"Resolution Details *\"}),/*#__PURE__*/_jsx(\"textarea\",{value:resolution,onChange:e=>setResolution(e.target.value),placeholder:\"Explain why this decision was made...\",rows:4,className:\"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm focus:border-green-500 focus:outline-none resize-none\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-300 font-semibold mb-2 text-sm\",children:\"Internal Admin Note (Optional)\"}),/*#__PURE__*/_jsx(\"textarea\",{value:adminNote,onChange:e=>setAdminNote(e.target.value),placeholder:\"Private notes for admin records only...\",rows:2,className:\"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm focus:border-green-500 focus:outline-none resize-none\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-orange-500/10 border-l-4 border-orange-500 p-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-2\",children:[/*#__PURE__*/_jsx(IoWarning,{className:\"w-5 h-5 text-orange-400 flex-shrink-0 mt-0.5\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-orange-300 text-xs\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Note:\"}),\" A \\xA35 dispute fee will be charged to the losing party.\"]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3 pt-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowResolveModal(false);setSelectedDispute(null);setWinner('');setResolution('');setAdminNote('');},className:\"flex-1 bg-slate-700 hover:bg-slate-600 text-white px-4 py-3 rounded-lg transition-colors font-semibold text-sm\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleResolve,disabled:!winner||!resolution.trim(),className:\"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-3 rounded-lg transition-all font-semibold text-sm\",children:\"Resolve Dispute\"})]})]})]})})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}