"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9723],{7255:(e,a,s)=>{s.d(a,{Cf:()=>b,L3:()=>f,c7:()=>y,lG:()=>x,rr:()=>v});var l=s(9379),r=s(3986),n=s(9950),t=s(3636),i=s(6604),c=s(90),d=s(4414);const o=["className"],m=["className","children"],h=["className"],p=["className"],u=["className"],x=t.bL,j=(t.l9,t.ZL),N=(t.bm,n.forwardRef((e,a)=>{let{className:s}=e,n=(0,r.A)(e,o);return(0,d.jsx)(t.hJ,(0,l.A)({ref:a,className:(0,c.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s)},n))}));N.displayName=t.hJ.displayName;const b=n.forwardRef((e,a)=>{let{className:s,children:n}=e,o=(0,r.A)(e,m);return(0,d.jsxs)(j,{children:[(0,d.jsx)(N,{}),(0,d.jsxs)(t.UC,(0,l.A)((0,l.A)({ref:a,className:(0,c.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s)},o),{},{children:[n,(0,d.jsxs)(t.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,d.jsx)(i.$8F,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"sr-only",children:"Close"})]})]}))]})});b.displayName=t.UC.displayName;const y=e=>{let{className:a}=e,s=(0,r.A)(e,h);return(0,d.jsx)("div",(0,l.A)({className:(0,c.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a)},s))};y.displayName="DialogHeader";const f=n.forwardRef((e,a)=>{let{className:s}=e,n=(0,r.A)(e,p);return(0,d.jsx)(t.hE,(0,l.A)({ref:a,className:(0,c.cn)("text-lg font-semibold leading-none tracking-tight",s)},n))});f.displayName=t.hE.displayName;const v=n.forwardRef((e,a)=>{let{className:s}=e,n=(0,r.A)(e,u);return(0,d.jsx)(t.VY,(0,l.A)({ref:a,className:(0,c.cn)("text-sm text-muted-foreground",s)},n))});v.displayName=t.VY.displayName},9723:(e,a,s)=>{s.r(a),s.d(a,{default:()=>j});var l=s(9950),r=s(4028),n=s(165),t=s(1330),i=s(4245),c=s(3645),d=s(4779),o=s(7255),m=s(6604),h=s(6910),p=s(2033),u=s(4414);const x="https://coinhubx.net";function j(){const{account:e,refreshUser:a}=(0,n.v)(),s=(0,r.Zp)(),[j,N]=(0,l.useState)([]),[b,y]=(0,l.useState)(!0),[f,v]=(0,l.useState)(""),[g,_]=(0,l.useState)(null),[k,w]=(0,l.useState)(""),[C,A]=(0,l.useState)(!1),[S,z]=(0,l.useState)(null),[E,T]=(0,l.useState)(!1),[P,$]=(0,l.useState)("");(0,l.useEffect)(()=>{e?R():s("/")},[e,s]);const R=async()=>{try{const e=await h.A.get("".concat(x,"/crypto-market/sell/orders"));e.data.success&&N(e.data.orders)}catch(e){console.error("Error fetching sell orders:",e),p.oR.error("Failed to load sell orders")}finally{y(!1)}},F=e=>{navigator.clipboard.writeText(e),p.oR.success("Copied to clipboard")},L=j.filter(e=>e.crypto_amount.toString().includes(f)||e.seller_address.toLowerCase().includes(f.toLowerCase()));return(0,u.jsxs)(t.A,{children:[(0,u.jsxs)("div",{className:"buy-crypto-page","data-testid":"buy-crypto-page",children:[(0,u.jsx)("div",{className:"page-header",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("h1",{className:"page-title","data-testid":"buy-crypto-title",children:"Buy Crypto with Bank Transfer"}),(0,u.jsx)("p",{className:"page-subtitle",children:"Purchase crypto directly from lenders using bank transfer"})]})}),(0,u.jsx)("div",{className:"search-container",children:(0,u.jsxs)("div",{className:"search-input-wrapper",children:[(0,u.jsx)(m.zfp,{className:"search-icon",size:20}),(0,u.jsx)(d.p,{placeholder:"Search by amount or seller address...",value:f,onChange:e=>v(e.target.value),className:"search-input","data-testid":"search-input"})]})}),b?(0,u.jsx)("div",{className:"loading-container","data-testid":"loading-spinner",children:(0,u.jsx)("div",{className:"spinner"})}):L.length>0?(0,u.jsx)("div",{className:"offers-grid",children:L.map(a=>{const s=a.crypto_amount*a.price_per_unit;return(0,u.jsxs)(i.Zp,{className:"sell-order-card","data-testid":"sell-order-card",children:[(0,u.jsxs)("div",{className:"order-header",children:[(0,u.jsx)("div",{className:"order-badge",children:"Available"}),(0,u.jsx)(m.AaD,{size:20,className:"order-icon"})]}),(0,u.jsxs)("div",{className:"order-amount",children:[(0,u.jsx)("span",{className:"amount-value",children:a.crypto_amount||0}),(0,u.jsx)("span",{className:"amount-currency",children:"ETH"})]}),(0,u.jsxs)("div",{className:"order-price",children:[(0,u.jsx)("span",{className:"price-label",children:"Price:"}),(0,u.jsxs)("span",{className:"price-value",children:["$",(a.price_per_unit||0).toLocaleString()," / ETH"]})]}),(0,u.jsxs)("div",{className:"order-details",children:[(0,u.jsxs)("div",{className:"detail-row",children:[(0,u.jsx)("span",{className:"detail-label",children:"Total Value:"}),(0,u.jsxs)("span",{className:"detail-value",children:["$",isNaN(s)?"0":s.toLocaleString()]})]}),(0,u.jsxs)("div",{className:"detail-row",children:[(0,u.jsx)("span",{className:"detail-label",children:"Min Purchase:"}),(0,u.jsxs)("span",{className:"detail-value",children:[a.min_purchase||0," ETH"]})]}),(0,u.jsxs)("div",{className:"detail-row",children:[(0,u.jsx)("span",{className:"detail-label",children:"Max Purchase:"}),(0,u.jsxs)("span",{className:"detail-value",children:[a.max_purchase||0," ETH"]})]}),(0,u.jsxs)("div",{className:"detail-row",children:[(0,u.jsx)("span",{className:"detail-label",children:"Seller:"}),(0,u.jsxs)("span",{className:"detail-value address",children:[a.seller_address.slice(0,6),"...",a.seller_address.slice(-4)]})]}),(0,u.jsxs)("div",{className:"detail-row",children:[(0,u.jsx)("span",{className:"detail-label",children:"Payment:"}),(0,u.jsx)("span",{className:"detail-value",children:"Bank Transfer"})]})]}),(0,u.jsx)(c.$,{className:"buy-btn",onClick:()=>_(a),disabled:a.seller_address===e,"data-testid":"buy-now-btn",children:a.seller_address===e?"Your Order":"Buy Now"})]},a.order_id)})}):(0,u.jsxs)(i.Zp,{className:"empty-state","data-testid":"empty-orders",children:[(0,u.jsx)(m.dSe,{size:48,className:"empty-icon"}),(0,u.jsx)("h3",{children:"No Sell Orders Available"}),(0,u.jsx)("p",{children:"Check back later or create your own sell order"}),(0,u.jsx)(c.$,{onClick:()=>s("/sell-crypto"),"data-testid":"create-sell-order-btn",children:"Create Sell Order"})]})]}),(0,u.jsx)(o.lG,{open:!!g,onOpenChange:()=>_(null),children:(0,u.jsxs)(o.Cf,{className:"buy-dialog","data-testid":"buy-dialog",children:[(0,u.jsxs)(o.c7,{children:[(0,u.jsx)(o.L3,{children:"Buy Crypto"}),(0,u.jsx)(o.rr,{children:"Enter amount to purchase"})]}),g&&(0,u.jsxs)("div",{className:"dialog-content",children:[(0,u.jsxs)("div",{className:"order-info",children:[(0,u.jsxs)("div",{className:"info-row",children:[(0,u.jsx)("span",{children:"Available:"}),(0,u.jsxs)("span",{className:"info-value",children:[g.crypto_amount||0," ETH"]})]}),(0,u.jsxs)("div",{className:"info-row",children:[(0,u.jsx)("span",{children:"Price per ETH:"}),(0,u.jsxs)("span",{className:"info-value",children:["$",(g.price_per_unit||0).toLocaleString()]})]}),(0,u.jsxs)("div",{className:"info-row",children:[(0,u.jsx)("span",{children:"Min - Max:"}),(0,u.jsxs)("span",{className:"info-value",children:[g.min_purchase||0," - ",g.max_purchase||0," ETH"]})]})]}),(0,u.jsxs)("div",{className:"input-group",children:[(0,u.jsx)("label",{htmlFor:"buy-amount",children:"Amount (ETH)"}),(0,u.jsx)(d.p,{id:"buy-amount",type:"number",placeholder:"Enter amount",value:k,onChange:e=>w(e.target.value),"data-testid":"buy-amount-input"})]}),k&&(0,u.jsxs)("div",{className:"calculation",children:[(0,u.jsxs)("div",{className:"calc-row",children:[(0,u.jsx)("span",{children:"Crypto Amount:"}),(0,u.jsxs)("span",{children:[parseFloat(k).toFixed(4)," ETH"]})]}),(0,u.jsxs)("div",{className:"calc-row total",children:[(0,u.jsx)("span",{children:"Total to Pay:"}),(0,u.jsxs)("span",{className:"highlight",children:["$",(parseFloat(k)*g.price_per_unit).toLocaleString()]})]})]}),(0,u.jsxs)("div",{className:"info-box",children:[(0,u.jsx)(m.Gm4,{size:20}),(0,u.jsx)("p",{children:"You'll have 30 minutes to complete the bank transfer"})]}),(0,u.jsxs)("div",{className:"dialog-actions",children:[(0,u.jsx)(c.$,{variant:"outline",onClick:()=>_(null),"data-testid":"cancel-btn",children:"Cancel"}),(0,u.jsx)(c.$,{onClick:async()=>{if(!g||!k)return void p.oR.error("Please enter amount");const a=parseFloat(k);if(a<g.min_purchase||a>g.max_purchase)p.oR.error("Amount must be between ".concat(g.min_purchase," and ").concat(g.max_purchase," ETH"));else{A(!0);try{const s=await h.A.post("".concat(x,"/crypto-market/buy/create"),{buyer_address:e,sell_order_id:g.order_id,crypto_amount:a});s.data.success&&(p.oR.success("Buy order created! Please complete bank transfer"),z(s.data),_(null),w(""),T(!0),R())}catch(r){var s,l;console.error("Error creating buy order:",r),p.oR.error((null===(s=r.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.detail)||"Failed to create buy order")}finally{A(!1)}}},disabled:C,"data-testid":"confirm-buy-btn",children:C?"Processing...":"Proceed to Payment"})]})]})]})}),(0,u.jsx)(o.lG,{open:E,onOpenChange:T,children:(0,u.jsxs)(o.Cf,{className:"payment-dialog","data-testid":"payment-dialog",children:[(0,u.jsxs)(o.c7,{children:[(0,u.jsx)(o.L3,{children:"Complete Bank Transfer"}),(0,u.jsx)(o.rr,{children:"Transfer funds to seller's bank account"})]}),S&&(0,u.jsxs)("div",{className:"dialog-content",children:[(0,u.jsxs)("div",{className:"payment-timer",children:[(0,u.jsx)(m.Gm4,{size:24}),(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"timer-label",children:"Payment Deadline"}),(0,u.jsx)("p",{className:"timer-value",children:new Date(S.payment_deadline).toLocaleString()})]})]}),(0,u.jsxs)("div",{className:"bank-details-card",children:[(0,u.jsx)("h3",{children:"Seller's Bank Details"}),(0,u.jsxs)("div",{className:"bank-detail-row",children:[(0,u.jsx)("span",{children:"Bank Name:"}),(0,u.jsxs)("div",{className:"copy-field",children:[(0,u.jsx)("span",{children:S.seller_bank_details.bank_name}),(0,u.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>F(S.seller_bank_details.bank_name),"data-testid":"copy-bank-name",children:(0,u.jsx)(m.iyF,{size:16})})]})]}),(0,u.jsxs)("div",{className:"bank-detail-row",children:[(0,u.jsx)("span",{children:"Account Holder:"}),(0,u.jsxs)("div",{className:"copy-field",children:[(0,u.jsx)("span",{children:S.seller_bank_details.account_holder}),(0,u.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>F(S.seller_bank_details.account_holder),"data-testid":"copy-account-holder",children:(0,u.jsx)(m.iyF,{size:16})})]})]}),(0,u.jsxs)("div",{className:"bank-detail-row",children:[(0,u.jsx)("span",{children:"Account Number:"}),(0,u.jsxs)("div",{className:"copy-field",children:[(0,u.jsx)("span",{children:S.seller_bank_details.account_number}),(0,u.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>F(S.seller_bank_details.account_number),"data-testid":"copy-account-number",children:(0,u.jsx)(m.iyF,{size:16})})]})]}),S.seller_bank_details.routing_number&&(0,u.jsxs)("div",{className:"bank-detail-row",children:[(0,u.jsx)("span",{children:"Routing Number:"}),(0,u.jsxs)("div",{className:"copy-field",children:[(0,u.jsx)("span",{children:S.seller_bank_details.routing_number}),(0,u.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>F(S.seller_bank_details.routing_number),"data-testid":"copy-routing-number",children:(0,u.jsx)(m.iyF,{size:16})})]})]}),(0,u.jsxs)("div",{className:"bank-detail-row highlight",children:[(0,u.jsx)("span",{children:"Amount to Transfer:"}),(0,u.jsxs)("span",{className:"amount-highlight",children:["$",S.order.total_price.toLocaleString()]})]})]}),(0,u.jsxs)("div",{className:"input-group",children:[(0,u.jsx)("label",{htmlFor:"payment-ref",children:"Payment Reference / Transaction ID"}),(0,u.jsx)(d.p,{id:"payment-ref",placeholder:"Enter your bank transfer reference",value:P,onChange:e=>$(e.target.value),"data-testid":"payment-reference-input"}),(0,u.jsx)("p",{className:"input-hint",children:"Enter the transaction ID from your bank transfer"})]}),(0,u.jsxs)("div",{className:"info-box warn",children:[(0,u.jsx)(m.dSe,{size:20}),(0,u.jsx)("p",{children:"After making the transfer, confirm payment below. Seller will release crypto once verified."})]}),(0,u.jsxs)("div",{className:"dialog-actions",children:[(0,u.jsx)(c.$,{variant:"outline",onClick:()=>{T(!1),z(null)},"data-testid":"cancel-payment-btn",children:"Cancel"}),(0,u.jsxs)(c.$,{onClick:async()=>{if(P)try{(await h.A.post("".concat(x,"/crypto-market/payment/mark-paid"),{buyer_address:e,order_id:S.order.order_id,payment_reference:P})).data.success&&(p.oR.success("\u2713 Marked as Paid! Seller will be notified to release crypto"),T(!1),z(null),$(""),await a())}catch(r){var s,l;console.error("Error marking as paid:",r),p.oR.error((null===(s=r.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.detail)||"Failed to mark as paid")}else p.oR.error("Please enter payment reference")},"data-testid":"mark-paid-btn",className:"mark-paid-btn",children:[(0,u.jsx)(m.G3G,{size:20,className:"mr-2"}),"Mark as Paid"]})]})]})]})})]})}}}]);