"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[4918],{4918:(e,r,t)=>{t.r(r),t.d(r,{default:()=>g});var i=t(9950),o=t(4028),s=t(1330),d=t(6604),n=t(6910),a=t(2033),l=t(4414);const c="https://bugsecurehub.preview.emergentagent.com";function g(){var e;const{orderId:r}=(0,o.g)(),t=(0,o.Zp)(),[g,p]=(0,i.useState)(null),[u,m]=(0,i.useState)(null),[x,b]=(0,i.useState)(!0),[F,h]=(0,i.useState)(!1),[y,f]=(0,i.useState)(!1),[v,j]=(0,i.useState)(""),[k,S]=(0,i.useState)(""),[z,_]=(0,i.useState)("screenshot"),[C,B]=(0,i.useState)([]),[R,w]=(0,i.useState)(""),[W,E]=(0,i.useState)(!1),[I,A]=(0,i.useState)(null);(0,i.useEffect)(()=>{const e=localStorage.getItem("cryptobank_user");if(!e)return void t("/");const r=JSON.parse(e);A(r),T(r.user_id)},[r,t]);const T=async e=>{try{const t=await n.A.get("".concat(c,"/api/crypto-market/orders/").concat(e)),i=[...t.data.buy_orders,...t.data.sell_orders].find(e=>e.order_id===r);i&&p(i)}catch(t){console.error("Error fetching order:",t),a.oR.error("Failed to load order details")}finally{b(!1)}},D=async()=>{if(R.trim()&&u)try{const e=g.buyer_id===I.user_id?"buyer":"seller",r=await n.A.post("".concat(c,"/api/disputes/message"),{dispute_id:u.dispute_id,sender_address:I.user_id,sender_role:e,message:R});r.data.success&&(B([...C,r.data.message]),w(""))}catch(e){console.error("Error sending message:",e),a.oR.error("Failed to send message")}};if(x)return(0,l.jsx)(s.A,{children:(0,l.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"60vh"},"data-testid":"loading-spinner",children:(0,l.jsx)("div",{style:{width:"48px",height:"48px",border:"4px solid rgba(0, 240, 255, 0.3)",borderTopColor:"#00F0FF",borderRadius:"50%",animation:"spin 1s linear infinite"}})})});if(!g)return(0,l.jsx)(s.A,{children:(0,l.jsxs)("div",{style:{maxWidth:"600px",margin:"4rem auto",padding:"3rem 2rem",textAlign:"center",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05))",border:"2px solid rgba(239, 68, 68, 0.3)",borderRadius:"16px"},children:[(0,l.jsx)(d.tr_,{size:64,color:"#EF4444",style:{marginBottom:"1.5rem"}}),(0,l.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#FFFFFF",marginBottom:"1rem"},children:"Order Not Found"}),(0,l.jsx)("button",{onClick:()=>t("/my-orders"),style:{padding:"0.75rem 2rem",background:"linear-gradient(135deg, #00F0FF, #A855F7)",border:"none",borderRadius:"10px",color:"#000000",fontSize:"1rem",fontWeight:"600",cursor:"pointer",marginTop:"1rem"},children:"Go Back"})]})});const O=g.buyer_id===(null===I||void 0===I?void 0:I.user_id),P=e=>{switch(e){case"completed":return"#22C55E";case"disputed":return"#F59E0B";case"cancelled":return"#EF4444";default:return"#00F0FF"}};return(0,l.jsx)(s.A,{children:(0,l.jsxs)("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"2rem 1rem"},"data-testid":"order-details-page",children:[(0,l.jsxs)("div",{style:{marginBottom:"2rem",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"900",marginBottom:"0.5rem",background:"linear-gradient(135deg, #00F0FF, #A855F7)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},"data-testid":"order-title",children:"Order Details"}),(0,l.jsxs)("p",{style:{color:"rgba(255,255,255,0.6)",fontSize:"0.875rem"},children:["Order ID: ",r.slice(0,12),"..."]})]}),(0,l.jsx)("button",{onClick:()=>t("/my-orders"),style:{padding:"0.75rem 1.5rem",background:"rgba(0, 240, 255, 0.1)",border:"2px solid rgba(0, 240, 255, 0.3)",borderRadius:"10px",color:"#00F0FF",fontSize:"0.9375rem",fontWeight:"600",cursor:"pointer"},children:"Back to Orders"})]}),(0,l.jsxs)("div",{style:{background:"linear-gradient(135deg, rgba(0, 240, 255, 0.05), rgba(168, 85, 247, 0.05))",border:"2px solid rgba(0, 240, 255, 0.2)",borderRadius:"16px",padding:"2rem",marginBottom:"2rem"},"data-testid":"order-status",children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",flexWrap:"wrap",gap:"1rem"},children:[(0,l.jsx)("h3",{style:{fontSize:"1.375rem",fontWeight:"700",color:"#FFFFFF"},children:"Order Status"}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",background:"".concat(P(g.status),"20"),border:"2px solid ".concat(P(g.status)),borderRadius:"10px",color:P(g.status),fontWeight:"700",fontSize:"0.875rem",textTransform:"uppercase"},children:[(e=>{switch(e){case"completed":return(0,l.jsx)(d.G3G,{size:20});case"disputed":return(0,l.jsx)(d.tr_,{size:20});default:return(0,l.jsx)(d.Gm4,{size:20})}})(g.status),(0,l.jsx)("span",{children:g.status.replace(/_/g," ")})]})]}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.25rem"},children:[(0,l.jsxs)("div",{style:{padding:"1rem",background:"rgba(0, 0, 0, 0.2)",borderRadius:"10px"},children:[(0,l.jsx)("div",{style:{fontSize:"0.875rem",color:"rgba(255,255,255,0.6)",marginBottom:"0.5rem"},children:"Amount"}),(0,l.jsxs)("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#FFFFFF"},children:[g.crypto_amount," ",g.crypto_currency]})]}),(0,l.jsxs)("div",{style:{padding:"1rem",background:"rgba(0, 0, 0, 0.2)",borderRadius:"10px"},children:[(0,l.jsx)("div",{style:{fontSize:"0.875rem",color:"rgba(255,255,255,0.6)",marginBottom:"0.5rem"},children:"Total Price"}),(0,l.jsxs)("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#FFFFFF"},children:["\xa3",null===(e=g.fiat_amount)||void 0===e?void 0:e.toLocaleString()]})]}),(0,l.jsxs)("div",{style:{padding:"1rem",background:"rgba(0, 0, 0, 0.2)",borderRadius:"10px"},children:[(0,l.jsx)("div",{style:{fontSize:"0.875rem",color:"rgba(255,255,255,0.6)",marginBottom:"0.5rem"},children:O?"Seller":"Buyer"}),(0,l.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#FFFFFF",fontFamily:"monospace"},children:"".concat(O?g.seller_id.slice(0,8):g.buyer_id.slice(0,8),"...")})]})]}),"disputed"===g.status&&(0,l.jsxs)("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"rgba(245, 158, 11, 0.1)",border:"2px solid rgba(245, 158, 11, 0.3)",borderRadius:"10px",display:"flex",alignItems:"center",gap:"1rem"},children:[(0,l.jsx)(d.tr_,{size:24,color:"#F59E0B"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"1rem",fontWeight:"700",color:"#F59E0B",marginBottom:"0.25rem"},children:"Crypto Locked in Escrow"}),(0,l.jsx)("div",{style:{fontSize:"0.875rem",color:"rgba(255,255,255,0.7)"},children:"This order is under dispute. Crypto is securely held in escrow until admin resolution."})]})]}),"disputed"!==g.status&&"completed"!==g.status&&(0,l.jsx)("div",{style:{marginTop:"1.5rem"},children:(0,l.jsxs)("button",{onClick:()=>h(!0),"data-testid":"open-dispute-btn",style:{padding:"0.875rem 1.5rem",background:"linear-gradient(135deg, #EF4444, #DC2626)",border:"none",borderRadius:"10px",color:"#FFFFFF",fontSize:"1rem",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,l.jsx)(d.tr_,{size:20}),"Open Dispute"]})})]}),"disputed"===g.status&&(0,l.jsxs)("div",{style:{background:"linear-gradient(135deg, rgba(245, 158, 11, 0.05), rgba(251, 191, 36, 0.05))",border:"2px solid rgba(245, 158, 11, 0.2)",borderRadius:"16px",padding:"2rem"},"data-testid":"dispute-section",children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[(0,l.jsx)("h3",{style:{fontSize:"1.375rem",fontWeight:"700",color:"#FFFFFF"},children:"Dispute & Evidence"}),(0,l.jsxs)("button",{onClick:()=>f(!0),"data-testid":"upload-evidence-btn",style:{padding:"0.75rem 1.25rem",background:"rgba(245, 158, 11, 0.1)",border:"2px solid rgba(245, 158, 11, 0.3)",borderRadius:"10px",color:"#F59E0B",fontSize:"0.9375rem",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,l.jsx)(d.xvb,{size:18}),"Upload Evidence"]})]}),(0,l.jsxs)("div",{style:{padding:"1.25rem",background:"rgba(0, 0, 0, 0.2)",borderRadius:"10px",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem"},children:[(0,l.jsx)(d.mk,{size:28,color:"#F59E0B"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"1rem",fontWeight:"700",color:"#FFFFFF",marginBottom:"0.25rem"},children:"Provide Evidence"}),(0,l.jsx)("div",{style:{fontSize:"0.875rem",color:"rgba(255,255,255,0.7)"},children:"Upload bank transfer screenshots, receipts, or any proof to support your case. Admin will review all evidence."})]})]}),(0,l.jsxs)("div",{style:{background:"rgba(0, 0, 0, 0.2)",borderRadius:"10px",padding:"1.5rem"},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"1rem"},children:[(0,l.jsx)(d.mNJ,{size:20,color:"#00F0FF"}),(0,l.jsx)("h4",{style:{fontSize:"1.125rem",fontWeight:"700",color:"#FFFFFF"},children:"Dispute Chat"})]}),(0,l.jsx)("div",{style:{minHeight:"200px",maxHeight:"400px",overflowY:"auto",marginBottom:"1rem",padding:"1rem",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px"},children:C.length>0?C.map(e=>(0,l.jsxs)("div",{style:{marginBottom:"1rem",padding:"0.875rem",background:e.sender_address===(null===I||void 0===I?void 0:I.user_id)?"rgba(0, 240, 255, 0.1)":"rgba(168, 85, 247, 0.1)",borderRadius:"8px",borderLeft:"4px solid ".concat(e.sender_address===(null===I||void 0===I?void 0:I.user_id)?"#00F0FF":"#A855F7")},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,l.jsx)("span",{style:{fontSize:"0.875rem",fontWeight:"700",color:e.sender_address===(null===I||void 0===I?void 0:I.user_id)?"#00F0FF":"#A855F7",textTransform:"uppercase"},children:e.sender_role}),(0,l.jsx)("span",{style:{fontSize:"0.75rem",color:"rgba(255,255,255,0.6)"},children:new Date(e.created_at).toLocaleTimeString()})]}),(0,l.jsx)("p",{style:{color:"#FFFFFF",fontSize:"0.9375rem"},children:e.message})]},e.message_id)):(0,l.jsx)("p",{style:{color:"rgba(255,255,255,0.6)",textAlign:"center",padding:"2rem"},children:"No messages yet. Start the conversation."})}),(0,l.jsxs)("div",{style:{display:"flex",gap:"0.75rem"},children:[(0,l.jsx)("input",{type:"text",placeholder:"Type your message...",value:R,onChange:e=>w(e.target.value),onKeyPress:e=>"Enter"===e.key&&D(),"data-testid":"chat-input",style:{flex:1,padding:"0.875rem",background:"rgba(0, 0, 0, 0.3)",border:"2px solid rgba(0, 240, 255, 0.3)",borderRadius:"8px",color:"#FFFFFF",fontSize:"0.9375rem",outline:"none"}}),(0,l.jsxs)("button",{onClick:D,"data-testid":"send-message-btn",style:{padding:"0.875rem 1.5rem",background:"linear-gradient(135deg, #00F0FF, #00B8E6)",border:"none",borderRadius:"8px",color:"#000000",fontSize:"0.9375rem",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,l.jsx)(d.$_z,{size:18}),"Send"]})]})]})]}),F&&(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},onClick:()=>h(!1),"data-testid":"dispute-dialog",children:(0,l.jsxs)("div",{style:{maxWidth:"600px",width:"100%",background:"linear-gradient(135deg, rgba(30, 39, 73, 0.95), rgba(20, 27, 50, 0.95))",border:"2px solid rgba(0, 240, 255, 0.3)",borderRadius:"16px",padding:"2rem",maxHeight:"90vh",overflowY:"auto"},onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[(0,l.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#FFFFFF"},children:"Open Dispute"}),(0,l.jsx)("button",{onClick:()=>h(!1),style:{background:"none",border:"none",color:"rgba(255,255,255,0.6)",cursor:"pointer"},children:(0,l.jsx)(d.$8F,{size:24})})]}),(0,l.jsxs)("div",{style:{padding:"1rem",background:"rgba(245, 158, 11, 0.1)",border:"2px solid rgba(245, 158, 11, 0.3)",borderRadius:"8px",marginBottom:"1.5rem",display:"flex",gap:"0.75rem"},children:[(0,l.jsx)(d.tr_,{size:20,color:"#F59E0B",style:{flexShrink:0,marginTop:"2px"}}),(0,l.jsx)("p",{style:{fontSize:"0.875rem",color:"rgba(255,255,255,0.9)"},children:"Only open a dispute if there is a genuine issue. False disputes may affect your account."})]}),(0,l.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,l.jsx)("label",{style:{display:"block",fontSize:"0.9375rem",fontWeight:"600",color:"#FFFFFF",marginBottom:"0.5rem"},children:"Reason for Dispute *"}),(0,l.jsx)("textarea",{placeholder:"Explain the issue (e.g., Payment sent but seller not releasing crypto, No payment received, etc.)",value:v,onChange:e=>j(e.target.value),rows:5,"data-testid":"dispute-reason-input",style:{width:"100%",padding:"0.875rem",background:"rgba(0, 0, 0, 0.3)",border:"2px solid rgba(0, 240, 255, 0.3)",borderRadius:"8px",color:"#FFFFFF",fontSize:"0.9375rem",outline:"none",resize:"vertical"}})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"0.75rem"},children:[(0,l.jsx)("button",{onClick:()=>h(!1),style:{flex:1,padding:"0.875rem",background:"rgba(255, 255, 255, 0.1)",border:"2px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"#FFFFFF",fontSize:"0.9375rem",fontWeight:"600",cursor:"pointer"},children:"Cancel"}),(0,l.jsx)("button",{onClick:async()=>{if(v.trim()){E(!0);try{const e=await n.A.post("".concat(c,"/api/disputes/initiate"),{user_address:I.user_id,order_id:r,reason:v});e.data.success&&(a.oR.success("Dispute opened! Crypto is now locked in escrow."),h(!1),j(""),m(e.data.dispute),T(I.user_id))}catch(i){var e,t;console.error("Error initiating dispute:",i),a.oR.error((null===(e=i.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Failed to initiate dispute")}finally{E(!1)}}else a.oR.error("Please provide a reason for the dispute")},disabled:W,"data-testid":"submit-dispute-btn",style:{flex:1,padding:"0.875rem",background:W?"rgba(239, 68, 68, 0.5)":"linear-gradient(135deg, #EF4444, #DC2626)",border:"none",borderRadius:"8px",color:"#FFFFFF",fontSize:"0.9375rem",fontWeight:"600",cursor:W?"not-allowed":"pointer"},children:W?"Opening...":"Open Dispute"})]})]})}),y&&(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},onClick:()=>f(!1),"data-testid":"evidence-dialog",children:(0,l.jsxs)("div",{style:{maxWidth:"600px",width:"100%",background:"linear-gradient(135deg, rgba(30, 39, 73, 0.95), rgba(20, 27, 50, 0.95))",border:"2px solid rgba(245, 158, 11, 0.3)",borderRadius:"16px",padding:"2rem",maxHeight:"90vh",overflowY:"auto"},onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[(0,l.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#FFFFFF"},children:"Upload Evidence"}),(0,l.jsx)("button",{onClick:()=>f(!1),style:{background:"none",border:"none",color:"rgba(255,255,255,0.6)",cursor:"pointer"},children:(0,l.jsx)(d.$8F,{size:24})})]}),(0,l.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,l.jsx)("label",{style:{display:"block",fontSize:"0.9375rem",fontWeight:"600",color:"#FFFFFF",marginBottom:"0.5rem"},children:"Evidence Type"}),(0,l.jsxs)("select",{value:z,onChange:e=>_(e.target.value),"data-testid":"evidence-type-select",style:{width:"100%",padding:"0.875rem",background:"rgba(0, 0, 0, 0.3)",border:"2px solid rgba(245, 158, 11, 0.3)",borderRadius:"8px",color:"#FFFFFF",fontSize:"0.9375rem",outline:"none"},children:[(0,l.jsx)("option",{value:"screenshot",children:"Screenshot"}),(0,l.jsx)("option",{value:"bank_statement",children:"Bank Statement"}),(0,l.jsx)("option",{value:"message",children:"Message/Email"})]})]}),(0,l.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,l.jsx)("label",{style:{display:"block",fontSize:"0.9375rem",fontWeight:"600",color:"#FFFFFF",marginBottom:"0.5rem"},children:"Description *"}),(0,l.jsx)("textarea",{placeholder:"Describe this evidence (e.g., Bank transfer confirmation showing payment of \xa33000 to seller's account)",value:k,onChange:e=>S(e.target.value),rows:4,"data-testid":"evidence-description-input",style:{width:"100%",padding:"0.875rem",background:"rgba(0, 0, 0, 0.3)",border:"2px solid rgba(245, 158, 11, 0.3)",borderRadius:"8px",color:"#FFFFFF",fontSize:"0.9375rem",outline:"none",resize:"vertical"}})]}),(0,l.jsxs)("div",{style:{padding:"1rem",background:"rgba(245, 158, 11, 0.1)",border:"2px solid rgba(245, 158, 11, 0.3)",borderRadius:"8px",marginBottom:"1.5rem",display:"flex",gap:"0.75rem"},children:[(0,l.jsx)(d.xvb,{size:20,color:"#F59E0B",style:{flexShrink:0,marginTop:"2px"}}),(0,l.jsx)("p",{style:{fontSize:"0.875rem",color:"rgba(255,255,255,0.9)"},children:"In production: Upload actual files here. For this demo, description is sufficient."})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"0.75rem"},children:[(0,l.jsx)("button",{onClick:()=>f(!1),style:{flex:1,padding:"0.875rem",background:"rgba(255, 255, 255, 0.1)",border:"2px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"#FFFFFF",fontSize:"0.9375rem",fontWeight:"600",cursor:"pointer"},children:"Cancel"}),(0,l.jsx)("button",{onClick:async()=>{if(k.trim())if(u){E(!0);try{(await n.A.post("".concat(c,"/api/disputes/evidence"),{dispute_id:u.dispute_id,uploaded_by:I.user_id,evidence_type:z,description:k,file_url:null})).data.success&&(a.oR.success("Evidence uploaded successfully"),f(!1),S(""))}catch(e){console.error("Error uploading evidence:",e),a.oR.error("Failed to upload evidence")}finally{E(!1)}}else a.oR.error("No active dispute found");else a.oR.error("Please provide evidence description")},disabled:W,"data-testid":"submit-evidence-btn",style:{flex:1,padding:"0.875rem",background:W?"rgba(245, 158, 11, 0.5)":"linear-gradient(135deg, #F59E0B, #F97316)",border:"none",borderRadius:"8px",color:"#000000",fontSize:"0.9375rem",fontWeight:"600",cursor:W?"not-allowed":"pointer"},children:W?"Uploading...":"Upload Evidence"})]})]})})]})})}}}]);